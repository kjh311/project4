(function(){var a=this.Giphy=a||{};var b=this.Timer=undefined;var c=this.Utils={};var d=this.Sharing={};var e=this.Analytics={};var f=this.Etc={};var g=this.Images={};var h=this.SearchResults={};var i=this.Nav={};var j=this.Login={};var k=this.Favorites={};var l=this.Search={};var m=this.Tags={};var n=this.Instagram={};var o=this.Browsebar={};var p=this.GifDetail={};var q=this.ArtistLanding={};var r=this.PartnerLanding={};var s=this.HeaderNav={};var t=this.Users={};var u=this.Upload={};var v=this.Newsletter={};var w=this.Facebook={};}).call(this);(function(a,b){var c={loadUrl:function(b){var c=$.Deferred();var d=new XMLHttpRequest();d.onload=a.bind(function(a){var b=d.response;if(b){var e=new Uint8Array(b);this.parse(e,c);}else c.reject();},this);d.onerror=function(){c.reject();};d.open('GET',b,true);d.responseType='arraybuffer';d.send();return c.promise();},loadBinary:function(a){var b=$.Deferred();this.parse(a,b);return b.promise();},parse:function(b,c){var d=document.createElement('canvas');var e=d.getContext('2d');var g=new f(b);var i=null;var j=null;var k=null;var l=null;var m=0;var n=null;var o={frames:[],duration:0,still:''};setTimeout(function(){h(g,{hdr:function(a){i=a;d.width=i.width;d.height=i.height;o.width=i.width;o.height=i.height;},gce:function(a){var b=(a.delayTime||10)*10;l=k;j=a.transparencyGiven?a.transparencyIndex:null;k=a.disposalMethod;o.frames.push({index:o.frames.length,delay:b});o.duration+=b;},img:function(b){var c=o.frames.length-1;if(c>0){if(l===3)e.putImageData(o.frames[m].data,0,0);else m=c;if(l===2)e.clearRect(n.leftPos,n.topPos,n.width,n.height);}var f=b.lctFlag?b.lct:i.gct;var g=e.getImageData(b.leftPos,b.topPos,b.width,b.height);var h=g.data;b.pixels.forEach(function(a,b){if(a!==j){h[b*4+0]=f[a][0];h[b*4+1]=f[a][1];h[b*4+2]=f[a][2];h[b*4+3]=255;}else if(l===2){h[b*4+0]=0;h[b*4+1]=0;h[b*4+2]=0;h[b*4+3]=0;}});e.putImageData(g,b.leftPos,b.topPos);n=b;if(o.frames[c]){o.frames[c]=a.extend(o.frames[c],{width:d.width,height:d.height,data:e.getImageData(0,0,d.width,d.height)||null});if(c===0)o.still=d.toDataURL('image/png');}},eof:function(a){c.resolve(o);}});},10);}};b.GifParser=c;var d=function(a){return a.reduce(function(a,b){return a*2+b;},0);};var e=function(a){var b=[];for(var c=7;c>=0;c--)b.push(!!(a&(1<<c)));return b;};var f=function(a){this.data=a;this.len=this.data.length;this.pos=0;this.readByte=function(){if(this.pos>=this.data.length)throw new Error('Attempted to read past end of stream.');return a[this.pos++];};this.readBytes=function(a){var b=[];for(var c=0;c<a;c++)b.push(this.readByte());return b;};this.read=function(a){var b='';for(var c=0;c<a;c++)b+=String.fromCharCode(this.readByte());return b;};this.readUnsigned=function(){var a=this.readBytes(2);return(a[1]<<8)+a[0];};};var g=function(a,b){var c=b.length;var d=0;var e=0x01;var f=[];var g=1<<a;var h=g+1;var i=a+1;var j=[];var k=function(){j=[];i=a+1;for(var b=0;b<g;b++)j[b]={val:b,prv:-1,len:1};j[g]=null;j[h]=null;};var l=function(a){if(a===-1||j[a]===null)return;l(j[a].prv);f.push(j[a].val);};var m;var n;while(c>0){n=m;m=0;for(var o=0;o<i;o++){if(b.charCodeAt(d>>3)&(1<<(d&7)))m|=1<<o;d++;e<<=1;if(e===0x100){e=0x01;c--;}}if(m===g){k();continue;}if(m===h)break;if(m<j.length){if(n!==g){ptr=m;while(j[ptr].prv!=-1)ptr=j[ptr].prv;j.push({val:j[ptr].val,prv:n,len:j[n].len+1});}}else{if(m!==j.length)throw new Error('Invalid LZW code.');ptr=n;while(j[ptr].prv!=-1)ptr=j[ptr].prv;j.push({val:j[ptr].val,prv:n,len:j[n].len+1});}l(m);if(j.length===(1<<i)&&i<12)i++;}return f;};var h=function(a,b){b||(b={});var c=function(b){var c=[];for(var d=0;d<b;d++)c.push(a.readBytes(3));return c;};var f=function(){var b,c;c='';do{b=a.readByte();c+=a.read(b);}while(b!==0);return c;};var h=function(){var f={};f.sig=a.read(3);f.ver=a.read(3);if(f.sig!=='GIF')throw new Error('Not a GIF file.');f.width=a.readUnsigned();f.height=a.readUnsigned();var g=e(a.readByte());f.gctFlag=g.shift();f.colorRes=d(g.splice(0,3));f.sorted=g.shift();f.gctSize=d(g.splice(0,3));f.bgColor=a.readByte();f.pixelAspectRatio=a.readByte();if(f.gctFlag)f.gct=c(1<<(f.gctSize+1));b.hdr&&b.hdr(f);};var i=function(c){var g=function(c){var f=a.readByte();var g=e(a.readByte());c.reserved=g.splice(0,3);c.disposalMethod=d(g.splice(0,3));c.userInput=g.shift();c.transparencyGiven=g.shift();c.delayTime=a.readUnsigned();c.transparencyIndex=a.readByte();c.terminator=a.readByte();b.gce&&b.gce(c);};var h=function(a){a.comment=f();b.com&&b.com(a);};var i=function(c){var d=a.readByte();c.ptHeader=a.readBytes(12);c.ptData=f();b.pte&&b.pte(c);};var j=function(c){var d=function(c){var d=a.readByte();c.unknown=a.readByte();c.iterations=a.readUnsigned();c.terminator=a.readByte();b.app&&b.app.NETSCAPE&&b.app.NETSCAPE(c);};var e=function(a){a.appData=f();b.app&&b.app[a.identifier]&&b.app[a.identifier](a);};var g=a.readByte();c.identifier=a.read(8);c.authCode=a.read(3);switch(c.identifier){case 'NETSCAPE':d(c);break;default:e(c);break;}};var k=function(a){a.data=f();b.unknown&&b.unknown(a);};c.label=a.readByte();switch(c.label){case 0xF9:c.extType='gce';g(c);break;case 0xFE:c.extType='com';h(c);break;case 0x01:c.extType='pte';i(c);break;case 0xFF:c.extType='app';j(c);break;default:c.extType='unknown';k(c);break;}};var j=function(h){var i=function(a,b){var c=new Array(a.length);var d=a.length/b;var e=function(d,e){var f=a.slice(e*b,(e+1)*b);c.splice.apply(c,[d*b,b].concat(f));};var f=[0,4,2,1];var g=[8,8,4,2];var h=0;for(var i=0;i<4;i++)for(var j=f[i];j<d;j+=g[i]){e(j,h);h++;}return c;};h.leftPos=a.readUnsigned();h.topPos=a.readUnsigned();h.width=a.readUnsigned();h.height=a.readUnsigned();var j=e(a.readByte());h.lctFlag=j.shift();h.interlaced=j.shift();h.sorted=j.shift();h.reserved=j.splice(0,2);h.lctSize=d(j.splice(0,3));if(h.lctFlag)h.lct=c(1<<(h.lctSize+1));h.lzwMinCodeSize=a.readByte();var k=f();h.pixels=g(h.lzwMinCodeSize,k);if(h.interlaced)h.pixels=i(h.pixels,h.width);b.img&&b.img(h);};var k=function(){var c={};c.sentinel=a.readByte();switch(String.fromCharCode(c.sentinel)){case '!':c.type='ext';i(c);break;case ',':c.type='img';j(c);break;default:c.type='eof';b.eof&&b.eof(c);break;}if(c.type!=='eof')setTimeout(k,0);};var l=function(){h();setTimeout(k,0);};l();};})(_,Giphy);(function(a,b){b.GifRouter={gifPageOffset:1,xhr:null,getMoreGifs:function(){var b=$.Deferred();var c=[];var d=(this.gifPageOffset>1)?'/page/'+this.gifPageOffset:'/';if(this.gifPageOffset<=1&&window.sessionStorage){var e=window.sessionStorage.getItem('giphy_history');var f=JSON.parse(e);if(a.size(f))c=f;}$.ajax({url:d+'?is=1',type:'GET',data:{json:true},success:function(d){var e=d.data;if(!e||!e.gifs){b.reject();return;}var f=a.shuffle(e.gifs);for(var g=0;g<f.length;g++){var h=f[g];c.push({id:h.id,url:h.url,preview:(h.images&&h.images.fixed_height_small)?h.images.fixed_height_small.url:''});}b.resolve(c);},error:function(){b.reject();}});this.gifPageOffset++;return b.promise();},navigateTo:function(a){if(!a)return;var c=$.Deferred();a=a.replace('http://giphy.com','');a=a.replace(/.*?:\/\//g,'//');if(this.xhr){this.xhr.abort();this.xhr=null;}this.xhr=$.ajax({type:'GET',url:a,success:$.proxy(function(d){var e=$('<div></div>').html(d);var f=e.find('#gif-detail');var g=e.find('title').text();var h={};if(!f.length){c.reject();return;}var i=f.find('#gif-wrap');if(i.length)h.gif=i.html();var j=f.find('#gif-actions-wrapper');if(j.length)h.actions=j.html();var k=f.find('#tags-wrapper');if(k.length)h.tags=k.html();var l=f.find('.gif-figure-wrapper meta');if(l.length){var m=$('<div></div>').append(l);h.metadata=m.html();}if(window.history&&a!==window.location.pathname){document.title=g;window.history.pushState(h,null,a);}c.resolve(h);if(b.Globals)b.Globals.refresh();this.xhr=null;},this),error:function(){c.reject();}});return c.promise();}};})(_,Giphy);(function(a){var b={el:'',name:'',initialize:function(a){a=a||{};this.$el=$(this.el);this.subviews={};this.name=this.name||new Date().getUTCMilliseconds();return this;},listenTo:function(a,b,c){if(!a||!b)return;c=c||this;this.$el.on(a+'.'+this.name,$.proxy(b,c));},listenToEl:function(a,b,c,d){if(!b||!a||!c)return;d=d||this;this.$el.on(b+'.'+this.name,a,$.proxy(c,d));},render:function(){if(!this.$el.length)return;return this;},remove:function(){this.$el.off('.'+this.name);for(var a in this.subviews){var b=this.subviews[a];if(b.hasOwnProperty('remove'))b.remove();}return this;},extend:function(a){$.extend(this,a);}};a.BaseView=b;})(Giphy);(function(){var a=Giphy.Analytics={trackSearchResultsView:function(){$.ajax({type:"post",beforeSend:function(a){a.setRequestHeader("Authorization","ApiKey giphy-website:e0771ed7b244ec9c942bea646ad08e6bf514f51a");},url:"/api/v1/analytics/",data:JSON.stringify({"search_term_encoded":$('#search-term').attr("data-term"),"analytic_type":"view"}),dataType:"application/json",contentType:"application/json"});},fireEvents:function(a,b){_gaq.push(['_trackPageview',a]);if(!b)window.history.pushState("","",a);if(window.pSUPERFLY)window.pSUPERFLY.virtualPage(a,document.title);else{window._sf_async_config.path=a;window._sf_async_config.title=document.title;window._sf_async_config;}_qevents=[];__qc=undefined;$("#quantcast").remove();var c=$('<script async id="quantcast" src="//edge.quantserve.com/quant.js" type="text/javascript">');_qevents.push({qacct:"p-7A3Yj5VenXEQG"});$('body').append(c);}};})(window,Giphy);(function(a){var b=a.CreationApiHelper={apiBaseUrl:'//api.giphy.com/v1',gceBaseUrl:'//rxjthjm1pofte.com',apiKey:'ftOQZt7zJTlrG',postCreateVideo:function(a,b,c){a=a||{};var d=this.apiBaseUrl+'/create/video';a.api_key=this.apiKey;$.ajax({"url":d,"method":"post","beforeSend":function(a){a.setRequestHeader("");},"dataType":"json","data":a,"success":function(a){if(b)b(a);},"error":function(a){if(c)c(a);}});},postCreateSlideshow:function(a,b,c){var d=this.apiBaseUrl+'/create/slideshow';a.api_key=this.apiKey;$.ajax({"url":d,"method":"post","beforeSend":function(a){a.setRequestHeader("");},"dataType":"json","data":a,"success":function(a){if(b)b(a);},"error":function(a){if(c)c(a);}});},pollCreateStatus:function(a,b,c,d){var e=this.apiBaseUrl+'/create/status';var f=_.bind(function(){$.ajax({"url":e,"beforeSend":function(a){a.setRequestHeader("");},"dataType":"json","cache":false,"data":{"api_key":this.apiKey,"job_id":a},"success":function(a){var e=a.data.status;if(e==='STATUS_SUCCESSFUL'||e==='STATUS_FAILED'){if(d)d(a);}else{if(c)c(a);setTimeout(f,b);}}});},this);f();},getVideoInfo:function(a,b,c){$.ajax({type:'GET',dataType:"json",url:this.gceBaseUrl+'/info',data:{url:a},timeout:3000,success:function(a){if(b)b(a);},error:function(a){if(c)c(a);}});}};})(Giphy);(function(a,b){var c={__scroll:function(){if(this.scrollTimeout){clearTimeout(this.scrollTimeout);this.scrollTimeout=null;}this.scrollTimeout=setTimeout(a.bind(this._updateApps,this),300);},_updateApps:function(b){if(!this.$apps.length)return;var c=this.$win.scrollTop();var d=c+(this.$win.height()*0.5);var e=c+this.$win.height()-100;var f=[];this.$apps.each(function(){var a=$(this);var b=a.offset().top;var c=b+a.height();var e=b<d&&c>d;if(a.hasClass('snoozin')&&e)f.push(a.find('.app-screenshot'));a.toggleClass('snoozin',!e);});if(!b&&f.length)this._powerPoint(a.last(f));},_powerPoint:function(b){var c=$(b);if(!c.length)return;if(this.gloveTimeout){this.$powerglove.removeClass('boop');clearTimeout(this.gloveTimeout);}var d=Math.round(Math.random()*180);var e=c.offset();var f=(e.left>this.$win.width()*0.5)?-1:1;e.top-=this.$win.scrollTop();d*=f;this.$powerglove.css(a.extend(e,{'-webkit-transform':'rotate('+d+'deg) translate3d(0, 0, 0)','-moz-transform':'rotate('+d+'deg) translate3d(0, 0, 0)','-ms-transform':'rotate('+d+'deg) translate3d(0, 0, 0)','transform':'rotate('+d+'deg) translate3d(0, 0, 0)'}));this.$powerglove.addClass('boop');this.gloveTimeout=setTimeout(a.bind(function(){this.$powerglove.removeClass('boop');},this),220);},initialize:function(a){a=a||{};this.$win=$(window);this.$el=$(a.el||'.apps-page');this.$apps=$();this.$powerglove=$();this.scrollTimeout=null;this.gloveTimeout=null;this.render();return this;},render:function(){if(!this.$el.length)return;this.$apps=this.$el.find('.app');this.$powerglove=this.$el.find('.powerglove');if(this.$el.outerHeight(true)>this.$win.height()){this._updateApps(true);this.$win.on('scroll.apps-landing',a.throttle(a.bind(this.__scroll,this),100));}},remove:function(){if(!this.$el.length)return;this.$win.off('.apps-landing');}};b.AppsLanding=c;})(_,Giphy);(function(){var a=Giphy.Backgrounds={setRandomBackground:function(){if($("#animated-background-wrapper").length>0)$.ajax({type:"get",url:"/ajax/animated-backgrounds/",success:function(a){Giphy.Backgrounds.createBackgrounds(a);}});},createBackgrounds:function(a){var b=a.result;var c=b[Math.floor(Math.random()*b.length)];var d=$('<video></video>').attr({id:"animated-background",preload:"auto",autoplay:true,loop:"loop"}).css('opacity',0);var e=$('<source></source>').attr({src:c.webm_url,type:"video/webm"});var f=$('<source></source>').attr({src:c.mp4_url,type:"video/mp4"});d.append(f);d.append(e);$("#animated-background-wrapper").append(d);var g=$("#attribution");g.find('.byline').attr({"href":c.artist.profile_url});g.find('.avatar').css({"background-image":"url('"+c.artist.avatar_url+"')"});g.find('.username-text').text(c.artist.name);d.on('canplaythrough',function(){d.fadeTo("slow",0.6);g.css({opacity:1});});}};})(window,Giphy);(function(){var a=Giphy.Browsebar={init:function(){this.nextDisplayIndex=0;this.currGifIndex=-1;this.BrowsebarTimeout=undefined;this.CloseAnimationTimeout=undefined;this.DISPLAY_TIMEOUT_DELAY;this.CLOSE_TIMEOUT_DELAY=200;this.pastDisplayIndex=-1;},attachBrowsebarHovers:function(){var b=$("#browsebar a");var c=0;b.mouseenter(function(b){var c=$(this);$("#browsebar a").eq(a.pastDisplayIndex).removeClass("open");$(this).addClass("open");});b.mouseleave(function(a){var b=$(this);setTimeout(closeAnimation=function(){b.removeClass("open");},200);});}};})(window,Giphy);(function(a,b){var c={makeYouTubeUrlWithId:function(a){return 'http://www.youtube.com/watch?v='+a;},makeVimeoUrlWithId:function(a){return 'http://vimeo.com/'+a;},__addedFile:function(c,d){this.isVine=false;if(d.type==='url'&&d.name.indexOf('youtubeId=')>-1){var e=a.last(d.name.split('youtubeId='));Giphy.CreationApiHelper.getVideoInfo('http://www.youtube.com/watch?v='+e,a.bind(function(a){if(a.uploader&&a.uploader.toLowerCase()=='mlb'){Giphy.CreationErrors.show('VIDEO_BLOCKED');Giphy.CreationTools.expandMenu();}else{if(a.width&&a.height){var b=a.width/a.height;var c=this.$videoPreview.height();var d=c*b;if(d<this.minWidth){d=this.minWidth;c=d/b;}if(d>this.$videoPreview.width()){d=this.$videoPreview.width();c=d/b;}}this.renderPreview({type:'youtube',id:e,height:c,width:d});}},this),a.bind(function(a){Giphy.CreationErrors.show('SOMETHING_WENT_WRONG');},this));this.optionalFields.$sourcePostUrl.val(this.makeYouTubeUrlWithId(e));}else if(d.type==='url'&&d.name.indexOf('vimeoId=')>-1){var f=a.last(d.name.split('vimeoId='));this.renderPreview({type:'vimeo',id:f});this.optionalFields.$sourcePostUrl.val(this.makeVimeoUrlWithId(f));}else{this.isVine=Giphy.Utils.isVineUrl(d.name);if(d.type==='url'&&this.isVine){Giphy.CreationApiHelper.getVideoInfo(d.name,a.bind(function(a){if(a.url)this.renderPreview({type:'video',src:a.url,extension:b.Utils.getExtension(a.url)});},this),a.bind(function(a){Giphy.CreationErrors.show('SOMETHING_WENT_WRONG');},this));this.optionalFields.$sourcePostUrl.val(d.name);}else this.renderPreview({type:'video',src:(d.type==='url')?d.name:window.URL.createObjectURL(d),extension:b.Utils.getExtension(d.name)});}},__previewTimeUpdate:function(a,b){var c=b/this.duration*100;this.$durationSlider.trigger('sliderplayhead',c);},__previewReady:function(c,d){if(d>this.maxVideoLength){var e=b.Utils.formatTimeObject(this.maxVideoLength);var f='';if(e.h)f+=e.h+' hours';if(e.m){if(f.length)f+=', ';f+=e.m+' minutes';}if(e.s){if(f.length)f+=', ';f+=e.s+' seconds';}var g='Video must be '+f+' or less.';b.CreationErrors.show('VIDEO_TOO_LONG',g);b.Events.trigger('uploadbutton:error',g);return;}b.Events.trigger('uploadbutton:reset');this.$videoPreview.removeClass('loading');this.$controls.removeClass('waiting');this.videoDuration=d;if(this.subviews.startTime){this.subviews.startTime.remove();this.subviews.startTime=null;}if(this.subviews.duration){this.subviews.duration.remove();this.subviews.duration=null;}this.subviews.startTime=new b.TimeControl({el:this.$startTime,maxTime:this.videoDuration});var h=this.$durationSlider.data();var i=h.minValue||1;var j=h.maxValue||10;this.subviews.duration=new b.TimeControl(a.extend(this.$duration.data(),{el:this.$duration,minTime:i,maxTime:Math.min(this.videoDuration,j)}));if(this.isVine)a.defer(a.bind(function(){this.$durationSlider.trigger('update',{value:j});},this));},__startTimeChange:function(a,b){b=b||0;this.startTime=b;if(this.subviews.preview)this.subviews.preview.updateTime(this.startTime,this.duration);},__durationChange:function(a,b){b=b||0;this.duration=b;this.$startTimeSlider.trigger('sliderduration',this.duration);if(this.subviews.preview)this.subviews.preview.updateTime(this.startTime,this.duration,true);},_reset:function(){this.startTime=0;this.duration=this.originalDuration;if(this.subviews.preview){this.subviews.preview.remove();this.subviews.preview=null;}this.$videoPreview.css({height:'',width:''});},_cacheSelectors:function(){this.$videoPreview=this.$el.find('.video-placeholder');this.$controls=this.$el.find('.video-controls');this.$startTime=this.$el.find('.start-time-controls');this.$duration=this.$el.find('.duration-controls');this.$uploadButton=this.$el.find('#upload-gif-button');this.$startTimeSlider=this.$el.find('.start-time-slider');this.$durationSlider=this.$el.find('.duration-slider');},__submit:function(){this.filePortal.submit();},initialize:function(a){a=a||{};this.$el=$(a.el);this.subviews={};this.maxDuration=10;this.originalDuration=3;this.duration=this.originalDuration;this.startTime=0;this.videoDuration=0;this.maxVideoSize=536870912;this.maxVideoLength=900;this.filePortal=null;this.optionalFields=a.optionalFields;this.render();},render:function(){if(!this.$el.length)return;this._cacheSelectors();this.captionControl=b.CreationCaptionControl;this.captionControl.initialize($('.caption-control'),$('.video-placeholder'),{});this.filePortal=b.FilePortalGifMaker;this.filePortal.gifMakerView=this;this.filePortal.initialize({url:b.CreationApiHelper.apiBaseUrl+'/create/video',fileTypes:['video/*','youtube','vine','vimeo'],replaceFile:true,maxFiles:1,maxVideoLength:this.maxVideoLength,maxTotalFilesize:100,defaultTags:'giphygifmaker'});this.$el.on('timeupdate.gif-maker','.start-time-controls',a.throttle(a.bind(this.__startTimeChange,this),100));this.$el.on('timeupdate.gif-maker','.duration-controls',a.throttle(a.bind(this.__durationChange,this),300));b.Events.on('preview:ready',this.__previewReady,this);b.Events.on('fileportal:added',this.__addedFile,this);b.Events.on('optionalfields:upload',this.__submit,this);b.Events.on('preview:currentTimeUpdate',this.__previewTimeUpdate,this);},renderPreview:function(a){a=a||{};if(!this.$videoPreview.length)return;this._reset();if(a.height)this.$videoPreview.height(a.height+'px');if(a.width)this.$videoPreview.width(a.width+'px');if(a.type==='youtube')this.subviews.preview=b.YoutubePreview.initialize({el:this.$videoPreview,id:a.id,startTime:this.startTime,endTime:this.endTime});else if(a.type==='vimeo')this.subviews.preview=b.VimeoPreview.initialize({el:this.$videoPreview,id:a.id,startTime:this.startTime,endTime:this.endTime});else this.subviews.preview=b.VideoPreview.initialize({el:this.$videoPreview,src:a.src,extension:a.extension,startTime:this.startTime,endTime:this.endTime});this.$videoPreview.removeClass('waiting').addClass('loading').focus();},remove:function(){if(!this.$el.length)return;this.$el.off('.gif-maker');b.Events.off('preview:ready');a.each(this.subviews,function(a){a.remove();a=null;});if(this.$videoPreview.length)this.$videoPreview.addClass('waiting');}};b.GifMaker=c;})(_,Giphy);(function(a,b){var c={__onScroll:function(){var a=this.$win.scrollTop();var b=this.$helpDetails.offset().top;var c=b+this.$helpDetails.height();if(a>b&&a<c)this.$backToTop.show();else this.$backToTop.hide();},__beforeUnload:function(a){if(this.isBusy){a=a||window.event;if(a)a.returnValue=this.beforeLeaveMessage;return this.beforeLeaveMessage;}},__loginClick:function(){this.isBusy=false;},__uploadComplete:function(){this.isBusy=false;},initialize:function(a){a=a||{};this.$win=$(window);this.$body=$('body');this.$el=$(a.el||'.creation-tools');this.subviews={};this.transitionEnd=b.Utils.transitionEnd();this.isBusy=false;this.isOpen=false;this.submitUrl=a.submitUrl||'';this.featuredGifs=a.featuredGifs||[];this.beforeLeaveMessage='You\'re going to abandon this sweet GIF!';this.render();},_cacheSelectors:function(){this.$help=this.$el.find(".help-callout");this.$page=this.$el.find('.creation-tools-page');this.$mainGrid=this.$el.find(".creation-tools-main");this.$mainMenu=this.$el.find(".creation-tools-menu");this.$showHelp=this.$el.find('.show-help');this.$hideHelp=this.$el.find('.hide-help');this.$helpDetails=this.$el.find('.help-details');this.$backToTop=this.$helpDetails.find('.back-to-top');this.$featuredGifs=this.$el.find('.featured-gifs');},render:function(){if(!this.$el.length)return;this._cacheSelectors();var c;if(this.$el.find('.gif-maker-page').length)c="gifmaker";else if(this.$el.find('.create-slideshow-page').length)c="slideshow";else if(this.$el.find('.upload-page').length)c="upload";this.subviews.optionalFields=b.CreationOptionalFields.initialize({"method":c});if(c=="upload")this.subviews.upload=b.Upload.initialize({el:this.$el.find('.upload-page'),submitUrl:this.submitUrl});if(c=="gifmaker")this.subviews.gifMaker=b.GifMaker.initialize({el:this.$el.find('.gif-maker-page'),optionalFields:this.subviews.optionalFields,submitUrl:this.submitUrl});if(c=="slideshow")this.subviews.slideshow=b.Slideshow.initialize({el:this.$el.find('.create-slideshow-page'),optionalFields:this.subviews.optionalFields,submitUrl:this.submitUrl});if(!a.isEmpty(this.featuredGifs))this.subviews.featuredGifs=new b.CreationToolsFeaturedGifs({el:this.$featuredGifs,gifs:this.featuredGifs});this.$win.on('beforeunload.creation-tools',a.bind(this.__beforeUnload,this));this.$body.on('click.creation-tools','#login-button',a.bind(this.__loginClick,this));this.$win.on('scroll.creation-tools',a.bind(this.__onScroll,this));this.$showHelp.on('click',a.bind(this.expandHelp,this));this.$hideHelp.on('click',a.bind(this.condenseHelp,this));this.$backToTop.on('click',a.bind(this.backToTop,this));b.Events.on('optionalfields:complete',this.__uploadComplete,this);b.Events.on('fileportal:success',this.__uploadComplete,this);},remove:function(){a.each(this.subviews,function(a){a.remove();a=null;});},condenseMenu:function(){if(this.isOpen)return;this.isBusy=true;this.isOpen=true;var b=a.bind(function(){if(this.$el.hasClass('hide-welcome'))return;this.$el.addClass('hide-welcome is-hiding-welcome');this.$page.one(this.transitionEnd,a.bind(function(){this.$el.removeClass('is-hiding-welcome');},this));},this);if(this.$mainGrid.length)$('html, body').animate({scrollTop:this.$mainGrid.offset().top-5},200,b);else b();if(this.subviews.featuredGifs)this.subviews.featuredGifs.hide();},expandMenu:function(){if(!this.isOpen)return;this.isBusy=false;this.isOpen=false;this.$el.addClass('is-hiding-welcome').removeClass('hide-welcome');this.$page.one(this.transitionEnd,a.bind(function(){this.$el.removeClass('is-hiding-welcome');},this));if(this.subviews.featuredGifs)this.subviews.featuredGifs.show();},condenseHelp:function(a){a.preventDefault();this.$showHelp.show();this.$hideHelp.hide();this.$helpDetails.hide();},expandHelp:function(a){this.$showHelp.hide();this.$hideHelp.show();this.$helpDetails.show();},backToTop:function(){var a=this.$helpDetails.offset().top;$('html, body').animate({scrollTop:a},200);}};b.CreationTools=c;})(_,Giphy);(function(a,b){var c={__toggleList:function(a){a.preventDefault();this.$slides.removeClass('grid');},__toggleGrid:function(a){a.preventDefault();this.$slides.addClass('grid');},__addedFile:function(c,d){if(!d)return;b.CreationTools.condenseMenu();this._resetPreview();if(d.type==='url'){this._processUrl(d);return;}var e=new FileReader();e.onloadend=a.bind(function(){var a=new Uint8Array(e.result);this._processGif(d,a);},this);if(d.type.indexOf('image/gif')>-1)e.readAsArrayBuffer(d);else this._loadImg(d);},__removedFile:function(b,c){this._resetPreview();if(c&&this.slides[c.id])delete this.slides[c.id];this._updatePreviewSize();this._checkTotalDuration();if(a.size(this.slides))a.defer(a.bind(this.updatePreview,this));},__delay:function(a,b){if(b.percent>this.currentSliderPercent)this.sliderDirection=1;else if(b.percent<this.currentSliderPercent)this.sliderDirection=-1;else this.sliderDirection=0;this.currentSliderPercent=b.percent;this.stillImageDuration=this.__duration(b.percent);this._updateSpeedIcons();this._checkTotalDuration();},__sliderStart:function(){this.isAnimatingIcons=true;this._updateSpeedIcons();},__sliderStop:function(){this.sliderDirection=0;this.isAnimatingIcons=false;this.$speedIcons.removeClass('fast-speed slow-speed');},__duration:function(a){return this.minDuration+parseInt(a*(this.maxDuration-this.minDuration));},_updateSpeedIcons:function(){if(!this.isAnimatingIcons)return;this.$speedIcons.toggleClass('fast-speed',this.sliderDirection===-1).toggleClass('slow-speed',this.sliderDirection===1);},_loadImg:function(b){var c={canvas:true,maxWidth:600};loadImage.parseMetaData(b,a.bind(function(d){if(d.exif)c.orientation=d.exif.get('Orientation');loadImage(b,a.bind(function(a){this._processBinary(b,a.getContext('2d').getImageData(0,0,a.width,a.height),a.toDataURL('image/png'));},this),c);},this));},_processGif:function(c,d){if(!c)return;var e=d||c.name;if(!d&&e.indexOf('giphy.com')<0){var f=b.Utils.urlRE.exec(e);if(f&&f.length>1)e=this.gifProxyUrl+f[1].replace(/.*?:\/\//g,"");}b.Events.trigger('slideshow:processing',{id:c.id,name:c.name,isComplete:false});var g=a.bind(function(d){var e=[];var f=d.frames.length/(d.duration*0.001);if(a.size(d.frames)>1){if(f>16.7){var g=0;var h=[];a.each(d.frames,function(a){for(i=0;i<Math.round(a.delay*0.1);i++)h.push({delay:60,width:a.width,height:a.height,imageData:a.data});});a.each(h,function(a,b){if(b%6==0)e.push(a);});}else a.each(d.frames,function(a){e.push({delay:a.delay,width:a.width,height:a.height,imageData:a.data});});this.gifDurations[c.id]=d.duration;}else{var i=d.frames[0];e.push({width:i.width,height:i.height,imageData:i.data});}b.Events.trigger('slideshow:processing',{id:c.id,name:c.name,isComplete:true});this._updateListItemPreview(c.id,d.still);this.slides[c.id]=e;this._processingComplete();},this);if(d)b.GifParser.loadBinary(e).done(g);else b.GifParser.loadUrl(e).fail(a.bind(function(){Giphy.CreationErrors.show("SOMETHING_WENT_WRONG");this.filePortal.files().remove(c);},this)).done(g);},_processBinary:function(a,b,c){if(!a)return;this.slides[a.id]=[{width:b.width,height:b.height,imageData:b}];this._updateListItemPreview(a.id,c||a.name);this._processingComplete();},_processUrl:function(c){if(!c)return;var d=c.name.indexOf('.gif')>-1;if(d){this._processGif(c);return;}else{var e=this.gifProxyUrl+c.name.replace(/.*?:\/\//g,'');b.Utils.preloadImage(e).done(a.bind(function(a){this.slides[c.id]={url:a.src,width:a.naturalWidth,height:a.naturalHeight};this._updateListItemPreview(c.id,a.src);this._processingComplete();},this));}},_processingComplete:function(){this.updatePreview();this._updatePreviewSize();var b=a.filter(this.slides,function(a){return a.length>1;});this.$delaySlider.toggleClass('hidden',a.size(b)===a.size(this.slides));this._checkTotalDuration();},_updateListItemPreview:function(a,b){var c=this.$slides.find('#'+a+' .upload-preview');if(c.length)c.css('background-image','url('+b+')');},_updatePreviewSize:function(){var b=0;var c=0;if(a.size(this.slides)>0){a.each(this.slides,function(d){if(a.isArray(d)){a.each(d,function(a){if(a.width>b)b=a.width;if(a.height>c)c=a.height;});}else{if(d.width>b)b=d.width;if(d.height>c)c=d.height;}});var d=b/c;b=this.maxWidth;c=this.maxWidth/d;if(c>this.maxHeight){c=this.maxHeight;b=this.maxHeight*d;}this.previewCanvas.width=b;this.previewCanvas.height=c;this.$el.addClass('ready');}else{this.previewCanvas.width=this.maxWidth;this.previewCanvas.height=this.maxHeight;this.$el.removeClass('ready');}this.$preview.css({height:c,width:b});},_resetPreview:function(){clearTimeout(this.frameTimeout);clearTimeout(this.timer);this.$preview.empty().removeClass('active');this.previewContext.clearRect(0,0,this.previewCanvas.width,this.previewCanvas.height);this.previewImage.src='';this.$delaySlider.toggleClass('hidden',this.filePortal.isOnlyGifs());},_preview:function(){var b=$.Deferred();var c=this.filePortal.files();if(c.length()>=1){var d=c.cycle();var e=this.slides[d.id]||{};var f=this;this.$preview.addClass('active');this.previewContext.clearRect(0,0,this.previewCanvas.width,this.previewCanvas.height);this.previewImage.src='';if(a.isArray(e)){var g=e.length;var h=0;var i=document.createElement('canvas');var j=i.getContext('2d');var k=function(){var a=e[h];clearTimeout(f.frameTimeout);var c=a.width/a.height;var d=f.previewCanvas.width;var l=d/c;var m=0;var n=0;if(l>f.previewCanvas.height){l=f.previewCanvas.height;d=l*c;}m=(f.previewCanvas.width-d)*0.5;n=(f.previewCanvas.height-l)*0.5;i.width=a.width;i.height=a.height;j.clearRect(0,0,f.previewCanvas.width,f.previewCanvas.height);j.putImageData(a.imageData,0,0);f.previewContext.clearRect(0,0,f.previewCanvas.width,f.previewCanvas.height);f.previewContext.drawImage(i,m,n,d,l);if(h<g-1){f.frameTimeout=setTimeout(k,e[h].delay||f.stillImageDuration);h++;}else b.resolve(a.delay||f.stillImageDuration);};this.$preview.html(this.previewCanvas);k();}else if(a.has(e,'url')){var l=e.width/e.height;var m=this.$preview.width();var n=this.$preview.height();this.previewImage.src=e.url;this.previewImage.width=m;this.previewImage.height=this.previewImage.width/l;if(this.previewImage.height>n){this.previewImage.height=n;this.previewImage.width=n*l;}this.$preview.html(this.previewImage);b.resolve();}else b.resolve(1);}else b.resolve(500);return b.promise();},_checkTotalDuration:function(){var b=0;var c=a.flatten(a.values(this.slides));if(!c.length)return;a.each(c,a.bind(function(a){b+=a.delay||this.stillImageDuration;},this));var d=b/1000;if(d>this.maxTotalDuration)this._showDurationError(Math.ceil(d-this.maxTotalDuration));else this._resetDurationError();},_showDurationError:function(a){var b=Giphy.CreationErrors.showDurationError('GIF',a+' seconds');this.$uploadButton.addClass('error');this.$delaySlider.addClass('error');this.$uploadButton.text(b);this.isTooLong=true;},_resetDurationError:function(){if(!this.isTooLong)return;this.$uploadButton.removeClass('error').text(this.$uploadButton.data('label'));this.$delaySlider.removeClass('error');this.isTooLong=false;Giphy.CreationErrors.showResolved();},__submit:function(){this.filePortal.submit();},_cacheSelectors:function(){this.$preview=this.$el.find(".slideshow-images");this.$slides=this.$el.find("#sortable");this.$delaySlider=this.$el.find('.slideshow-delay');this.$duration=this.$el.find("#delay");this.$speedIcons=this.$el.find('.speed-icons');this.$slowSpeedIcon=this.$el.find('.speed-icons .speed-icon.slow');this.$fastSpeedIcon=this.$el.find('.speed-icons .speed-icon.fast');this.$uploadButton=$('#upload-gif-button');},initialize:function(a){a=a||{};this.$el=$(a.el);this.previewImage=document.createElement('img');this.previewCanvas=document.createElement('canvas');this.previewContext=this.previewCanvas.getContext('2d');this.optionalFields=a.optionalFields;this.gifProxyUrl='//i.giphy.com/fetch?gif=';this.currentSlide=0;this.minDuration=100;this.maxDuration=3000;this.maxTotalDuration=14.9;this.maxWidth=560;this.maxHeight=322;this.stillImageDuration=this.__duration(0.5);this.currentSliderPercent=0;this.isAnimatingIcons=false;this.sliderDirection=0;this.frameTimeout=null;this.slides={};this.gifDurations={};this.timer=null;this.isTooLong=false;this.submitUrl=a.submitUrl||'';this.render();},render:function(){if(!this.$el.length)return;this._cacheSelectors();this.previewCanvas.width=this.maxWidth;this.previewCanvas.height=this.maxHeight;this.captionControl=b.CreationCaptionControl;this.captionControl.initialize($('.caption-control'),$('.slideshow-preview'),{});this.filePortal=b.FilePortalSlideshow;this.filePortal.slideshowView=this;this.filePortal.initialize({url:this.submitUrl,sortableList:this.$slides,fileTypes:['image/gif','image/png','image/jpeg'],maxTotalFilesize:100,uploadMultiple:true,parallelUploads:50,defaultTags:'giphyslideshow',maxFiles:50,minFiles:2});this.$el.on("sliderupdate.slideshow","#delay",a.throttle(a.bind(this.__delay,this),300));this.$el.on('sliderstart.slideshow','#delay',a.bind(this.__sliderStart,this));this.$el.on('sliderstop.slideshow','#delay',a.bind(this.__sliderStop,this));this.$el.on('click.slideshow','#toggle-list',a.bind(this.__toggleList,this));this.$el.on('click.slideshow','#toggle-grid',a.bind(this.__toggleGrid,this));b.Events.on('fileportal:added',this.__addedFile,this);b.Events.on('fileportal:removed',this.__removedFile,this);b.Events.on('optionalfields:upload',this.__submit,this);},updatePreview:function(){clearTimeout(this.frameTimeout);clearTimeout(this.timer);this._preview().done(a.bind(function(b){b=b||this.stillImageDuration;this.timer=setTimeout(a.bind(this.updatePreview,this),b);},this));},template:a.template('<div class="preview-slide" data-id="<%- id %>" style="background-image:url(<%- url %>)"></div>')};b.Slideshow=c;})(_,Giphy);(function(a,b){var c={__captionKeydown:function(a){var b=this.$captionInput.val();if(a.which===27){a.preventDefault();this._updateCaption(true);return false;}},__captionInput:function(a){var b=this.$captionInput.val();if(b.trim().length>0&&!this.hasCaption)this._updateCaption();else if(!b.trim().length&&this.hasCaption)this._updateCaption(true);},__captionRemove:function(a){a.preventDefault();this._updateCaption(true);},__captionStyleUpdate:function(a,b){this.currentCaptionStyle=b;if(this.hasCaption&&this.caption)this.caption.updateStyle(b);},_updateCaption:function(a){a=a||false;if(this.hasCaption){this.$captionInput.val('');this.$controls.removeClass('has-caption');this.hasCaption=false;this.caption.remove();delete this.caption;}else if(!a){this.hasCaption=true;this.$controls.addClass('has-caption');this.caption=new b.CreationCaptionPreview({el:this.$previewCanvas,input:this.$captionInput,style:this.currentCaptionStyle});}},getCaption:function(){if(!this.caption)return '';var b=this.caption.getImage();if(b.indexOf('data:image/png;base64,')>-1)b=a.last(b.split('data:image/png;base64,'));return b;},_cacheSelectors:function(){this.$captionInput=this.$controls.find('#caption-input');this.$captionStyles=this.$controls.find('.caption-styles');},initialize:function(a,b,c){this.$controls=$(a);this.$previewCanvas=$(b);this.captionStyles=null;this.hasCaption=false;this.currentCaptionStyle=null;this.render();this._cacheSelectors();},render:function(){this.captionStyles=new b.CreationCaptionStyles({el:this.$controls.find('.caption-styles')});this.$controls.on('keydown.caption-control','#caption-input',a.bind(this.__captionKeydown,this));this.$controls.on('input.caption-control','#caption-input',a.bind(this.__captionInput,this));this.$controls.on('click.caption-control','.remove-caption',a.bind(this.__captionRemove,this));b.Events.on('captionpreview:remove',this.__captionRemove,this);b.Events.on('captionstyles:update',this.__captionStyleUpdate,this);}};b.CreationCaptionControl=c;})(_,Giphy);(function(a,b){var c=function(a){this.initialize(a);};c.prototype={__mousedown:function(a){var b=$(a.target).hasClass('dragger');if(!this.isEditing||b){if(this.isEditing)this._stopEdit();this._startDrag(a.pageX,a.pageY,b);}},__mousemove:function(a){if(this.isResizing){var b=this.$resize.offset();var c=a.pageX-b.left;var d=a.pageY-b.top;this.resizeText(c+5,d+5);}else{var b=this.$el.offset();var e=(a.pageX-b.left)-this.startOffset.left;var f=(a.pageY-b.top)-this.startOffset.top;this.positionText(e,f);}},__mouseup:function(){this._stopDrag();},__doubleClick:function(){this._stopDrag();this._startEdit();},__input:function(a){this.refreshText($(a.currentTarget).val());},__inputBlur:function(a){var b=$(a.currentTarget).val();this._stopEdit();if(!b.trim().length)this.remove();},_startDrag:function(b,c,d){b=b||0;c=c||0;d=d||false;var e=this.$resize.offset();this.startOffset={left:b-e.left,top:c-e.top,width:this.$resize.outerWidth(),height:this.$resize.outerHeight()};this.isDragging=!d;this.isResizing=d;this.$body.on('mousemove.caption-preview',a.bind(this.__mousemove,this));this.$body.on('mouseup.caption-preview',a.bind(this.__mouseup,this));this.$textarea.attr('readonly','readonly');this.$wrapper.toggleClass('dragging',this.isDragging).toggleClass('resizing',this.isResizing);},_stopDrag:function(){this.$wrapper.removeClass('dragging resizing');this.$textarea.removeAttr('readonly');this.$body.off('.caption-preview');this.isDragging=false;this.isResizing=false;this.startOffset={};},_startEdit:function(){this.isEditing=true;this.$wrapper.addClass('editing');this.$textarea.select();},_stopEdit:function(){if(!this.isEditing)return;this.isEditing=false;this.$wrapper.removeClass('editing');this.$textarea.blur();},_resizeTextarea:a.throttle(function(){if(!this.$textarea.length)return;var a=0;var b=this.$resize.height();var c=this.$resize.width();this.$textarea.css({fontSize:this.maxFontSize,height:''});a=this.$textarea.get(0).scrollHeight;if(a>b){var d=this.maxFontSize;while(d>this.minFontSize){d--;this.$textarea.css('font-size',d);if(this.$textarea.get(0).scrollHeight<b)break;}this.fontSize=d;this.$textarea.css('font-size',this.fontSize);a=this.$textarea.get(0).scrollHeight;}this.$textarea.css({height:a,top:(b-a)*0.5});},50),_updateScale:function(){if(!this.$el.length)return;var a=this.$el.data();var b=a.videoWidth||this.$el.width();var c=a.videoHeight||this.$el.height();this.maxFontSize*=a.scale||1;this.minFontSize*=a.scale||1;if(this.canvasText)this.canvasText.updateScale(b/this.$el.width());},_configure:function(){this.maxFontSize=40;this.minFontSize=10;this.fontSize=this.maxFontSize;this.canvas=null;this.context=null;this.maxHeight=0;this.maxWidth=0;this.isDragging=false;this.isResizing=false;this.isEditing=false;this.startOffset={};this.scale=1;this.canvasText=null;},_cacheSelectors:function(){this.$body=$('body');this.$input=$(this.options.input);this.$wrapper=this.$el.find('.caption-preview-wrapper');this.$resize=this.$el.find('.caption-resize');this.$textarea=this.$el.find('.caption-text');this.$canvas=this.$el.find('.caption-canvas');},initialize:function(a){this.options=a||{};this.$el=$(this.options.el||'');this._configure();this.render();},render:function(){if(!this.$el.length)return;this.$el.append(this.template());this._cacheSelectors();this.maxHeight=this.$el.height();this.maxWidth=this.$el.width();this.canvas=this.$canvas.get(0);this.context=this.canvas.getContext('2d');this.$el.on('mousedown.caption-preview','.caption-resize',a.bind(this.__mousedown,this));this.$el.on('dblclick.caption-preview','.caption-resize',a.bind(this.__doubleClick,this));this.$el.on('input.caption-preview','.caption-text',a.bind(this.__input,this));this.$el.on('blur.caption-preview','.caption-text',a.bind(this.__inputBlur,this));this.$el.on('click.caption-preview','.remove-button',a.bind(this.remove,this));this.$input.on('input.caption-preview',a.bind(this.__input,this));this.$input.on('blur.caption-preview',a.bind(this.__inputBlur,this));this.canvasText=new b.CreationCaptionPreviewCanvas({el:this.$canvas,textarea:this.$textarea,scale:1});this._updateScale();this.refreshText();this.positionText();if(this.options.style)this.updateStyle(this.options.style);},positionText:function(b,c){if(!this.$resize.length)return;var d=this.$resize.offset();var e=this.$resize.outerHeight();var f=this.$resize.outerWidth();b=a.isUndefined(b)?d.left:b;c=a.isUndefined(c)?d.top:c;var g=Math.max(b,0);var h=Math.max(c,0);if(g+f>this.maxWidth)g=this.maxWidth-f;if(h+e>this.maxHeight)h=this.maxHeight-e;this.$resize.css({left:g,top:h});},resizeText:function(a,b){if(!this.$resize.length)return;var c=this.$resize.position();a=Math.min(a||this.$resize.outerWidth(),this.maxWidth);b=Math.min(b||this.$resize.outerHeight(),this.maxHeight);if(c.left+a>this.maxWidth)a=this.maxWidth-c.left;if(c.top+b>this.maxHeight)b=this.maxHeight-c.top;this.$resize.css({height:b,width:a});this.refreshText();},refreshText:function(b){if(!this.$input.length||!this.$textarea.length)return;if(a.isUndefined(b))b=this.$textarea.val()||this.$input.val();this.$input.val(b);this.$textarea.val(b);this._resizeTextarea();if(this.canvasText)this.canvasText.update();},getImage:function(){if(!this.canvasText)return;var a=this.$el.offset();var b=this.$textarea.offset();return this.canvasText.save({width:this.maxWidth,height:this.maxHeight,left:b.left-a.left,top:b.top-a.top});},updateStyle:function(a){this.$textarea.attr('data-style',a.style);switch(a.style){case 'meme':this.maxFontSize=70;break;case 'subtitle':this.maxFontSize=20;break;default:this.maxFontSize=40;break;}if(this.canvasText)this.canvasText.updateStyle(a);this.refreshText();},remove:function(){if(!this.$el.length)return;this.$el.off('.caption-preview');if(this.$input.length)this.$input.off('.caption-preview');if(this.$wrapper.length)this.$wrapper.remove();if(this.canvasText)this.canvasText.remove();b.Events.trigger('captionpreview:remove');},template:a.template(['<div class="caption-preview-wrapper" width="100%" height="100%">','<div class="caption-resize">','<textarea class="caption-text" wrap="hard" rows="1"></textarea>','<canvas class="caption-canvas"></canvas>','<div class="dragger"></div>','<div class="remove-button button red"><i class="ss-icon ss-delete"></i></div>','</div>','</div>'].join(""))};b.CreationCaptionPreview=c;})(_,Giphy);(function(a,b){var c=function(a){this.initialize(a);};c.prototype={_drawText:function(a,b){var c=this.canvas.width*0.5;var d=this.fontSize/10;var e=d/2;b=b||0;a=String(a||'').trim();if(this.currentStyle==='default'){this.context.fillStyle='rgba(0, 0, 0, 0.5)';this.context.strokeStyle='rgba(0, 0, 0, 0.5)';this.context.lineWidth=e;this.context.lineJoin='round';this.context.fillText(a,c+d,b+d);this.context.strokeText(a,c+d,b+d);}else if(this.currentStyle==='subtitle'&&!this.isDark){this.context.shadowColor='rgba(0, 0, 0, 0.5)';this.context.shadowOffsetX=0;this.context.shadowOffsetY=0;this.context.shadowBlur=d*2;}this.context.fillStyle=this.fontColor;this.context.strokeStyle=this.isDark?'#C9C9C9':'#333';this.context.lineWidth=d;this.context.lineJoin='round';this.context.strokeText(a,c,b);this.context.fillText(a,c,b);},_updateText:function(){if(!this.$textarea.length)return;var b=String(this.$textarea.val()||"").trim();var c=parseInt(this.$textarea.css('line-height'),10)*this.scale;var d=[];var e='';var f=0;var g=0;if(this.$textarea.css('text-transform')==='uppercase')b=b.toUpperCase();this.fontSize=parseInt(this.$textarea.css('font-size'),10)*this.scale;this.context.clearRect(0,0,this.canvas.width,this.canvas.height);this.canvas.width=this.$textarea.width()*this.scale;this.canvas.height=this.$textarea.height()*this.scale;this.context.textAlign='center';this.context.textBaseline='hanging';this.context.font=this.fontStyle+' '+this.fontWeight+' '+this.fontSize+'px '+this.font+', sans-serif';f=(c-this.fontSize)*0.5;a.each(b.split('\n'),function(a,b){d=d.concat(a.trim().split(' '));d.push('\n');});for(var h=0;h<d.length;h++){var i=((h>0)?' ':'')+d[h];var j=this.context.measureText(i);var k=d[h]==='\n';if(k||g+j.width>this.canvas.width){this._drawText(e,f);f+=c;g=0;e='';}if(!k){e+=i;g+=j.width;if(h===d.length-1)this._drawText(e,f);}}},_configure:function(){this.$el=$(this.options.el||'');this.$textarea=$(this.options.textarea||'');this.scale=this.options.scale||1;this.fontSize=0;this.font='NexaBlack';this.fontColor='#fff';this.fontStyle='normal';this.fontWeight='normal';this.isDark=false;this.currentStyle='default';},initialize:function(a){this.options=a||{};this._configure();this.render();},render:function(){if(!this.$el.length)return;this.canvas=this.$el.get(0);this.context=this.canvas.getContext('2d');this.update();},update:function(){if(!this.$textarea.length)return;var a=this.$textarea.position();this._updateText();this.$el.css({height:this.$textarea.height(),left:a.left,top:a.top,width:this.$textarea.width()});},updateScale:function(a){this.scale=a||this.scale;},updateStyle:function(a){this.fontColor=a.color;this.currentStyle=a.style;this.isDark=a.isDark||false;switch(a.style){case 'meme':this.font='Impact';this.fontStyle='normal';this.fontWeight='bold';break;case 'subtitle':this.font='Arial';this.fontStyle='italic';this.fontWeight='bold';break;default:this.font='NexaBlack';this.fontStyle='normal';this.fontWeight='normal';break;}this._updateText();},save:function(a){a=a||{};var b=a.width||0;var c=a.height||0;var d=a.left||0;var e=a.top||0;var f=document.createElement('canvas');var g=f.getContext('2d');var h=d*this.scale;var i=e*this.scale;f.width=b*this.scale;f.height=c*this.scale;g.imageSmoothingEnabled=false;g.drawImage(this.canvas,h,i,this.canvas.width,this.canvas.height);return f.toDataURL();},remove:function(){}};b.CreationCaptionPreviewCanvas=c;})(_,Giphy);(function(a,b){var c=function(a){this.initialize(a);};c.prototype={__fontClick:function(a){a.preventDefault();var b=$(a.currentTarget);var c=b.data();this.$styles.removeClass('active');b.addClass('active');this.updateStyle(c.style,c.color);},__colorClick:function(b){b.preventDefault();var c=$(b.currentTarget);var d=a.without(c.get(0).className.split(/\s+/),'active','color-style');this.updateStyle(this.currentStyle,a.first(d));},_configure:function(){this.$el=$(this.options.el||'');this.currentStyle=(this.options.style||'default').toLowerCase();this.currentColor=this.options.color||'white';},_cacheSelectors:function(){this.$colors=this.$el.find('.color-style');this.$styles=this.$el.find('.font-style');},initialize:function(a){this.options=a||{};this._configure();this._cacheSelectors();this.render();},updateStyle:function(c,d){c=c||this.currentStyle;d=d||this.currentColor;this.currentStyle=c;this.currentColor=d;this.$colors.removeClass('active');var e='';a.each(this.$colors,function(a){var b=$(a);if(b.hasClass(d)){b.addClass('active');e=b.css('background-color');}});b.Events.trigger('captionstyles:update',{color:e,style:this.currentStyle,isDark:this.currentColor==='black'});},render:function(){if(!this.$el.length)return;this.$el.on('click.caption-styles','.font-style',a.bind(this.__fontClick,this));this.$el.on('click.caption-styles','.color-style',a.bind(this.__colorClick,this));this.$styles.each(a.bind(function(a,b){var c=$(b);var d=c.data('style');if(d===this.defaultStyle)c.trigger('click');},this));},remove:function(){}};b.CreationCaptionStyles=c;})(_,Giphy);(function(a,b){var c={messageStrings:{"MAX_NUM_FILES":"Maximum number of files reached.","FILE_TOO_BIG":"Uh-oh! Some files were too big.","LOGIN_FOR_MULTIPLE_FILES":"To upload multiple GIFs at once you must be logged in. If you don't log in, you can upload one by one.","VIDEO_TOO_LONG":"Oops! Shorter GIFs are better GIFs.","ACCEPT_TOS":"Please accept our Terms of Service to continue.","INVALID_URL":"Please enter a valid URL.","INVALID_FILE":"Whoops! Some files were invalid.","INVALID_VIDEO":"Whoops! Your browser does not support this video.","SOMETHING_WENT_WRONG":"Uh-oh. Something went wrong. Please try again or contact support@giphy.com.","DUPLICATE_FILE":"Oops! You've already added that file.","DUPLICATE_URL":"URL already in upload queue.","MAX_TOTAL_FILESIZE":"Oops! Youâ€™ve reached the maximum file size.","VIDEO_BLOCKED":"Sorry! This video has been blocked on copyright grounds."},show:function(a,b){var c=this.messageStrings[a]||a;var d=b||'';window.showError(c+' '+d);return c+' '+d;},showDurationError:function(a,b){var c='Your '+a+' is';if(b)c+=' '+b;c+=' too long! Edit and try again!';window.showError(c);return c;},showResolved:function(){var a='You\'re good!';window.showSuccess(a);return a;}};b.CreationErrors=c;})(_,Giphy);(function(a,b){var c=function(a){this.initialize(a);};c.prototype={_configure:function(){this.$el=$(this.options.el||'');this.gifs=this.options.gifs;this.maxGifs=this.options.maxGifs||5;},initialize:function(a){this.options=a||{};this._configure();this.render();},render:function(){if(!this.$el.length||a.isEmpty(this.gifs))return;this.gifs=a.shuffle(this.gifs);a.each(this.gifs,function(a,b){var c='featured-'+(b+1);if(b===0||b===1||b===3)c+=' grid_3';else c+=' grid_5';a.class_name=c;});this.$el.append(this.template({gifs:a.first(this.gifs,this.maxGifs)}));this.show();},show:function(){if(!this.$el.length)return;this.$el.show();},hide:function(){if(!this.$el.length)return;this.$el.hide();},remove:function(){},template:a.template(['<div class="featured-gifs-container">','<% _.each(gifs, function(gif, i) { %>','<a class="featured-gif <%- gif.class_name %>" href="<%- gif.permalink_url %>" target="_blank">','<span class="featured-index"><%- i + 1 %></span>','<img class="featured-gif-image" src="<%- gif.image_url %>" />','<% if (i === 2) { %>','<div class="layer layer-2">','<img class="featured-gif-image" src="<%- gif.image_url %>" />','</div>','<div class="layer layer-3">','<img class="featured-gif-image" src="<%- gif.image_url %>" />','</div>','<% } %>','</a>','<% }); %>','</div>'].join(""))};b.CreationToolsFeaturedGifs=c;})(_,Giphy);(function(a,b){function c(){this.move=function(a,b){this.splice.apply(this,[b,0].concat(this.splice(a,1)));};this.pop=function(a){return this.splice(a,1)[0];};}c.prototype=Array.prototype;var d={__loginCheck:function(a){this.isLoggedIn=a.target.LOGGED_IN;},__errorHandler:function(){return;},__removeHandler:function(){return;},__sortableUpdate:function(a,b){var c=b.item.attr("id");var d=this.$sortable.find("li").index(b.item);this.move(c,d);},initialize:function(d){d=d||{};this.$win=$(window);this.$sortable=$(typeof d.sortable!=="undefined"?d.sortable:'');this.files=new c();this.nextIndex=null;this.maxFiles=typeof d.maxFiles!=="undefined"?d.maxFiles:1000;this.errorHandler=typeof d.error!=="undefined"?d.error:this.__errorHandler;this.removeHandler=typeof d.remove!=="undefined"?d.remove:this.__removeHandler;this.multipleRequiresLogin=typeof d.multipleRequiresLogin!=="undefined"?d.multipleRequiresLogin:false;this.maxTotalFilesize=typeof d.maxTotalFilesize!=="undefined"?d.maxTotalFilesize:-1;this.hasSortable=false;this.isLoggedIn=false;this.totalFilesize=0;this.preventDuplicates=d.preventDuplicates||false;this.$win.on('login:check.file-manager',a.bind(this.__loginCheck,this));b.Events.on('sortable:reverse',a.bind(this.reverse,this));this.render();return this;},render:function(){if(this.$sortable!==null){this.sortable=b.Sortable.initialize({el:this.$sortable,update:$.proxy(this.__sortableUpdate,this),disabled:true});this.hasSortable=true;}},_checkFiles:function(){if(this.multipleRequiresLogin&&this.length()>=1&&!this.isLoggedIn){this.errorHandler('LOGIN_FOR_MULTIPLE_FILES');return false;}if(this.length()>=this.maxFiles){this.errorHandler("MAX_NUM_FILES");return false;}return true;},_appendFile:function(a){if(!this._checkFiles())return null;a.id=window.btoa(a.name+a.lastModified).replace(/=/g,'');if(this.preventDuplicates&&this.index(a.id)>-1){this.errorHandler("DUPLICATE_FILE");return null;}if(a.size){var c=this.totalFilesize+(a.size/1048576);if(this.maxTotalFilesize>0&&c>this.maxTotalFilesize){if(this.length()<1)this.errorHandler('FILE_TOO_BIG');else this.errorHandler('MAX_TOTAL_FILESIZE',this.maxTotalFilesize+'MB.');return null;}else this.totalFilesize=c;}a.index=this.length();this.files.push(a);b.Events.trigger('filemanager:addfile',a);return a;},_appendURL:function(a){if(!this._checkFiles())return null;var c='url-'+window.btoa(a).replace(/=/g,'');if(this.preventDuplicates&&this.index(c)>-1){this.errorHandler("DUPLICATE_URL");return null;}var d={'id':c,'name':a,'type':'url','index':this.length(),'status':'queued'};this.files.push(d);b.Events.trigger('filemanager:addurl',d);return d;},_updateSortable:function(){if(!this.hasSortable)return;if(this.length()<=1){$("#reverse-button").hide();this.sortable.disable();}else{$("#reverse-button").show();this.sortable.enable();}},isOnlyGifs:function(){var b=a.filter(this.files,function(a){var b=a.name.split('?')[0];return a.type.indexOf('image/gif')>-1||b.indexOf('.gif')>-1;});return b?b.length===this.files.length:false;},append:function(a){if(!this._checkFiles())return null;if(a instanceof File)var b=this._appendFile(a);else var b=this._appendURL(a);if(b!==null&&this.hasSortable){this.sortable.append(b);this._updateSortable();}return b;},get:function(a){return this.files[a];},remove:function(a){b.Events.trigger('filemanager:remove',a);var c=this.files.pop(this.files.indexOf(a));if(c.size)this.totalFilesize-=c.size/1048576;if(this.hasSortable){this.sortable.trim(a);this._updateSortable();}return c;},removeById:function(a,b){var c=this.remove(this.files[this.index(a)]);if(b)this.removeHandler(c);},empty:function(){a.each(this.files,a.bind(function(a){this.removeById(a.id,true);},this));},pop:function(a){var b=this.files.pop(this.index(a));this._updateSortable();return b;},index:function(a){return this.files.map(function(a){return a.id;}).indexOf(a);},move:function(a,b){this.files.move(this.index(a),b);},length:function(){return this.files.length;},nextAvailable:function(){var a=this.cycle();if(!(typeof a==="undefined")&&a.status==="queued")return a;},hasNext:function(){var a=this.files[this.nextIndex];if(!a||typeof a==="undefined")return false;else return true;},cycle:function(){if(this.nextIndex===null||this.nextIndex>this.files.length-1)this.nextIndex=0;var a=this.files[this.nextIndex];this.nextIndex++;return a;},reverse:function(){this.files.reverse();if(this.hasSortable)this.sortable.reverse();},guid:function(){return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,function(a){var b=Math.random()*16|0,c=a=='x'?b:(b&0x3|0x8);return c.toString(16);});}};b.FileManager=d;})(_,Giphy);(function(a,b){var c={__acceptFile:function(b,c){b=b||{};clearTimeout(this.fileQueueTimeout);this.fileQueue.push(b);this.fileQueueTimeout=setTimeout(a.bind(this.__validateFiles,this),100);c();},__dropUrl:function(a,b){if(!b)return;var c=this._validateUrl(b);if(c)this._checkFile(c,true);},__validateFiles:function(){var b=[];a.each(this.fileQueue,a.bind(function(a){b.push(this._checkFile(a));},this));$.when.apply($,b).done(a.bind(function(){this.fileQueue=[];a.each(arguments,a.bind(function(a){if(!a.isValid){if(!a.errorShown)Giphy.CreationErrors.show('INVALID_FILE');}else this._addToFiles(a.file);},this));},this));},__removeFile:function(a){if(a&&a.type!=='url'&&this.subviews.dropzone)this.subviews.dropzone.removeFile(a);this.update();b.Events.trigger('fileportal:removed',a);},__dropzoneError:function(a,b,c){if(a.status=='canceled'){}else if(this.subviews.files.length()>=this.maxFiles)Giphy.CreationErrors.show("MAX_NUM_FILES");else if(a.size/1048576>this.maxFilesize){this._showError(a,'This file must be '+this.maxFilesize+' MB or less.');Giphy.CreationErrors.show("FILE_TOO_BIG","This tool supports files up to "+this.maxFilesize+" MB.");}else if(c){a.status='queued';this.serverError("SOMETHING_WENT_WRONG","Oops! Something went wrong");}else{this._showError(a,'This file is invalid.');Giphy.CreationErrors.show("INVALID_FILE","This tool supports "+this.fileTypesInEnglish+".");}},__fileError:function(a,b){Giphy.CreationErrors.show(a,b);},__progress:function(a,c){var d=this.subviews.files;if(!d)return;var e=30;var f=d.length();var g=d.nextIndex;var h=(c/100+g-1)/f*100;b.Events.trigger('fileportal:progress',{currentFile:g,currentFileName:a.name,progress:c,totalFiles:f,totalProgress:h,estimatedTime:e});},__success:function(b,c){if(a.isUndefined(c)||a.isNull(c)){Giphy.CreationErrors.show("SOMETHING_WENT_WRONG");return;}if(a.isString(c))c=$.parseJSON(c);var d=c.meta.status;if(d===200){if(!c.data||!c.data.id){Giphy.CreationErrors.show("SOMETHING_WENT_WRONG");this._showError(b,c.data.msg);return;}if(window.isGifys){$('#upload-gif-form').hide();$('#gifys-submission-complete').show();}else if(window.IS_PARTNER||window.IS_ARTIST||!window.LOGGED_IN)this._showSuccess(b,c.data.id,"/gifs/"+c.data.id);else this._showSuccess(b,c.data.id,"/gifs/"+c.data.id+"?status=200");return;}if(d===400){this._showError(b,c.meta.msg);return;}if(d===401){window.location=window.location+"?status=401";return;}if(d===409){if(window.IS_PARTNER||window.IS_ARTIST||!window.LOGGED_IN)this._showSuccess(b,c.data.id,"/gifs/"+c.data.id);else this._showSuccess(b,c.data.id,"/gifs/"+c.data.id+"?status=409");return;}if(d===480){window.location="/480";return;}if(d>=500){Giphy.CreationErrors.show("SOMETHING_WENT_WRONG");this._showError(b,"Error: unknown error");return;}this._showError(b,"Error: "+c.meta.msg);},__complete:function(a){if(!a.accepted)return;this._processNextUpload();},__pause:function(){this.isCanceled=true;},__cancel:function(a,b){if(this.subviews.files)this.subviews.files.removeById(b,true);},__urlInput:function(b){var c=this.$urlInput.val();var d=this._validateUrl(c);clearTimeout(this.inputDelay);if(d){var e=a.bind(this._checkFile,this);this.inputDelay=a.delay(e,500,d,true);}},__urlKeydown:function(a){if(a.which===13){a.preventDefault();a.stopPropagation();var b=this.$urlInput.val();var c=this._validateUrl(b);clearTimeout(this.inputDelay);if(c)this._checkFile(c,true);else Giphy.CreationErrors.show('INVALID_URL');return false;}},_validateUrl:function(c){c=c.trim();if(!c)return false;if(!/^(ftp|http|https)/.test(c))c='http://'+c;if(!/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/.test(c))return false;var d=b.Utils.urlRE.exec(c);var e=false;var f=this.fileTypes.indexOf('image/*')>-1||this.fileTypes.indexOf('image/gif')>-1;var g=c;if(!d)return false;c=d[1];var h=a.last(c.split('.'));if(h==='gifv')c=c.replace('.gifv','.gif');var i=c.replace('http://','').replace(/.*?:\/\//g,"");var j=i.match(/giphy\.com\/gifs\/.*|gph\.is\/.*/i);if(f&&!a.isEmpty(j)){var k=a.last(j).split('/');var l=a.last(k);return 'https://media.giphy.com/media/'+a.last(l.split('-'))+'/giphy.gif';}a.each(this.fileTypes,a.bind(function(d){if(!e&&d==='youtube'){var f=b.Utils.getYoutubeId(g);e=f?'youtubeId='+f:false;}else if(!e&&d==='vimeo'){var h=b.Utils.getVimeoId(g);e=h?'vimeoId='+h:false;}else if(!e&&d==='vine'){if(Giphy.Utils.isVineUrl(c))e=c;}else if(!e&&a.has(this.mimeTypes,d)){var j=this.mimeTypes[d];if(j.test(i))e=c;}},this));return e;},_validateFile:function(c){var d=$.Deferred();var e=this.maxVideoLength;var f=false;var g=false;if(a.isString(c)){f=this.mimeTypes['video/*'].test(c);g=this.mimeTypes['image/*'].test(c);}else if(a.isObject(c)){f=c.type&&c.type.indexOf('video')>-1;g=c.type&&c.type.indexOf('image')>-1;}if(this.maxVideoLength&&f){this._validateVideo(c).fail(function(){d.reject();}).done(function(a){if(a&&Math.floor(a)<=e)d.resolve();else{var c=b.Utils.formatTimeObject(e);var f='';if(c.h){if(f.length)f+=', ';f+=c.h+' hours';}if(c.m){if(f.length)f+=', ';f+=c.m+' minutes';}if(c.s){if(f.length)f+=', ';f+=c.s+' seconds';}Giphy.CreationErrors.show('VIDEO_TOO_LONG','Please upload videos under '+f+'.');d.reject(true);}});}else if(g&&a.isString(c))d.resolve();else d.resolve();return d.promise();},_validateImageUrl:function(c){var d=$.Deferred();var e=document.createElement('img');if(!c||!a.isString(c))d.reject();else b.Utils.preloadImage(c).done(function(){d.resolve();}).fail(function(){d.reject();});return d.promise();},_validateVideo:function(a){var c=$.Deferred();if(!a||!this.maxVideoLength)c.resolve();else b.Utils.getVideoDuration(a).fail(function(){c.resolve(1);}).done(function(a){c.resolve(a);});return c.promise();},_getRequestParams:function(b){var c=this.defaultTags;if(!a.isEmpty($('#tags').val()))c+=','+$('#tags').val();var d={"session_key":$.cookie("giphy_session_id")||'',"api_key":$('#api-key').val(),"tags":c,"source_post_url":$('#source-post-url').val(),"source_image_url":$('#gif-url').val(),"username":$('#username').val(),"is_hidden":$('#is-hidden').val()};if(typeof b!=="undefined")d.source_image_url=b;return d;},_checkFile:function(b,c){if(!b||!this.subviews.files)return;var d=$.Deferred();this._validateFile(b).fail(function(a){d.resolve({file:b,isValid:false,errorShown:a||false});}).done(a.bind(function(){d.resolve({file:b,isValid:true});if(c)this._addToFiles(b);},this));return d.promise();},_addToFiles:function(c){if(!c||!this.subviews.files)return;if(this.maxFiles===1&&this.replaceFile)this.subviews.files.empty();var d=this.subviews.files.append(c);var e=this.subviews.files.length();if(d){this.update();if(d.type==='url'){this.$urlInput.val('');this.$el.addClass('success');setTimeout(a.bind(function(){this.$el.removeClass('success');},this),1000);}a.delay(a.bind(function(){b.Events.trigger('fileportal:added',d);},this),(e>1)?0:1100);}},_allDone:function(){this.isUploading=false;b.Events.trigger('fileportal:complete',{firstFile:this.subviews.files.get(0),totalFiles:this.subviews.files.length()});},_processNextUpload:function(){if(this.isCanceled||!this.subviews.files){this.isCanceled=false;this.isUploading=false;return;}var a=this.subviews.files.nextAvailable();if(!a){this._allDone();return;}if(!this.subviews.files.hasNext())b.Events.trigger('fileportal:almostComplete');if(a.type==='url'){a.status='processing';this._uploadUrl(a);}else this.subviews.dropzone.processFile(a);this.isUploading=true;b.Events.trigger('fileportal:processing',{file:a});},_uploadUrl:function(a){if(!a)return;var b=this;var c=this._getRequestParams(a.name);$.ajax({beforeSend:function(a){a.setRequestHeader("");},url:this.uploadUrl,type:"POST",cache:false,timeout:720000,data:c}).done(function(c,d,e){b.__progress(a,100);b.__success(a,c);}).fail(function(c,d,e){var f=c.statusCode();b._showError(a,"Error: "+d);Giphy.CreationErrors.show("SOMETHING_WENT_WRONG");}).always(function(){b._processNextUpload();});},_showSuccess:function(a,c,d){if(!a)return;a.status="success";a.giphy_url=d;b.Events.trigger('fileportal:success',{file:a,gifId:c,url:d});},_showError:function(a,c){if(!a)return;a.status='error';b.Events.trigger('fileportal:error',{file:a,message:c});},initialize:function(b){b=b||{};this.$el=$('.file-portal');this.$urlInput=$();this.uploadUrl=b.url;this.fileTypes=b.fileTypes||['image/gif'];this.sortableList=b.sortableList;this.uploadMultiple=b.uploadMultiple||false;this.maxFiles=b.maxFiles||500;this.minFiles=b.minFiles||1;this.parallelUploads=b.parallelUploads||1;this.maxFilesize=b.maxFilesize||100;this.maxTotalFilesize=b.maxTotalFilesize||-1;this.maxVideoLength=b.maxVideoLength||false;this.multipleRequiresLogin=b.multipleRequiresLogin||false;this.allowAnonymous=a.isBoolean(b.allowAnonymous)?b.allowAnonymous:true;this.defaultTags=b.defaultTags||'';this.preventDuplicates=b.preventDuplicates||false;this.replaceFile=b.replaceFile||false;this.subviews={};this.fileQueue=[];this.fileQueueTimeout=null;this.fileTypesInEnglish=this._fileTypesInEnglish();this.inputDelay=null;this.isLoggedIn=false;this.isCanceled=false;this.isUploading=false;this.fileTypes=a.isString(this.fileTypes)?this.fileTypes.split(' '):this.fileTypes;this.render();return this;},render:function(){if(!this.$el.length)return;this.$urlInput=this.$el.find('.url-input');this.subviews.dropzone=b.FullPageDropzone.initialize({url:this.uploadUrl,params:{'api_key':b.CreationApiHelper.apiKey},method:'post',headers:{'Cache-Control':null},clickable:'.browse',maxFilesize:this.maxFilesize,maxFiles:(this.maxFiles===1&&this.replaceFile)?null:this.maxFiles,parallelUploads:this.parallelUploads,uploadMultiple:this.uploadMultiple,autoProcessQueue:false,acceptedFiles:a.without(this.fileTypes,'youtube','vine','vimeo').join(','),addedfile:$.noop,accept:a.bind(this.__acceptFile,this),error:a.bind(this.__dropzoneError,this),success:a.bind(this.__success,this),complete:a.bind(this.__complete,this),uploadprogress:a.bind(this.__progress,this)});this.subviews.files=b.FileManager.initialize({multipleRequiresLogin:this.multipleRequiresLogin,maxFiles:this.maxFiles,maxTotalFilesize:this.maxTotalFilesize,sortable:this.sortableList?$(this.sortableList):null,remove:a.bind(this.__removeFile,this),error:a.bind(this.__fileError,this),preventDuplicates:this.preventDuplicates});this.$el.on('input.file-portal','.url-input',a.bind(this.__urlInput,this));this.$el.on('keydown.file-portal','.url-input',a.bind(this.__urlKeydown,this));b.Events.on('sortable:cancelClick',this.__cancel,this);b.Events.on('optionalfields:pause',this.__pause,this);b.Events.on('dropzone:urlDrop',this.__dropUrl,this);},isOnlyGifs:function(){if(!this.subviews.files)return;return this.subviews.files.isOnlyGifs();},update:function(){if(!this.subviews.files)return;var a=this.subviews.files.length();b.Events.trigger('fileportal:update',{fileCount:a,hasEnough:a>=this.minFiles});if(a===1)b.CreationTools.condenseMenu();else if(a===0)b.CreationTools.expandMenu();},submit:function(){if(!this.subviews.files||!this.subviews.files.length()){b.Events.trigger('fileportal:cancel');return;}if(this.subviews.dropzone){this.subviews.dropzone.options.params=this._getRequestParams();this._processNextUpload();}b.Events.trigger('fileportal:submit');},files:function(){return this.subviews.files;},dropzone:function(){return this.subviews.dropzone;},remove:function(){if(!this.$el.length)return;this.$el.off('.file-portal');a.each(this.subviews,function(a){a.remove();});this.subviews={};},mimeTypes:{'image/*':/\.(jpe?g|png|gif|bmp)$/i,'image/gif':/\.(gif)$/i,'image/jpeg':/\.(jpe?g)$/i,'image/png':/\.(png)$/i,'video/*':/\.(mpeg|mp4|m4v|mov)$/i,'video/mpg':/\.(mpeg)$/i,'video/mpeg':/\.(mpeg)$/i,'video/mp4':/\.(mp4)$/i,'video/m4v':/\.(m4v)$/i,'video/x-m4v':/\.(m4v)$/i,'video/mov':/\.(mov)$/i,'video/quicktime':/\.(mov)$/i},_fileTypesInEnglish:function(){var a=[];if(this.fileTypes.indexOf('image/*')>-1)a.push('image');else{if(this.fileTypes.indexOf('image/gif')>-1)a.push('GIF');if(this.fileTypes.indexOf('image/jpeg')>-1)a.push('JPEG');if(this.fileTypes.indexOf('image/png')>-1)a.push('PNG');}this.fileTypes.every(function(b){if(b.indexOf('video')>-1){a.push('video');return false;}return true;});var b='';if(a.length>1)b+=a.slice(0,-1).join(', ')+" and "+a.slice(-1)[0]+" files";else b+=a[0]+" files";if(this.fileTypes.indexOf('youtube')>-1){if(b.length>0)b+=' and ';b+='YouTube URLs';}return b;},serverError:function(a,c){Giphy.CreationErrors.show(a);b.Events.trigger('fileportal:serverError',{message:c});}};b.FilePortal=c;})(_,Giphy);(function(a){var b=_.extend({},a.FilePortal,{gifMakerView:this,_getRequestParams:function(){var a='giphygifmaker';if(!_.isEmpty($('#tags').val()))a+=','+$('#tags').val();var b={"session_key":$.cookie("giphy_session_id")||'',"api_key":Giphy.CreationApiHelper.apiKey,"tags":a,"source_post_url":$('#source-post-url').val(),"username":$('#username').val(),"hidden":$('#is-hidden').val(),"duration":this.gifMakerView.duration,"start":this.gifMakerView.startTime,"watermark":this.gifMakerView.captionControl.getCaption()};var c=this.files().files[0];if(c.type=='url'){var d;if(c.name.indexOf('youtubeId=')>-1){var e=_.last(c.name.split('youtubeId='));d=this.gifMakerView.makeYouTubeUrlWithId(e);}else if(c.name.indexOf('vimeoId=')>-1){var f=_.last(c.name.split('vimeoId='));d=this.gifMakerView.makeVimeoUrlWithId(f);}else d=c.name;b.url=d;}return b;},__progress:function(b,c){var d=40;a.Events.trigger('fileportal:progress',{currentFile:1,currentFileName:null,progress:c,totalFiles:1,totalProgress:c,estimatedTime:d});},__complete:function(a){},__success:function(a,b){if(_.isUndefined(b)||_.isNull(b)){Giphy.CreationErrors.show("SOMETHING_WENT_WRONG");return;}if(_.isString(b))b=$.parseJSON(b);var c=b.data;if(_.isEmpty(c)||_.isEmpty(c.job_id)){Giphy.CreationErrors.show("SOMETHING_WENT_WRONG");return;}Giphy.CreationApiHelper.pollCreateStatus(c.job_id,2000,null,_.bind(function d(a){this._allDone(a.data.result.id);},this));},_allDone:function(b){a.Events.trigger('fileportal:complete',{firstFile:{"giphy_url":"/gifs/"+b},totalFiles:1});},submit:function(){var a=this.subviews.dropzone;var b=this._getRequestParams();if(a&&a.getQueuedFiles().length>0){a.options.params=b;a.processQueue();}else{Giphy.CreationApiHelper.postCreateVideo(b,_.bind(function(a){this.__success(null,a);},this),_.bind(function(a){this.serverError("SOMETHING_WENT_WRONG","Oops! Something went wrong");},this));this.gifMakerView.optionalFields.progressBar.updateWithText("Creating your GIF",80,30,_.bind(function(){this.gifMakerView.optionalFields.progressBar.updateWithText("Creating your GIF",99,40);},this));}}});a.FilePortalGifMaker=b;})(Giphy);(function(a){var b=_.extend({},a.FilePortal,{slideshowView:this,__addFile:function(a){a=a||{};var b=_.bind(this._addToFiles,this,a,false);this.dropzoneAddDelay=setTimeout(b,50);},_getRequestParams:function(){var a='giphyslideshow';if(!_.isEmpty($('#tags').val()))a+=','+$('#tags').val();var b=[];_.each(this.files().files,_.bind(function(a,c){b.push({"name":a.name,"duration":_.has(this.slideshowView.gifDurations,a.id)?this.slideshowView.gifDurations[a.id]:this.slideshowView.stillImageDuration,"index":c,"type":a.type});},this));return{"session_key":$.cookie("giphy_session_id")||'',"api_key":Giphy.CreationApiHelper.apiKey,"tags":a,"source_post_url":$('#source-post-url').val(),"username":$('#username').val(),"hidden":$('#is-hidden').val(),"slides_data":JSON.stringify(b),"watermark":this.slideshowView.captionControl.getCaption()};},__progress:function(b,c){var d=40;a.Events.trigger('fileportal:progress',{currentFile:1,currentFileName:null,progress:c,totalFiles:1,totalProgress:c,estimatedTime:d});},__complete:function(a){},__success:function(a,b){if(_.isUndefined(b)||_.isNull(b)){Giphy.CreationErrors.show("SOMETHING_WENT_WRONG");return;}if(_.isString(b))b=$.parseJSON(b);var c=b.data;if(_.isEmpty(c)||_.isEmpty(c.job_id)){Giphy.CreationErrors.show("SOMETHING_WENT_WRONG");return;}Giphy.CreationApiHelper.pollCreateStatus(c.job_id,2000,null,_.bind(function d(a){this._allDone(a.data.result.id);},this));},_allDone:function(b){a.Events.trigger('fileportal:complete',{firstFile:{"giphy_url":"/gifs/"+b},totalFiles:1});},submit:function(){var a=this.subviews.dropzone;var b=this._getRequestParams();if(a&&a.getQueuedFiles().length>0){a.options.params=b;a.processQueue();}else{Giphy.CreationApiHelper.postCreateSlideshow(b,_.bind(function(a){this.__success(null,a);},this),_.bind(function(a){this.serverError("SOMETHING_WENT_WRONG","Oops! Something went wrong");},this));this.slideshowView.optionalFields.progressBar.updateWithText("Creating your GIF Slideshow",80,30,_.bind(function(){this.slideshowView.optionalFields.progressBar.updateWithText("Creating your GIF Slideshow",99,40);},this));}}});a.FilePortalSlideshow=b;})(Giphy);(function(a,b){var c={__dragEnter:a.throttle(function(a){a.preventDefault();a.stopPropagation();if(this.isDisabled)return;clearTimeout(this.hoverDelay);this.startDrag();if(this.isDragging&&this.powerglove)this.powerglove.pointTo(a.pageX,a.pageY-this.$win.scrollTop());return false;},20),__dragLeave:a.throttle(function(b){b.preventDefault();b.stopPropagation();if(this.isDisabled)return;clearTimeout(this.hoverDelay);this.hoverDelay=setTimeout(a.bind(this.stopDrag,this),20);return false;},40),__drop:function(c){c.preventDefault();c.stopPropagation();if(this.isDisabled)return;if(c.dataTransfer&&c.dataTransfer.getData('URL'))b.Events.trigger('dropzone:urlDrop',c.dataTransfer.getData('URL'));clearTimeout(this.hoverDelay);this.dropPosition.x=c.pageX;this.dropPosition.y=c.pageY-this.$win.scrollTop();this.dropDelay=setTimeout(a.bind(this.drop,this),20);return false;},__elementDragStart:function(){if(this.isDisabled)return;this.dropzone.disable();this.disable();},__elementDragEnd:function(){if(!this.isDisabled)return;this.dropzone.enable();this.enable();},__error:function(b,c,d){clearTimeout(this.dropDelay);if(this.powerglove){this.$drop.addClass('nope');this.errorCallback(b,c,d);this.powerglove.errorAnimation().then(a.bind(function(){this.$drop.addClass('go-away');return this.powerglove.errorAnimationOut();},this)).done(a.bind(this.stopDrag,this));}else{this.stopDrag();this.errorCallback(b,c,d);}},_showImagePreview:function(b){if(!b)return;this.$dropImage.css('background-image','url('+b+')');a.defer(a.bind(this.drop,this));},initialize:function(c){c=c||{};this.$win=$(window);this.$el=$('html');this.$body=$('body');this.$drop=$();this.$dropImage=$();this.hoverDelay=null;this.dropDelay=null;this.pushPoint={x:0,y:0};this.dropPosition={x:0,y:0};this.addedFileCallback=c.addedfile||$.noop;this.errorCallback=c.error||$.noop;this.transitionEnd=b.Utils.transitionEnd();this.isDragging=false;this.isDropping=false;this.isDisabled=false;this.powerglove=null;this.dropzone=new Dropzone(this.$el.get(0),a.extend(c,{error:a.bind(this.__error,this)}));this.dropzone.on('dragenter',a.bind(this.__dragEnter,this));this.dropzone.on('dragover',a.bind(this.__dragEnter,this));this.dropzone.on('dragleave',a.bind(this.__dragLeave,this));this.dropzone.on('dragend',a.bind(this.__dragLeave,this));this.dropzone.on('drop',a.bind(this.__drop,this));this.$body.on('dragstart.fullpage-dropzone','*',a.bind(this.__elementDragStart,this));this.$body.on('dragend.fullpage-dropzone','*',a.bind(this.__elementDragEnd,this));b.Events.on('optionalfields:upload',this.disable,this);b.Events.on('optionalfields:pause',this.enable,this);b.Events.on('optionalfields:complete',this.remove,this);this.render();return this.dropzone;},render:function(){this.$drop=$(this.template());this.$dropImage=this.$drop.find('.drop-image');this.powerglove=b.FullPageDropzoneGlove.initialize({el:this.$drop.find('.powerglove')});},disable:function(){this.isDisabled=true;this.stopDrag();},enable:function(){this.isDisabled=false;},startDrag:function(){if(this.isDragging)return;this.$body.addClass('drag-n-drop').append(this.$drop);this.isDragging=true;if(this.powerglove)this.powerglove.render();},stopDrag:function(){if(this.powerglove)this.powerglove.remove();this.$body.removeClass('drag-n-drop');this.$drop.removeClass('drop nope go-away').remove();this.$dropImage.attr('style','');this.isDragging=false;this.isDropping=false;},drop:function(){if(!this.isDragging||this.isDropping)return;this.isDropping=true;this.$drop.one(this.transitionEnd,a.bind(this.stopDrag,this));this.$drop.addClass('drop');},remove:function(){this.dropzone.disable();this.stopDrag();},template:a.template('<div class="drag-drop">                <div class="drop-text">Drop files here</div>                <div class="drop-image"></div>                <div class="powerglove">                    <div class="glove-inner">                        <div class="finger"></div>                    </div>                </div>            </div>')};b.FullPageDropzone=c;})(_,Giphy);(function(a,b){var c={__resize:function(){if(this.$preview.length){var a=this.$preview.offset();this.pushPoint.x=a.left+(this.$preview.width()*0.5);this.pushPoint.y=a.top+(this.$preview.height()*0.5)-this.$win.scrollTop();}else{this.pushPoint.x=this.$win.width()*0.5;this.pushPoint.y=this.$win.height()*0.5;}},_getPushDistance:function(a,b){a=a||0;b=b||0;var c=this.pushPoint.x-a;var d=this.pushPoint.y-b;var e=Math.sqrt(Math.pow(c,2)+Math.pow(d,2));return Math.round(e);},initialize:function(a){a=a||{};this.$win=$(window);this.$el=$(a.el||'');this.$inner=this.$el.find('.glove-inner');this.$preview=$(a.preview||'');this.pushPoint={x:0,y:0};this.transitionEnd=b.Utils.transitionEnd();this.resetStyle();return this;},render:function(){if(!this.$el.length)return;this.$win.on('resize.full-page-glove',a.bind(this.__resize,this));this.__resize();},remove:function(){if(!this.$el.length)return;this.resetStyle();this.$win.off('.full-page-glove');},resetStyle:function(){if(!this.$el.length)return;this.$el.attr('style','');this.$inner.attr('style','');},pointTo:function(c,d){c=c||0;d=d||0;var e=Math.atan2(this.pushPoint.x-c,this.pushPoint.y-d);var f=(e*(180/Math.PI)*-1)+180;var g='rotate('+f+'deg)';var h=a.extend(b.Utils.prefixStyle('transform',g),{left:c,top:d});this.$el.css(h);},pushTo:function(a,c){var d=this._getPushDistance(a,c);var e=b.Utils.prefixStyle('transform','translateY(-'+d+'px)');this.$inner.css(e);},errorAnimation:function(){var b=$.Deferred();this.resetStyle();setTimeout(a.bind(function(){b.resolve();},this),1500);return b.promise();},errorAnimationOut:function(){var b=$.Deferred();var c=setTimeout(function(){b.resolve();},3000);this.$el.one(this.transitionEnd,a.bind(function(){clearTimeout(c);b.resolve();},this));return b.promise();}};b.FullPageDropzoneGlove=c;})(_,Giphy);(function(a){var b={__uploadClick:function(b){b.preventDefault();if(!this.$termsField.get(0).checked){Giphy.CreationErrors.show('ACCEPT_TOS');return;}this.$loadingGlass.show();this.$uploadButton.hide();this.$uploadProgressContainer.show();this.$reverseButton.hide();this.$container.addClass('uploading');a.Events.trigger('optionalfields:upload');},__pauseClick:function(b){b.preventDefault();this._reset(true);this.$uploadButton.text('Paused - Resume Upload');a.Events.trigger('optionalfields:pause');},__privacyToggle:function(a,b){this.$isHidden.val(b?0:1);},__loginCheck:function(b){if(b.target.IS_STAFF)this.$usernameField.attr('type','text');if(b.target.LOGGED_IN){this.$privacyToggle.show();a.Events.trigger('optionalfields:loggedIn');}if(b.target.USER){this.user=b.target.USER;this.user.isStaff=b.target.IS_STAFF;}},__almostComplete:function(){this.$uploadProgressContainer.find('.upload-pause').hide();},__progress:function(a,b){b=b||{};if(this.method=='slideshow'||this.method=='gifmaker'){this.progressBar.updateWithText('Creating your GIF',b.totalProgress*0.85,1);if(b.totalProgress===100)this.progressBar.updateWithText("Creating your GIF",99,b.estimatedTime);}else{this.progressBar.updateWithText('Uploading '+b.currentFile+' of '+b.totalFiles,b.totalProgress*0.85,1);if(b.totalProgress===100)this.progressBar.updateWithText("Preparing your GIFs",99,b.estimatedTime);}},__complete:function(b,c){a.Events.trigger('optionalfields:complete');if(c.totalFiles>1&&this.user){var d;if(this.user.isStaff&&this.$usernameField.val())d='/channel/'+this.$usernameField.val();else d=this.user.channel;if(d){this.progressBar.completeWithText('Upload complete! Go to your channel page',_.bind(this._completed,this));this.$uploadProgressContainer.css('cursor','pointer').on('click',function(a){window.open(d);});}else this.progressBar.completeWithText('Upload complete!');}else if(c.firstFile&&c.firstFile.giphy_url){this.progressBar.completeWithText('Upload complete!');window.location=c.firstFile.giphy_url;}else this.progressBar.completeWithText('Upload process finished with some errors',_.bind(this._completed,this));},__processingFile:function(a,b){var c=this.processingGifIds.indexOf(b.id)>-1;if(b.isComplete&&c)this.processingGifIds=_.without(this.processingGifIds,b.id);else if(!c)this.processingGifIds.push(b.id);this.$el.toggleClass('processing-gifs',this.processingGifIds.length>0);},__serverError:function(a,b){this.isError=true;this.progressBar.reset();this._reset();this._showButtonError(b.message||'Uh-oh. Something went wrong.');},__buttonError:function(a,b){if(!b)return;this._showButtonError(b);},__buttonReset:function(){this.$uploadButton.removeClass('error').text(this.$uploadButton.data('label'));},__updateFiles:function(a,b){this.$uploadButton.toggleClass('disabled',!b.hasEnough);if(this.isError){this._reset();this.isError=false;}},_reset:function(a){this.$loadingGlass.hide();this.$uploadProgressContainer.hide();this.$uploadButton.removeClass('error').show().text(this.$uploadButton.data('label'));if(!a){this.$container.removeClass('uploading');this.$reverseButton.show();}},_completed:function(){this.$container.addClass('upload-complete');},_showButtonError:function(a){this.$uploadButton.addClass('error').text(a);},initialize:function(a){a=a||{};this.$win=$(window);this.$body=$('body');this.$el=$('#optional-fields');this.progressBar=null;this.user=null;this.method=a.method;this.isError=false;this.processingGifIds=[];this.render();return this;},cacheSelectors:function(){this.$isHidden=this.$el.find('#is-hidden');this.$privacyToggle=this.$el.find('#privacy-toggle').hide();this.$usernameField=this.$el.find('#username');this.$tagsField=this.$el.find('#tags');this.$sourcePostUrl=this.$el.find('#source-post-url');this.$termsField=this.$el.find('.agree-to-terms');this.$loadingGlass=this.$el.find('.create-loading-glass');this.$uploadButton=this.$el.find('#upload-gif-button');this.$uploadProgressContainer=this.$el.find('.upload-progress-container');this.$container=$('.creation-tools');this.$reverseButton=$('#reverse-button');},render:function(){if(!this.$el.length)return;this.cacheSelectors();this.$uploadButton.data('label',this.$uploadButton.text());this.progressBar=new a.TimedProgressBar(this.$el.find('.create-progress-bar'));this.$el.on('click.optional-fields','#upload-gif-button',_.throttle(_.bind(this.__uploadClick,this),300,{trailing:false}));this.$el.on('toggle.optional-fields','#privacy-toggle',_.bind(this.__privacyToggle,this));this.$el.on('click.optional-fields','.upload-pause',_.bind(this.__pauseClick,this));this.$win.on('login:check.optional-fields',_.bind(this.__loginCheck,this));a.Events.on('sortable:cancelClick',this._reset,this);a.Events.on('fileportal:update',this.__updateFiles,this);a.Events.on('fileportal:cancel',this._reset,this);a.Events.on('fileportal:progress',this.__progress,this);a.Events.on('fileportal:almostComplete',this.__almostComplete,this);a.Events.on('fileportal:complete',this.__complete,this);a.Events.on('fileportal:serverError',this.__serverError,this);a.Events.on('uploadbutton:error',this.__buttonError,this);a.Events.on('uploadbutton:reset',this.__buttonReset,this);a.Events.on('slideshow:processing',this.__processingFile,this);},remove:function(){if(!this.$el.length)return;this.$el.off('.optional-fields');this.$win.off('.optional-fields');}};a.CreationOptionalFields=b;})(Giphy);(function(a){var b={initialize:function(a){a=a||{};this.$el=$(a.el||'');this.$video=$();this.src=a.src||'';this.video=null;$.getScript('/static/js/ac_quicktime.js').done($.proxy(this.render,this));return this;},render:function(){if(!this.src||!this.$el.length||!QT_GenerateOBJECTText)return;var b=QT_GenerateOBJECTText(this.src,'100%','100%','','AUTOPLAY','True','SCALE','Aspect','ENABLEJAVASCRIPT','True','CONTROLLER','False','POSTDOMEVENTS','True','VOLUME','0','NAME','gifpreview');this.$video=$(b);this.video=this.$video.get(0);this.$el.html(this.$video);this.video.addEventListener('qt_load',$.proxy(function(){a.Events.trigger('quicktime:ready');},this));},pause:function(){if(!document.gifpreview)return;document.gifpreview[0].Stop();},play:function(){if(!document.gifpreview)return;document.gifpreview[0].Play();},setCurrentTime:function(a){if(!document.gifpreview)return;document.gifpreview[0].SetTime(Math.floor(a*document.gifpreview[0].GetTimeScale()));},getDuration:function(){if(!document.gifpreview)return;return document.gifpreview?Math.floor(document.gifpreview[0].GetDuration()/document.gifpreview[0].GetTimeScale()):0;},getCurrentTime:function(){if(!document.gifpreview)return;return document.gifpreview?Math.floor(document.gifpreview[0].GetTime()/document.gifpreview[0].GetTimeScale()):0;},remove:function(){if(!this.$el.length)return;this.pause();this.$video.remove();}};a.QuicktimeFallback=b;})(Giphy);(function(a,b){var c={__mousedown:function(){this.$el.css('height',this.$el.outerHeight());this.$body.on('mouseup.sortable',a.bind(this.__mouseup,this));},__mouseup:function(){this.$el.css('height','');this.$body.off('.sortable');},__reverseClick:function(a){a.preventDefault();$(a.currentTarget).toggleClass('reversed');b.Events.trigger('sortable:reverse');},__linkClick:function(a){a.preventDefault();var b=$(a.currentTarget).data('gif-url');if(b)window.open(b);},__cancelClick:function(a){a.preventDefault();var c=$(a.currentTarget);var d=c.closest('.sortable-list-item');b.Events.trigger('sortable:cancelClick',d.attr('id'));},__stop:function(b,c){a.defer(a.bind(function(){this.$el.find('.sortable-list-item').each(function(){var a=$(this);var b=a.find('.upload-index');b.text(a.index()+1);});},this));},__sort:function(a,b){var c=$(this),d=b.helper.outerWidth(),e=b.helper.outerHeight(),f=b.helper[0].className,g=b.placeholder[0].className;var h={x:b.position.left+d/2,y:b.position.top+e/2};var i=e/2;var j=i/4;c.children().each(function(){var a=$(this);if(a.hasClass(f)||a.hasClass(g))return true;var b={x:a.position().left+d/2,y:a.position().top+e/2};var k=Math.sqrt(Math.pow(b.x-h.x,2)+Math.pow(b.y-h.y,2));if(k<i){var l=b.y-h.y>j;var m=b.y-h.y<-j;var n=b.x-h.x<-j;var o=m||n&&!l;if(o)$("."+g,c).insertBefore(a);else $("."+g,c).insertAfter(a);return false;}});},__remove:function(a){a.preventDefault();var b=$(a.currentTarget).closest("li");var c=b.attr("id");b.remove();this.$el.trigger("removeditem",c);return c;},__update:function(a,b){return;},__submit:function(){this.disable();this.$el.find('.upload-gripper').hide();},__processing:function(a,b){var c=this.$el.find('#'+b.file.id);if(!c.length)return;c.find(".upload-cancel").hide();},__progress:function(a,b){var c=this.progressBars[b.currentFileName];if(c){c.update(b.progress*0.9,1);if(b.progress===100)c.update(99,b.estimatedTime);}},__processingGif:function(a,b){var c=this.$el.find('#'+b.id+' .progress-bar-container');var d=this.progressBars[b.name];if(d)if(b.isComplete)d.complete(function(){d.reset();c.removeClass('processing-gif');});else{d.update(90,10);c.addClass('processing-gif');}},__success:function(b,c){var d=this.$el.find('#'+c.file.id);if(!d.length)return;var e=function(){d.find('.upload-label').text(window.location.host+'/gifs/'+c.gifId);d.find('.upload-success').show();d.addClass('has-link').data('gif-url',c.url);};if(a.has(this.progressBars,c.file.name))this.progressBars[c.file.name].complete(e);else e();},__error:function(b,c){var d=this.$el.find('#'+c.file.id);if(!d.length)return;var e=function(){d.find(".progress-bar-container").addClass("error");d.find(".upload-label").text(c.message||"Sorry! Upload failed. Try again or contact support@giphy.com");};if(a.has(this.progressBars,c.file.name))this.progressBars[c.file.name].complete(e);else e();},initialize:function(a){a=a||{};this.$el=typeof a.el!=="undefined"?$(a.el):$(".sortable");this.$body=$('body');this.placeholder=typeof a.placeholder!=="undefined"?a.placeholder:"sortable-placeholder";this.handle=typeof a.handle!=="undefined"?a.handle:".upload-gripper";this.disabled=typeof a.disabled!=="undefined"?a.disabled:false;this.sort=typeof a.sort!=="undefined"?a.sort:this.__sort;this.update=typeof a.update!=="undefined"?a.update:this.__update;this.progressBars={};this.render();return this;},render:function(){this.$el.sortable({sort:this.sort,handle:this.handle,update:this.update,disabled:this.disabled,placeholder:this.placeholder,stop:a.bind(this.__stop,this)});this.$el.on('mousedown.sortable','.sortable-list-item',a.bind(this.__mousedown,this));this.$el.on('click.sortable','.has-link',a.bind(this.__linkClick,this));this.$el.on('click.sortable','.upload-cancel',a.bind(this.__cancelClick,this));$('#reverse-button').on('click.sortable',a.bind(this.__reverseClick,this));b.Events.on('fileportal:processing',this.__processing,this);b.Events.on('fileportal:progress',this.__progress,this);b.Events.on('fileportal:success',this.__success,this);b.Events.on('fileportal:submit',this.__submit,this);b.Events.on('fileportal:error',this.__error,this);b.Events.on('slideshow:processing',this.__processingGif,this);},append:function(a){a=a||{index:'',name:''};var c=$(this.itemTemplate(a));this.$el.append(c);this.progressBars[a.name]=new b.TimedProgressBar(c.find('.progress-bar-container'));},trim:function(b){if(!b)return;var c=this.$el.find('#'+b.id);if(c.length)c.remove();if(a.has(this.progressBars,b.name))delete this.progressBars[b.name];},empty:function(){this.$el.empty();},reverse:function(){var b=this.$el.children();var c=b.length;b.each(a.bind(function(a,b){var d=$(b);d.find('.upload-index').text(c-a);this.$el.prepend(d);},this));},enable:function(){this.$el.sortable("enable");},disable:function(){this.$el.sortable("disable");},itemTemplate:a.template(['<li id="<%- id %>" class="sortable-list-item">','<div class="upload-icon">','<div class="upload-cancel button red"><i class="ss-icon ss-delete"></i></div>','<a class="upload-success button blue" href="#" target="_blank"><i class="ss-icon ss-action"></i></a>','</div>','<div class="upload-preview"></div>','<div class="upload-progress">','<span class="upload-index"><%- index + 1 %></span>','<span class="upload-label"><%- name %></span>','<div class="progress-bar-container"></div>','</div>','<div class="upload-gripper">','<div class="upload-grip"></div>','</div>','</li>'].join(""))};b.Sortable=c;})(_,Giphy);(function(a,b){var c=function(a){a=a||{};this.$el=$(a.el);this.timestampDelay=null;this.numberKeydownFlag=false;this.minTime=a.minTime||0;this.maxTime=a.maxTime||1;this.render();return this;};c.prototype={__sliderUpdate:function(a,b){this._updateTime(b.value);},__timestampKeydown:function(a){if(a.which===38||a.which===40){a.preventDefault();a.stopPropagation();var b=a.shiftKey?10:1;b*=(a.which==40)?-1:1;this.$slider.trigger('sliderincrement',b);return false;}},__numberInput:function(b){var c=$(b.currentTarget).val();clearTimeout(this.numberInputDelay);this.numberInputDelay=setTimeout(a.bind(function(){this.$slider.trigger('slidervalue',c);},this),this.numberKeydownFlag?1000:0);this.numberKeydownFlag=false;},__numberKeydown:function(a){this.numberKeydownFlag=true;if(a.which===13){a.preventDefault();a.stopPropagation();clearTimeout(this.numberInputDelay);this.$slider.trigger('slidervalue',$(a.currentTarget).val());this.numberKeydownFlag=false;return false;}else if(a.which===38||a.which===40)this.numberKeydownFlag=false;},__timestampInput:function(c){var d=$(c.currentTarget);var e=d.html();clearTimeout(this.timestampDelay);if(isNaN(e.replace(/:\s*/g,''))){c.preventDefault();d.html(b.Utils.formatTime(this.currentTime));return;}this.timestampDelay=setTimeout(a.bind(function(){var a=Math.min(this._parseTime(e),this.maxTime);this.$slider.trigger('slidervalue',a);this.$timestamp.blur();},this),1000);},__timestampFocus:function(a){var b=document.createRange();var c=window.getSelection();b.selectNodeContents(a.currentTarget);c.removeAllRanges();c.addRange(b);},_parseTime:function(b){if(!b)return 0;var c=0;var d=a.map(b.split(':'),function(a){return isNaN(a)?0:parseInt(a,10);});d=a.last(d,3);switch(d.length){case 3:c=(d[0]*60*60)+(d[1]*60)+d[2];break;case 2:c=(d[0]*60)+d[1];break;case 1:c=d[0];break;}return c;},_updateTime:function(a,c){this.currentTime=a;if(this.$timestamp.length)this.$timestamp.text(b.Utils.formatTime(this.currentTime));if(this.$numberInput.length)this.$numberInput.val(Number(this.currentTime.toFixed(2)));if(!c)this.$el.trigger('timeupdate',this.currentTime);},_cacheSelectors:function(){this.$slider=this.$el.find('*[data-ui*="slider"]');this.$input=this.$el.find('.time-input');this.$startTime=this.$el.find('.start-time-label');this.$endTime=this.$el.find('.end-time-label');this.$timestamp=this.$el.find('.timestamp-input');this.$numberInput=this.$el.find('.number-input');},render:function(){if(!this.$el.length)return;this._cacheSelectors();this.$el.on('keydown.time-slider','.timestamp-input',a.bind(this.__timestampKeydown,this));this.$el.on('input.time-slider','.timestamp-input',a.bind(this.__timestampInput,this));this.$el.on('click.time-slider','.timestamp-input',a.bind(this.__timestampFocus,this));this.$el.on('input.time-slider','.number-input',a.bind(this.__numberInput,this));this.$el.on('keydown.time-slider','.number-input',a.bind(this.__numberKeydown,this));this.$slider.on('sliderupdate.time-slider',a.throttle(a.bind(this.__sliderUpdate,this),100));this.$slider.trigger('update',{min:this.minTime,max:this.maxTime});},remove:function(){if(!this.$el.length)return;this.$slider.trigger('reset');this.$el.off('.time-slider');this.$slider.off('.time-slider');}};b.TimeControl=c;})(_,Giphy);(function(a,b){var c=function(a){this.$el=$(a);this.$progress=$('<div class="progress"></div>');this.$stripes=$('<div class="stripes"></div>');this.$text=$('<div class="text"></div>');this.animationEnd='animationend webkitAnimationEnd oAnimationEnd msAnimationEnd';this.transitionTimeout=null;this._render();};c.prototype._render=function(){this.$el.append(this.$text);this.$el.append(this.$progress);this.$progress.append(this.$stripes);this.$el.addClass('timed-progress-bar');};c.prototype.updateWithText=function(b,c,d,e){if(this.transitionTimeout)clearTimeout(this.transitionTimeout);this.$progress.addClass('notransition');this.$progress.css({'transition':'width '+d+'s','-webkit-transition':'width '+d+'s','-o-transition':'width'+d+'s','-ms-animation':'width'+d+'s'});this.$progress[0].offsetHeight;this.$progress.removeClass('notransition');c=Math.max(0,Math.min(Math.round(c),100));this.$progress.css('width',c+'%');this.$text.text(b);this.transitionTimeout=setTimeout(a.bind(function(){if(c==100){this.$el.addClass('complete').one(this.animationEnd,a.bind(function(){if(e)e();},this));}else if(e)e();},this),d*1000);};c.prototype.completeWithText=function(a,b){this.updateWithText(a,100,1,b);};c.prototype.update=function(a,b,c){this.updateWithText('',a,b,c);};c.prototype.complete=function(a){this.completeWithText('',a);};c.prototype.reset=function(){this.update(0,0);};b.TimedProgressBar=c;})(_,Giphy);(function(a){var b={__loadedMeta:function(b){var c=this.video.videoHeight/this.video.videoWidth;var d=this.$el.width();var e=this.$el.width();var f=e*c;if(f>this.maxHeight){f=this.maxHeight;e=f/c;}this.$el.data({videoHeight:this.video.videoHeight,videoWidth:this.video.videoWidth,scale:e/d}).css({height:f,width:e});this._resetVideoLoop();a.Events.trigger('preview:ready',this.video.duration);},__error:function(){this.remove();a.CreationErrors.show('INVALID_VIDEO');},__seeked:function(){this._resetVideoLoop();},__fallbackReady:function(){this._resetVideoLoop();a.Events.trigger('preview:ready',this.fallback.getDuration());},_resetVideoLoop:function(){clearTimeout(this.timer);this.timer=setInterval(_.bind(this._updateVideo,this),100);},_updateVideo:function(){if(this.isSeeking)return;if(this.currentTime>=this.endTime){this.currentTime=this.startTime;if(this.fallback){clearTimeout(this.timer);this.fallback.setCurrentTime(this.startTime);this.fallback.play();}else{clearTimeout(this.timer);this.video.pause();this.video.currentTime=this.startTime;}}this.currentTime+=0.1;if(this.video&&(this.video.paused||this.video.ended))this.video.play();},_updateFallback:function(){if(!this.fallback||this.isSeeking)return;var a=this.fallback.getCurrentTime();if(a>=this.endTime){this.fallback.setCurrentTime(this.startTime);this.fallback.play();}},initialize:function(a){a=a||{};this.$el=$(a.el||'');this.$video=$();this.src=a.src||'';this.video=null;this.startTime=a.startTime||0;this.endTime=a.endTime||10;this.timer=null;this.fallback=null;this.extension=a.extension;this.seekTimeout=null;this.isSeeking=false;this.maxHeight=380;this.currentTime=this.startTime;this.render();return this;},render:function(){if(!this.src||!this.$el.length)return;this.video=document.createElement('video');this.video.autoplay=true;this.video.controls=false;this.video.loop=false;this.video.muted=true;this.video.type='video/mp4';this.video.src=this.src;this.$video=$(this.video);this.$el.html(this.video);this.$video.one('loadedmetadata.video-preview',$.proxy(this.__loadedMeta,this));this.$video.on('seeked.video-preview',$.proxy(this.__seeked,this));this.$video.on('error.video-preview',$.proxy(this.__error,this));},renderQuicktimeFallback:function(){this.fallback=a.QuicktimeFallback.initialize({el:this.$el,src:this.src});a.Events.on('quicktime:ready',this.__fallbackReady,this);},updateTime:function(a,b,c){if(!this.fallback&&!this.video)return;var d=(this.fallback)?this.fallback.getDuration():this.video.duration;b=b||1;a=Math.min(a||0,d-b);this.isSeeking=true;this.startTime=a;this.endTime=a+b;clearTimeout(this.seekTimeout);this.currentTime=c?this.endTime-0.001:this.startTime;if(this.fallback){this.fallback.pause();this.fallback.setCurrentTime(this.currentTime);}else{this.video.pause();this.video.currentTime=this.currentTime;}this.seekTimeout=setTimeout(_.bind(function(){this.isSeeking=false;this.fallback?this.fallback.play():this.video.play();},this),1000);},remove:function(){if(!this.$el.length)return;this.$video.off('.video-preview');this.$el.empty().removeData().css({height:'',width:''});clearTimeout(this.timer);if(this.fallback){this.fallback.remove();this.fallback=null;}}};a.VideoPreview=b;})(Giphy);(function(a,b){var c={__playerReady:function(){this.player.api('setVolume',0);this.player.api('getDuration',a.bind(function(a){this.duration=a;this.player.api('play');this._playVideo();b.Events.trigger('preview:ready',this.duration);},this));},_playVideo:function(){if(this.isSeeking)return;clearInterval(this.timer);this.timer=setInterval(a.bind(this._checkVideoStatus,this),100);},_pauseVideo:function(){if(this.isSeeking)return;clearInterval(this.timer);this.player.api('play');a.defer(a.bind(function(){this.player.api('seekTo',this.startTime);},this));},_checkVideoStatus:function(){if(!this.player||this.isSeeking)return;this.currentTime+=0.1;this.player.api('paused',a.bind(function(){this.player.api('play');},this));if(this.currentTime>=this.endTime){this.currentTime=this.startTime;this.player.api('seekTo',this.startTime);}b.Events.trigger('preview:currentTimeUpdate',this.currentTime);},_loadVimeoApi:function(){var b=document.createElement('script');b.src="//f.vimeocdn.com/js/froogaloop2.min.js";var c=document.getElementsByTagName('script')[0];c.parentNode.insertBefore(b,c);var d=0;var e=500;var f=8000;this.apiCheck=setInterval(a.bind(function(){d+=e;if(window.$f){clearInterval(this.apiCheck);this.apiReady();}else if(d>=f)clearInterval(this.apiCheck);},this),e);},initialize:function(a){a=a||{};this.$el=$(a.el||'');this.videoId=a.id;this.player=null;this.apiCheck=null;this.minWidth=a.minWidth||480;this.duration=0;this.startTime=a.startTime||0;this.endTime=a.endTime||10;this.timer=null;this.currentTime=this.startTime;this.seekTimeout=null;this.isSeeking=false;this.render();return this;},render:function(){if(!this.$el.length||!this.videoId)return;this.$el.html(this.template({id:this.videoId,width:this.$el.width(),height:this.$el.height()}));if(!window.$f)this._loadVimeoApi();else this.apiReady();},apiReady:function(){if(!window.$f)return;var b=this.$el.find('#preview')[0];this.player=$f(b);this.player.addEvent('ready',a.bind(this.__playerReady,this));this.player.addEvent('play',a.bind(this._playVideo,this));this.player.addEvent('pause',a.bind(this._pauseVideo,this));this.player.addEvent('finish',a.bind(this._pauseVideo,this));},remove:function(){},updateTime:function(b,c,d){if(!this.player)return;c=c||1;b=Math.min(b||0,this.duration-c-1);this.isSeeking=true;this.startTime=b;this.endTime=b+c;clearTimeout(this.seekTimeout);this.player.api('pause');this.currentTime=d?this.endTime-0.001:this.startTime;this.player.api('seekTo',this.currentTime);this.seekTimeout=setTimeout(a.bind(function(){this.isSeeking=false;this.player.api('play');},this),1000);},template:a.template(['<div id="vimeo-preview">','<iframe id="preview" src="https://player.vimeo.com/video/<%- id %>','?api=1','&autoplay=0','&badge=0','&byline=0','&color=9840fb','&loop=0','&portrait=0','&title=0','&player_id=preview" width="<%- width %>" height="<%- height %>" frameborder="0"','</iframe>','</div>'].join(""))};b.VimeoPreview=c;})(_,Giphy);(function(a,b){var c={__playerReady:function(){this.player.setVolume(0);this.duration=this.player.getDuration();b.Events.trigger('preview:ready',this.duration);},__playerStateChange:function(b){if(this.isSeeking)return;clearInterval(this.timer);switch(b.data){case 1:this.timer=setInterval(a.bind(this._checkVideoStatus,this),100);break;case 0:case 2:this.player.seekTo(this.startTime,true);this.player.playVideo();break;}},_loadYoutubeApi:function(a){var b=document.createElement('script');b.src="https://www.youtube.com/iframe_api";var c=document.getElementsByTagName('script')[0];c.parentNode.insertBefore(b,c);window.onYouTubeIframeAPIReady=a;},_checkVideoStatus:function(){if(!this.player||this.isSeeking)return;this.currentTime+=0.1;if(this.currentTime>=this.endTime){this.currentTime=this.startTime;this.player.seekTo(this.startTime);}b.Events.trigger('preview:currentTimeUpdate',this.currentTime);},initialize:function(b){b=b||{};this.$el=$(b.el||'');this.videoId=b.id;this.minWidth=b.minWidth||480;this.player=null;this.duration=0;this.startTime=b.startTime||0;this.endTime=b.endTime||10;this.timer=null;this.currentTime=this.startTime;this.seekTimeout=null;this.isSeeking=false;if(!window.YT)this._loadYoutubeApi(a.bind(function(){this.render();},this));else this.render();return this;},render:function(){if(!window.YT||!this.$el.length)return;window.onYouTubeIframeAPIReady=null;this.$el.html(this.template());this.player=new window.YT.Player('youtube-preview',{width:this.$el.width(),height:this.$el.height(),videoId:this.videoId,playerVars:{autoplay:'1',controls:'0',iv_load_policy:'3',rel:'0',fs:'0',showinfo:'0',start:this.startTime},events:{onReady:a.bind(this.__playerReady,this),onStateChange:a.bind(this.__playerStateChange,this)}});},remove:function(){if(!this.$el.length)return;this.duration=0;if(this.timer){clearInterval(this.timer);this.timer=null;}if(this.player){this.player.stopVideo();this.player=null;}this.$el.html('').css({height:'',width:''});},updateTime:function(b,c,d){if(!this.player)return;c=c||1;b=Math.min(b||0,this.duration-c-1);this.isSeeking=true;this.startTime=b;this.endTime=b+c;clearTimeout(this.seekTimeout);this.player.pauseVideo();this.currentTime=d?this.endTime-0.001:this.startTime;this.player.seekTo(this.currentTime,true);this.seekTimeout=setTimeout(a.bind(function(){this.isSeeking=false;this.player.playVideo();},this),1000);},template:a.template('<div id="youtube-preview"></div>')};b.YoutubePreview=c;})(_,Giphy);(function(){var a=Giphy.Etc={init:function(){$.ajaxSetup({beforeSend:function(a){a.setRequestHeader("Authorization","ApiKey giphy-website:e0771ed7b244ec9c942bea646ad08e6bf514f51a");}});},reAuthFacebook:function(){FB.login(function(a){if(a.status=='connected'){window.FACEBOOK_PERMISSION=true;window.FB_ACCESS_TOKEN=a.authResponse.accessToken;$.ajax({type:"POST",url:"/login/fb/update",data:{access_token:a.authResponse.accessToken},success:function(a,b,c){},error:function(a,b,c){}});}},{scope:'email,publish_actions'});},checkPermission:function(a){var b=function(){return setTimeout(function(){console.log("etc.js got called");FB.api("/me/permissions",{access_token:window.FB_ACCESS_TOKEN},function(b){for(var c=0;c<b.data.length;c++)if(b.data[c].permission=='publish_actions'&&b.data[c].status=='granted')window.FACEBOOK_PERMISSION=true;if(!window.FACEBOOK_PERMISSION)Giphy.Etc.reAuthFacebook();else a();});},1000);};if(typeof FB!="undefined")b();else window.fbAsyncInit=function(){return b();};},checkLogin:function(a){if(window.HAS_CHECKED_LOGIN)a.success();$.ajax({type:"GET",url:"/login/check/",dataType:"json",success:function(b){window.LOGGED_IN=b.result.logged_in;window.IS_PARTNER=b.result.is_partner;window.IS_ARTIST=b.result.is_artist;window.IS_STAFF=b.result.is_staff;window.HAS_CHECKED_LOGIN=true;window.FB_AUTH=b.result.fb_auth;window.FB_ID=b.result.fb_id;if(window.FB_AUTH)window.FB_ACCESS_TOKEN=b.result.fb_access_token;if(typeof b.result.user!==undefined)window.USER=b.result.user;for(var c=0;c<b.result.messages.length;c++){var d=b.result.messages[c];var e=d.tags;var f=d.text;var g=$("<div>");g.addClass("flash");g.addClass(e);g.text(f);$("#messages").append(g);setTimeout(function(){$('.flash').fadeOut('slow');},3000);}$(window).trigger("login:check");if(a!=undefined&&a.success!=undefined)a.success();},error:function(a,b,c){window.LOGGED_IN=false;window.IS_PARTNER=false;}});return this;}};})(window,Giphy);(function(a){var b={el:$({}),trigger:function(a){if(!a)return;var b=Math.max(0,arguments.length-1);var c=Array(b);for(var d=0;d<b;d++)c[d]=arguments[d+1];this.el.trigger(a,c);},on:function(a,b,c){if(!a||!b)return;this.el.on(a+'.giphy-events',function(){b.apply(c,arguments);});},off:function(a){if(!a)return;this.el.off(a+'.giphy-events');}};a.Events=b;})(Giphy);(function(){var a=Giphy.Favorites={nav:function(){$("#favorites-nav").click(function(a){if(!window.LOGGED_IN){window.location="https://"+document.domain+"/login/?next=/favorites";return false;}});},permalink:function(){if($(".gif-detail").length>0){var a=$("#gif").attr("data-gif_id");$.ajax({type:"get",url:"/favorites/"+a+"/",success:function(a){$(".favorite").each(function(b){var c=$(this);if(a.result.has_favorited){c.addClass('favorited');c.addClass('_011_heart_red');c.removeClass('_012_heart_white');}else{c.removeClass('favorited');c.addClass('_012_heart_white');c.removeClass('_011_heart_red');}c.show();});}});$(".favorite").unbind('click').bind('click',function(a){if(!window.LOGGED_IN){_gaq.push(['_trackEvent','Favorites','ModalOpened']);_gaq.push(['_trackEvent','Favorites','HeartClick','LoggedOut']);window.location="https://"+document.domain+"/login/?next="+location.pathname+"&ref=fave";return false;}var b=$(this);_gaq.push(['_trackEvent','Favorites','HeartClick','LoggedIn',$(this).attr('data-gif_id')]);if(!b.hasClass('favorited'))$(".favorite").each(function(){$(this).addClass('favorited');$(this).addClass('_011_heart_red');$(this).removeClass('_012_heart_white');});else $(".favorite").each(function(){$(this).removeClass('favorited');$(this).addClass('_012_heart_white');$(this).removeClass('_011_heart_red');});$.ajax({type:"post",url:"/favorites/"+$(this).attr('data-gif_id')+"/",success:function(a){if(a.result.has_favorited)showSuccess("Added to favorites!");else showSuccess("Removed from favorites!");}});return false;});$(".favorite").mouseenter(function(a){var b=$(this);if(!b.hasClass('favorited')){b.addClass('_011_heart_red');b.removeClass('_012_heart_white');}else{b.removeClass('_011_heart_red');b.addClass('_012_heart_white');}});$(".favorite").mouseleave(function(a){var b=$(this);if(!b.hasClass('favorited')){b.removeClass('_011_heart_red');b.addClass('_012_heart_white');}else{b.addClass('_011_heart_red');b.removeClass('_012_heart_white');}});}}};})(window,Giphy);(function(){var a=Giphy.Facebook={search:function(a){$(".choice.active").removeClass("active");$("#searchresults").html('');$("#no-results").hide();$("#searchresults").show();$("#searchresults").addClass("loading");$.ajax({url:"/ajax/fb/tag/"+a,method:"GET",success:function(a){$("#searchresults").removeClass("loading");$("#searchresults").html(a);Giphy.SearchResults.attachInfiniteScroll();Giphy.Images.sizeImages("#searchresults");var b=$(".hoverable li, .row-tag, .featured-item, .featured-user");if(b.length==0){$("#no-results").show();$("#searchresults").hide();}else{$("#no-results").hide();$("#searchresults").show();$(".gifs-gif").each(function(){$(this).attr('src',$(this).data('animated'));});}}});},checkPermissions:function(a,b,c){var d=function(){console.log("fb.js got called");FB.api('/me/permissions',function(d){for(var e=0;e<d.data.length;e++)if(d.data[e].permission=='publish_actions'){window.ACCESS_TOKEN=a;if(b!==undefined)b();return false;}if(c===undefined)FB.login(function(a){if(a.status=='connected')Giphy.Facebook.checkPermissions(a.authResponse.accessToken,b,true);},{scope:'publish_actions, email'});});};if(typeof FB!="undefined")d();else window.fbAsyncInit=function(){return d();};},setup:function(){Giphy.Facebook.search("happy");$(".choice").first().addClass("active");$(document).bind("search:success",function(a,b){$("#searchresults").show();$("#no-results").hide();});$(document).bind('search:execute',function(a){$("#no-results").hide();});$(document).bind('search:dont_display',function(a){$(document).trigger("search:clear");});$(".no-result").on('click',function(){$("#search-box").val($(this).text());$("#placeholder").hide();Giphy.Facebook.search($(this).text());return false;});$(document).bind('images:done_sizing',function(a,b){$("a.gif-link").off('click').on('click',function(){var a=$(this).data('id');if(!window.ACCESS_TOKEN)FB.getLoginStatus(function(b){if(b.status=='connected')Giphy.Facebook.checkPermissions(b.authResponse.accessToken,function(){Giphy.Facebook.showModal(a);});else FB.login(function(b){if(b.status=='connected')Giphy.Facebook.checkPermissions(b.authResponse.accessToken,function(){Giphy.Facebook.showModal(a);});else{}},{scope:'publish_actions, email'});});else Giphy.Facebook.showModal(a);return false;});$(".tags").hide();});$('.choice').on('click',function(){$("#search-box").val($(this).data("tag-encoded"));$("#placeholder").hide();Giphy.Facebook.search($(this).data("tag-encoded"));$(this).addClass('active');return false;});},showModal:function(a){$("#fb_status").val('');$("#fb_details").show();$("#fb_response").hide();$("#fb_submit").show();$("#fb_submitting").hide();$("#fb_status").focus();$("#fb_post").off('click').on('click',function(){$("#fb_submit").hide();$("#fb_submitting").show();$.ajax({url:"/ajax/fb/upload/",method:"POST",data:{"gif_id":a,"status":$("#fb_status").val(),"token":window.ACCESS_TOKEN},success:function(a){$("#fb_submit").hide();$("#fb_submitting").hide();$("#fb_details").hide();$("#fb_response").show();},error:function(){$("#fb_submit").hide();$("#fb_submitting").hide();$("#fb_response").show();$("#fb_response_text").text("Oh no! Something went wrong. Please try posting your status update again.");}});});$("#fb_ok").off('click').on('click',function(){$.modal.close();});$("#fb_cancel").off('click').on('click',function(){$.modal.close();});$("#gif_id").val(a);$("#gif_preview").attr("src","");$("#gif_preview").attr("src","https://media.giphy.com/media/"+a+"/giphy.gif");$("#fb_modal").modal({overlay:"#000",opacity:0.8,modalClass:"lolwhatever",showClose:false,showSpinner:false,zIndex:101});}};})(window,Giphy);(function(a,b){var c={__mousemove:a.throttle(function(a){if(!this.$gif.length)return;this.$gif.css({left:a.pageX,top:a.pageY-this.$win.scrollTop()});this.$gif.toggleClass('right',a.pageX>this.previousPosition.x);this.$gif.toggleClass('left',a.pageX<=this.previousPosition.x);this.previousPosition={x:a.pageX,y:a.pageY};},50),_parseDateString:function(a){var b=new Date();if(!a)return b;var c=a.split('/');if(c.length){b.setMonth(parseInt(c[0],10)-1);if(c.length>1)b=b.setDate(parseInt(c[1],10));}return b;},_checkDateRange:function(){if(!this.dates)return true;var a=this.dates.split('-');if(!a.length)return true;var b=this._parseDateString(a[0].trim());if(a.length>1)endDate=this._parseDateString(a[1].trim());var c=new Date();if(endDate)return c>=b&&c<endDate;else return c>=b;},initialize:function(b){b=b||{};this.$win=$(window);this.$doc=$(document);this.$body=$('body');this.$gif=$();this.backgroundUrl=a.isArray(b.background)?a.sample(b.background):b.background||'';this.cursorUrl=a.isArray(b.cursor)?a.sample(b.cursor):b.cursor||'';this.previousPosition={x:999999999,y:999999999};this.isFlipped=b.flipped||false;this.dates=b.dates||'';this.render();return this;},render:function(){if(!this._checkDateRange())return;if(this.backgroundUrl)this.$body.css('background-image','url('+this.backgroundUrl+')');if(this.cursorUrl)this.renderCursor();},renderCursor:function(){var b=this.template({gif:this.cursorUrl});this.$body.append(b);this.$gif=this.$body.find('.gif-cursor').toggleClass('flipped',this.isFlipped);this.$doc.on('mousemove.gif-cursor',a.bind(this.__mousemove,this));},remove:function(){this.$doc.off('.gif-cursor');},template:a.template('<div class="gif-cursor" style="background-image:url(<%- gif %>)"></div>')};b.FestiveMode=c;})(_,Giphy);(function(a,b){var c={__socialLinkClick:function(b){var c=$(b.currentTarget);var d=c.closest('.social-link');var e=d.data();this._sendAnalytics(e.type);if(e.popup){b.preventDefault();a.Utils.openPopup(c.attr('href'),e.popupWidth||this.popupWidth,e.popupHeight||this.popupHeight);}},__showMoreSocialLinksClick:function(a){a.preventDefault();$(a.currentTarget).remove();this.$socialLinks.removeClass('truncated');},__showMoreActionsClick:function(a){a.preventDefault();this.$moreOptions.toggleClass('hide');var b=this.$moreOptions.hasClass('hide');$(a.currentTarget).text(b?'More options':'Fewer options');if(b)this.$moreOptions.find('.copy-paste .checkmark').remove();},__navButtonClick:function(a){a.preventDefault();var b=$(a.currentTarget);this._toggleAdvancedOptions(b.attr('href')==='#gif-advanced-actions');},__autoplayToggle:function(a,b){var c=this.$jsEmbedInput.val();if(b){delete this.iframeParams.playOnHover;delete this.html5Params.playOnHover;c=c.replace("var _giphy_play_on_hover = true;","");}else{this.iframeParams.playOnHover=true;this.html5Params.playOnHover=true;c=c.replace("var _giphy","var _giphy_play_on_hover = true; var _giphy");}this.$jsEmbedInput.val(c);this._updateEmbedCode();},__socialToggle:function(a,b){if(b){delete this.iframeParams.hideSocial;delete this.html5Params.hideSocial;}else{this.iframeParams.hideSocial=true;this.html5Params.hideSocial=true;}this._updateEmbedCode();},_updateEmbedCode:function(){var a=this.$iframeEmbedInput.val();var b=this.$html5EmbedInput.val();var c=$(a);var d=c.attr('src').split('?')[0];c.attr('src',d+this._objectToQueryString(this.iframeParams));var e=$(b);var f=e.attr('src').split('?')[0];e.attr('src',f+this._objectToQueryString(this.html5Params));this.$iframeEmbedInput.val(c.prop('outerHTML').replace(/&amp;/g,'&'));this.$html5EmbedInput.val(e.prop('outerHTML').replace(/&amp;/g,'&'));},_objectToQueryString:function(a){var b=[];for(var c in a)if(a.hasOwnProperty(c))b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return(b.length)?'?'+b.join('&'):'';},_sendAnalytics:function(a){a=a||'';$.ajax({type:'POST',url:"/ajax/gif/"+this.gifId+"/analytic/"+a,success:function(a){return a;},error:function(){return null;}});},_truncateSocialLinks:function(){if(!this.truncateSocialLinks||!this.$socialLinks.length)return;var a=this.$socialLinks.find('.social-link');var b=3;if(a.length>b){var c=$('<li class="show-more"><i class="ss-icon ss-ellipsis"></i></li>');a.filter(':gt('+(b-1)+')').addClass('hide');this.$socialLinks.addClass('truncated').append(c);}},_toggleAdvancedOptions:function(a){a=a||false;this.$navButtons.removeClass('active');if(a){this.$navButtons.filter('[href="#gif-advanced-actions"]').addClass('active');this.$shareActions.hide();this.$advandedActions.show();}else{this.$navButtons.filter('[href="#gif-share-actions"]').addClass('active');this.$shareActions.show();this.$advandedActions.hide();}},_truncateEmbedOptions:function(){if(!this.$moreOptions.length)return;var a=$('<a class="show-more-actions" href="#">More options</a>');this.$moreOptions.addClass('hide').before(a);},_initializeTwitterUpload:function(){if(a.Utils.getParameterByName("twit_auth")){this._toggleAdvancedOptions(true);$('html, body').animate({scrollTop:this.$advandedActions.offset().top},100);}this.subviews.uploadTwitter=a.UploadToTwitter.initialize({el:this.$el.find('#upload-to-twitter'),gifId:this.gifId});},initialize:function(b){b=b||{};this.options=b;this.shareUrl='';this.permalinkUrl='';this.gifId='';this.popupWidth=b.popupWidth||540;this.popupHeight=b.popupHeight||600;this.scrollbarWidth=a.Utils.getScrollbarWidth()||0;this.truncateSocialLinks=b.truncateSocialLinks||false;this.uploadToTwitter=null;this.gifShortener=null;this.subviews={};this.iframeParams={};this.html5Params={html5:true};this.$el=$(b.el||'.gif-actions');this.render();return this;},cacheSelectors:function(){if(!this.$el.length)return;this.$socialLinks=this.$el.find('.gif-social-links');this.$moreOptions=this.$el.find('.more-actions');this.$copyInputs=this.$el.find('input[data-copy="true"]');this.$autoplayToggle=this.$el.find('.autoplay-toggle');this.$socialToggle=this.$el.find('.social-toggle');this.$iframeEmbedInput=this.$el.find('#iframe-embed-code');this.$html5EmbedInput=this.$el.find('#smart-embed-code');this.$jsEmbedInput=this.$el.find('#optimized-embed-code');this.$navButtons=this.$el.find('.gif-actions-nav .nav-button');this.$shareActions=this.$el.find('#gif-share-actions');this.$advandedActions=this.$el.find('#gif-advanced-actions');},render:function(){if(!this.$el.length)return;this.cacheSelectors();var b=this.$el.data();this.shareUrl=this.options.shareUrl||b.shareUrl;this.permalinkUrl=this.options.permalinkUrl||b.permalinkUrl;this.gifId=this.options.gifId||b.gifId;this.$el.removeClass('no-animate');this._toggleAdvancedOptions(false);if(this.truncateSocialLinks)this._truncateSocialLinks();this._truncateEmbedOptions();this.subviews.instagramModal=a.InstagramModal.initialize({gifId:this.gifId});this.subviews.gifShortener=a.GifShortener.initialize({el:this.$el.find('#gif-shortener'),gifId:this.gifId});this._initializeTwitterUpload();this.$el.on('click.gif-sharing','.social-link a',$.proxy(this.__socialLinkClick,this));this.$el.on('click.gif-sharing','.show-more',$.proxy(this.__showMoreSocialLinksClick,this));this.$el.on('click.gif-sharing','.show-more-actions',$.proxy(this.__showMoreActionsClick,this));this.$el.on('click.gif-sharing','.gif-actions-nav .nav-button',$.proxy(this.__navButtonClick,this));if(this.$autoplayToggle.length)this.$autoplayToggle.on('toggle.gif-sharing',$.proxy(this.__autoplayToggle,this));if(this.$socialToggle.length)this.$socialToggle.on('toggle.gif-sharing',$.proxy(this.__socialToggle,this));},remove:function(){this.$el.off('.gif-sharing');if(this.$autoplayToggle&&this.$autoplayToggle.length)this.$autoplayToggle.off('.gif-sharing');if(this.$socialToggle&&this.$socialToggle.length)this.$socialToggle.off('.gif-sharing');for(var a in this.subviews){var b=this.subviews[a];b.remove();}}};var d={__keyup:function(a){var b=this.$input.val()||'';if(a.which===13&&b.trim().length>0)this.shortenUrl(b);},__focus:function(){this.$input.select();},__input:function(){var a=this.$input.val()||'';this.$button.toggleClass('disabled',a.trim().length<1);this._reset();},__copy:function(){if(!this.isShortened)return;window.showSuccess('Copied to clipboard!');},__click:function(a){a.preventDefault();var b=$(a.currentTarget);if(b.hasClass('disabled')||b.hasClass('saving'))return;this.shortenUrl(this.$input.val());},__success:function(a){if(!a||!a.result||a.result.code!==200){this.__error();return;}this.$input.val(a.result.short_url);this.$input.focus().select();this.isShortened=true;this.$el.addClass('saved');this.$button.removeClass('saving').addClass('saved').text(this.savedLabel);},__error:function(){this.$button.removeClass('saving').addClass('error').text(this.errorLabel);window.showError('An error has occurred.');},_reset:function(){this.isShortened=false;this.$el.removeClass('saved');this.$button.removeClass('saving saved error').text(this.label);},initialize:function(a){a=a||{};this.gifId=a.gifId||$('#gif').data('gif_id');this.savingLabel=a.savingLabel||'Shortening';this.savedLabel=a.savedLabel||'Booyah!';this.errorLabel=a.errorLabel||'Oops...';this.label='';this.isShortened=false;this.$el=$(a.el||'#gif-shortener');this.$input=$();this.$button=$();this.render();return this;},render:function(){if(!this.$el.length)return;this.$input=this.$el.find('.gif-shortener-input');this.$button=this.$el.find('.gif-shortener-button');this.label=this.$button.text();this.$el.on('keyup.gif-shortener','.gif-shortener-input',$.proxy(this.__keyup,this));this.$el.on('click.gif-shortener','.gif-shortener-input',$.proxy(this.__focus,this));this.$el.on('copy.gif-shortener','.gif-shortener-input',$.proxy(this.__copy,this));this.$el.on('input.gif-shortener','.gif-shortener-input',$.proxy(this.__input,this));this.$el.on('click.gif-shortener','.gif-shortener-button',$.proxy(this.__click,this));},remove:function(){if(!this.$el.length)return;this._reset();this.$el.off('.gif-shortener').remove();},shortenUrl:function(a){a=a||'';if(!a.trim().length)return;this.$button.addClass('saving').text(this.savingLabel);$.ajax({type:'POST',url:'//'+window.ASSET_DOMAIN+'/ajax/shorturl/create/',data:{gif_id:this.gifId,redirect_to:a},success:$.proxy(this.__success,this),error:$.proxy(this.__error,this)});}};var e={__input:function(){this._reset();this.updateTweet();},__blur:function(){var a=this.$input.val();var b=this.$input.data();if(b.originalValue&&!a.length){this.$text.html('<i>'+b.originalValue+'</i>&nbsp;');this.updateTweet();}},__keydown:function(a){if(a.which===13){a.preventDefault();a.stopPropagation();this.tweet();return false;}},__click:function(a){a.preventDefault();var b=$(a.currentTarget);if(b.hasClass('disabled')||b.hasClass('too-long')||b.hasClass('saving'))return;this.tweet();},__logoutClick:function(a){a.preventDefault();$.removeCookie('giphy-twitter-upload');window.location=a.currentTarget.href;},_reset:function(){this.$button.removeClass('saved saving').text(this.buttonLabel);this.$text.removeClass('readonly');},_setInputHeight:function(){if(!this.$preview.length)return;var a=this.$preview.attr('src');var b=new Image();var c=this.$preview.width();b.onload=$.proxy(function(){var a=c/b.width;this.$text.height(Math.round(b.height*a)-20);},this);b.src=a;},initialize:function(a){a=a||{};this.gifId=a.gifId||$('#gif').data('gif_id');this.maxCharacters=a.maxCharacters||117;this.cookie=$.cookie("giphy-twitter-upload");this.tweetingLabel=a.tweetingLabel||"Tweetin'";this.successLabel=a.successLabel||'Tweeted!';this.buttonLabel='';this.linkText='';this.$el=$(a.el||'#upload-to-twitter');this.$count=$();this.$button=$();this.$preview=$();this.render();return this;},render:function(){if(!this.$el.length)return;this.$count=this.$el.find('.tweet-count');this.$button=this.$el.find('.tweet-button');this.$input=this.$el.find('.tweet-input');this.$text=this.$el.find('.tweet-text');this.$loginButtons=this.$el.find('.login-buttons');this.$preview=this.$el.find('.image-preview');this.buttonLabel=this.$button.text();this.linkText=this.$input.val();this._setInputHeight();this.$el.on('click.upload-twitter','.tweet-button',$.proxy(this.__click,this));this.$el.on('input.upload-twitter','.tweet-text',$.proxy(this.__input,this));this.$el.on('keydown.upload-twitter','.tweet-text',$.proxy(this.__keydown,this));this.$el.on('blur.upload-twitter','.tweet-text',$.proxy(this.__blur,this));this.$el.on('click.upload-twitter','.logout',$.proxy(this.__logoutClick,this));this.updateTweet();this.updateLoginStatus();},remove:function(){this.$el.off('.upload-twitter');},tweet:function(){var a=this.$input.val();if(!a||a.length>this.maxCharacters)return;this.$button.addClass('saving').text(this.tweetingLabel);this.$text.addClass('readonly');$.ajax({type:'POST',url:'/ajax/twitter_upload',data:{gif_id:this.gifId,status:a},success:$.proxy(function(a){if(!a.result||!a.result.response||!a.result.response.meta){this._reset();return;}var b=a.result.response.meta;if(b.status&&b.status===200){this.$button.removeClass('saving').addClass('saved').text(this.successLabel);this.$text.removeClass('readonly');window.showSuccess('Your tweet has been sent.');}else if(b.msg){this._reset();window.showError('ERROR: '+b.msg);}if(b.status&&b.status===400){this.cookie=null;this._reset();this.updateLoginStatus();}},this),error:$.proxy(function(){this._reset();window.showError('An error has occurred. Please try again later.');},this)});},updateTweet:function(){var a=this.$text.text().replace('&nbsp;',' ');var c=[];var d=this.maxCharacters;this.$input.val(a);if(b)c=b.txt.extractUrls(a);for(var e=0;e<c.length;e++){a=a.replace(c[e],'');if(c[e].toLowerCase().substring(0,5)=='http:')d-=22;else d-=23;}d-=a.length;this.$count.text('('+d+')').toggleClass('too-long',d<0);this.$button.toggleClass('too-long',d<0);},updateLoginStatus:function(){if(this.cookie){this.$el.addClass('logged-in');this.$button.removeClass('disabled');this.$text.removeClass('readonly');}else{this.$el.removeClass('logged-in');this.$button.addClass('disabled');this.$text.addClass('readonly');}}};var f={__keydown:function(a){if(a.which===13){a.preventDefault();this.submitEmail();}},__click:function(a){a.preventDefault();this.submitEmail();},initialize:function(a){a=a||{};this.gifId=a.gifId||$('#gif').data('gif_id');this.url=a.url||'/ajax/instashare/';this.savingButtonText=a.savingButtonText||'Sending';this.successButtonText=a.successButtonText||'Sent!';this.successText=a.successText||'Success! Check your email in about 5 minutes. We sent you a GIF you can upload to Instagram.';this.errorText=a.errorText||'UH OH! Something went wrong. Try again?';this.$body=$('body');this.render();return this;},render:function(){this.$body.on('keydown.instagram-modal','.rad-modal .instagram-input',$.proxy(this.__keydown,this));this.$body.on('click.instagram-modal','.rad-modal .instagram-send-button',$.proxy(this.__click,this));},remove:function(){this.$body.off('.instagram-modal');},submitEmail:function(){var b=this.$body.find('.rad-modal .instagram-input');var c=this.$body.find('.rad-modal .instagram-send-button');var d=c.text();var e=b.val();if(!e||e.indexOf('@')<0)return;c.addClass('saving').text(this.savingButtonText);$.ajax({type:'POST',url:this.url,data:{'gif_id':this.gifId,'to':e},success:$.proxy(function(b){if(b.result&&b.result.code===200){window.showSuccess('Success! Check your email in about 5 minutes. We sent you a GIF you can upload to Instagram.');c.removeClass('saving').addClass('saved').text(this.successButtonText);a.Events.trigger('radmodal:close');}else{window.showError(this.errorText);c.removeClass('saving').text(d);}},this),error:$.proxy(function(){window.showError(this.errorText);c.removeClass('saving').text(d);},this)});}};a.GifActions=c;a.GifShortener=d;a.UploadToTwitter=e;a.InstagramModal=f;})(Giphy,twttr);(function(a){var b={__beforeUnload:function(){if(!window.sessionStorage)return;window.sessionStorage.setItem('giphy_history',null);},__popstate:function(a){var b=a.originalEvent.state;if(!b)return;if(b.gif){this.refresh(b);this.navigation.updatePositionByUrl(window.location.pathname);}},__keydown:function(a){var b=$(a.target);if((b.is(':input')||b.is('div[contenteditable="true"]'))&&b.attr('id')!=='search-box')return;switch(a.which){case 39:a.preventDefault();var c=this.navigation.next();if(c&&c.current)this.navigateTo(c.current.url);break;case 37:a.preventDefault();var c=this.navigation.previous();if(c&&c.current)this.navigateTo(c.current.url);break;case 38:if(this.modes){a.preventDefault();this.modes.renderOverlay(a.shiftKey||a.metaKey);}break;case 40:if(this.modes&&this.modes.isOverlayed){a.preventDefault();this.modes.removeOverlay();}break;}},__editToggle:function(){this.navigateTo(window.location.pathname);},__editClick:function(b){b.preventDefault();if(a.GifEdit)a.GifEdit.toggleEditMode(true);},__navigationReady:function(a,b){this._updateArrows(b);},__arrowClick:function(a){a.preventDefault();var b=$(a.currentTarget);var c=b.hasClass('previous-button');var d=c?this.navigation.previous():this.navigation.next();if(d.current)this.navigateTo(d.current.url);},_updateArrows:function(a){if(!a)return;if(a.previous){var b=a.previous.preview||'';this.$arrows.show();this.$previousArrow.show().find('.preview').css('background-image','url('+b+')');}else this.$previousArrow.hide();if(a.next){var b=a.next.preview||'';this.$arrows.show();this.$nextArrow.show().find('.preview').css('background-image','url('+b+')');}else this.$nextArrow.hide();},initialize:function(b){b=b||{};this.$win=$(window);this.$body=$('body');this.$el=$('#gif-detail');this.$gif=$();this.$arrows=$();this.gifData={};this.subviews={};this.isMp4=false;this.routerMap={actions:'#gif-actions-wrapper',gif:{meta:'.gif-meta',figure:'.gif-figure',navigation:'.gif-navigation',source:'.gif-source',tv:'.gif-button.tv'},metadata:'.gif-figure-wrapper',tags:'#tags-wrapper'};this.navigation=a.GifNavigation.initialize({gifData:$('#gif').data()});this.modes=a.GifModes.initialize();this.render(true);this.$win.on('popstate',$.proxy(this.__popstate,this));this.$win.on('keydown',$.proxy(this.__keydown,this));this.$win.on('beforeunload',$.proxy(this.__beforeUnload,this));a.Events.on('gifnavigation:ready',$.proxy(this.__navigationReady,this));a.Events.on('gifnaviagtion:update',$.proxy(this.__navigationReady,this));},render:function(b){if(!this.$el.length)return;this.$gif=this.$el.find('#gif');this.$arrows=this.$el.find('.gif-arrows');this.$previousArrow=this.$arrows.find('.previous-button');this.$nextArrow=this.$arrows.find('.next-button');if(b)this.$arrows.hide();else this._updateArrows(this.navigation.getData());this.gifData=this.$gif.data();this.html5Player();this.subviews.loggedIn=a.GifLoggedIn.initialize({el:this.$el,gifData:this.gifData});this.subviews.related=a.GifRelated.initialize({gifData:this.gifData});if(a.GifActions)a.GifActions.initialize({truncateSocialLinks:false});if(a.GifTracking){var c=this;var d=a.GifTracking.trackView(this.gifData.gif_id);$.when(d).then(function(){var a=d.responseJSON.result.views.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),b=c.$el.find('.view-count');if(b)b.text(a+" views");});}this.$el.on('click.gif-detail','.gif-navigation .edit',$.proxy(this.__editClick,this));this.$el.on('click.gif-detail','.gif-arrows .next-button',$.proxy(this.__arrowClick,this));this.$el.on('click.gif-detail','.gif-arrows .previous-button',$.proxy(this.__arrowClick,this));a.Events.on('gifedit:toggle',$.proxy(this.__editToggle,this));setTimeout($.proxy(function(){this.$el.removeClass('no-animate');},this),100);},remove:function(){this.$el.off('.gif-detail').addClass('no-animate');for(var b in this.subviews){this.subviews[b].remove();this.subviews[b]=null;}if(a.GifActions)a.GifActions.remove();this.gifData=null;this.subviews={};this.isMp4=false;a.Events.off('gifedit:toggle');},html5Player:function(){var b=a.Utils.getParameterByName('html5');var c=a.Utils.canPlayMP4();var d=this.$gif.closest('.gif-figure');if(!b||b!=='true'||!c)return;var e=$('<video>',{id:'gif-mp4',height:this.$gif.height(),width:this.$gif.width(),poster:this.gifData.still,autoplay:true,loop:true});e.data('original-height',this.gifData.originalHeight).data('original-width',this.gifData.originalWidth).append('<source src="'+this.gifData.mp4_url+'" type="video/mp4"></source>');d.empty().append(e);this.isMp4=true;},navigateTo:function(b){if(!b)return;a.GifRouter.navigateTo(b).done($.proxy(this.refresh,this));},refresh:function(a){this.remove();for(var b in this.routerMap)if(b==='gif'){var c=this.$el.find('#gif-wrap');var d=$('<div></div>').html(a[b]);for(var e in this.routerMap[b]){var f=this.routerMap[b][e];var g=c.find(f);if(g.length)g.replaceWith(d.find(f));}}else if(b==='metadata'){var h=this.$el.find(this.routerMap[b]);h.find('meta').remove();h.prepend(a[b]);}else this.$el.find(this.routerMap[b]).html(a[b]);this.render();this.modes.update();}};a.GifDetail=b;})(Giphy);(function(a,b){var c={__click:function(b){b.preventDefault();if(!window.LOGGED_IN){a.push(['_trackEvent','Favorites','HeartClick','LoggedOut']);window.location='/login?next='+window.location.pathname+'&ref=fave';return;}var c=!this.$favoriteButtons.data('favorited');this.$favoriteButtons.removeClass('is-favorite').toggleClass('favorited',c).toggleClass('unfavorited',!c);a.push(['_trackEvent','Favorites','HeartClick','LoggedIn',this.gifId]);this._updateStatus();},__success:function(a){if(!a.result)return;this.isFavorited=a.result.has_favorited;this.update();window.showSuccess((this.isFavorited)?'Added to your favorites!':'Removed from your favorites.');},_updateStatus:function(){$.ajax({type:'POST',url:'/favorites/'+this.gifId+'/',success:$.proxy(this.__success,this)});},initialize:function(a){a=a||{};this.$el=$(a.el||'.gif-detail');this.$favoriteButtons=$();this.gifId=a.gifId||$('#gif').data('gif_id');this.isFavorited=a.isFavorited||false;this.render();return this;},render:function(){if(!this.$el.length)return;this.$favoriteButtons=this.$el.find('.favorite').hide();this.$el.on('click.gif-favorite','.favorite',$.proxy(this.__click,this));this.update();},update:function(){this.$favoriteButtons.show().toggleClass('is-favorite',this.isFavorited).data('favorited',this.isFavorited);},remove:function(){this.$el.off('.gif-favorite');}};b.GifFavorite=c;})(_gaq,Giphy);(function(a,b){var c={__success:function(a){if(a.status===200){var b=a.result;this.renderFavorite(b.is_favorite);if(b.can_edit)this.renderEdit();if(b.view_count)this.renderViewCount(b.view_count);}this.xhr=null;},initialize:function(a){a=a||{};this.$el=$(a.el||'#gif-detail');this.$editButton=$('<a class="gif-button edit"></a>');this.gifData=a.gifData||{};this.subviews={};this.xhr=null;this.render();return this;},cacheSelectors:function(){this.$navigation=this.$el.find('.gif-navigation');this.$source=this.$el.find('.gif-source');},render:function(){if(!this.$el.length)return;this.cacheSelectors();this.xhr=$.ajax({url:'/ajax/gif/'+this.gifData.gif_id+'/info',type:'GET',success:$.proxy(this.__success,this)});},renderEdit:function(){this.subviews.edit=b.GifEdit.initialize({gifId:this.gifData.gif_id,editUrl:this.gifData.editUrl,absoluteUrl:this.gifData.absoluteUrl});if(!this.$navigation.length)return;this.$editButton.attr('href',this.gifData.editUrl);this.$navigation.prepend(this.$editButton);},renderFavorite:function(a){this.subviews.favorite=b.GifFavorite.initialize({el:this.$navigation,gifId:this.gifData.gif_id,isFavorited:a||false});},renderViewCount:function(a){this.subviews.viewCount=b.GifViewCount.initialize({el:this.$source,viewCount:a});},remove:function(){if(this.xhr)this.xhr.abort();a.each(this.subviews,function(a){a.remove();});this.$editButton.attr('href','').remove();this.subviews={};this.xhr=null;}};b.GifLoggedIn=c;})(_,Giphy);(function(a){var b={__click:function(a){a.preventDefault();this.removeOverlay();},__tvClick:function(b){b.preventDefault();var c=$(b.currentTarget);a.Utils.openPopup(c.attr('href'),480,280);},__tileClick:function(a){a.preventDefault();this.renderOverlay(true);},__fullscreenClick:function(a){a.preventDefault();this.renderOverlay();},__windowKeydown:function(a){if(a.which===27)this.removeOverlay();},_updatePositionStyles:function(){if(!this.isOverlayed||!this.$gif.length)return;var a=this.$gif.offset();this.$overlay.css({height:this.$gif.height(),width:this.$gif.width(),left:a.left,top:a.top-this.$win.scrollTop()});},_updateUrl:function(a){if(!window.history||!this.$gif.length)return;var b=this.$gif.data('absoluteUrl');if(this.isOverlayed)b+=a?'/tile':'/fullscreen';window.history.replaceState(window.history.state,document.title,b);},initialize:function(a){a=a||{};this.$win=$(window);this.$body=$('body');this.$gif=$();this.$overlay=$('<div class="gif-mode-overlay"></div>');this.animationDuration=a.animationDuration||400;this.isOverlayed=false;this.isTile=false;this.timeout=null;this.render();return this;},render:function(){this.$body.on('click.gif-modes','.gif-button.tv',$.proxy(this.__tvClick,this));this.$body.on('click.gif-modes','.gif-button.tile',$.proxy(this.__tileClick,this));this.$body.on('click.gif-modes','.gif-button.fullscreen',$.proxy(this.__fullscreenClick,this));},renderOverlay:function(a){this.$gif=this.$body.find('#gif');if(this.isOverlayed||!this.$gif.length)return;a=a||false;var b=this.$gif.width()+'px '+this.$gif.height()+'px';var c=this.$gif.data();if(this.timeout){clearTimeout(this.timeout);this.timeout=null;}this.isOverlayed=true;this.isTile=a;this._updatePositionStyles();this.$overlay.removeClass('animate').toggleClass('tile',a).toggleClass('fullscreen',!a).css({backgroundImage:'url('+this.$gif.attr('src')+')',backgroundSize:a?b:'cover'}).appendTo(this.$body).one('click',$.proxy(this.__click,this));this.$win.on('scroll.gif-modes',$.proxy(this._updatePositionStyles,this));this.$win.on('resize.gif-modes',$.proxy(this._updatePositionStyles,this));this.$win.on('keydown.gif-modes',$.proxy(this.__windowKeydown,this));this.timeout=setTimeout($.proxy(function(){this.$overlay.addClass('animate');this._updateUrl(a);if(a)this.$overlay.css('background-size',c.originalWidth+'px '+c.originalHeight+'px');},this),100);},removeOverlay:function(a){a=a||false;if(!a&&!this.isOverlayed)return;if(this.timeout){clearTimeout(this.timeout);this.timeout=null;}this.$overlay.removeClass('animate updated');this.$win.off('.gif-modes');this.isOverlayed=false;this.isTile=false;if(this.$overlay.hasClass('tile'))this.$overlay.css('background-size',this.$gif.width()+'px '+this.$gif.height()+'px');if(a)this.$overlay.remove();else this._updateUrl();this.timeout=setTimeout($.proxy(function(){this.$overlay.removeClass('tile fullscreen').remove();},this),this.animationDuration);},update:function(){if(!this.isOverlayed)return;this.$gif=this.$body.find('#gif');if(!this.$gif.length){this.removeOverlay();return;}this.$overlay.addClass('updated').css('background-image','url('+this.$gif.data('image_url')+')');if(this.isTile)this.$overlay.css('background-size',this.$gif.data('originalWidth')+'px '+this.$gif.data('originalHeight')+'px');this._updatePositionStyles();this._updateUrl();},remove:function(){this.removeOverlay(true);this.$body.off('.gif-modes');}};a.GifModes=b;})(Giphy);(function(a,b){var c={__beforeUnload:function(){},__ready:function(c){this.history=c;if(this.gifData){var d={id:this.gifData.gif_id,url:this.gifData.absoluteUrl,preview:this.gifData.previewImageUrl};var e=a.find(this.history,function(a){return a.url===d.url;});if(!e)this.history.unshift(d);}this.updatePositionByUrl(window.location.pathname);this.isFetching=false;b.Events.trigger('gifnavigation:ready',this.getData());},__update:function(c){if(!c)return;this.history=a.union(this.history,c);this.isFetching=false;b.Events.trigger('gifnavigation:update',this.getData());},initialize:function(a){a=a||{};this.position=0;this.history=null;this.isFetching=true;this.gifData=a.gifData||null;b.GifRouter.getMoreGifs().done($.proxy(this.__ready,this));return this;},next:function(){if(!this.history.length||this.position>=this.history.length-1)return;this.position++;if(!this.isFetching&&this.position>=this.history.length-10)this.getMoreGifs();var a=this.getData();b.Events.trigger('gifnavigation:next',a);return a;},previous:function(){if(!this.history.length||this.position<=0)return;this.position--;var a=this.getData();b.Events.trigger('gifnavigation:previous',a);return a;},updatePositionByUrl:function(a){if(!this.history.length||!a)return;this.position=0;for(var b=0;b<this.history.length;b++){var c=this.history[b];if(!c.url)return;var d=c.url.replace(/^\/|\/$/g,'');var e=a.replace(/^\/|\/$/g,'');if(d===e){this.position=b;break;}}},getMoreGifs:function(){this.isFetching=true;b.GifRouter.getMoreGifs().done($.proxy(this.__update,this)).fail($.proxy(function(){this.isFetching=false;},this));},getData:function(){if(!this.history.length)return;var a={};a.current=this.history[this.position];a.previous=this.history[this.position-1];a.next=this.history[this.position+1];return a;}};b.GifNavigation=c;})(_,Giphy);(function(a,b){var c={__success:function(c){var d=$('<div></div>').html(c);var e=d.find('.related-content');var f=d.find('.hoverable').clone();var g=a.sample(f,this.maxGifs);e.html('').append(g);this.$el.html('').append(e);this.xhr=null;$.when.apply(window,a.map(g,function(a){var c=$(a);var d=c.find('img');var e=c.find('.gif-link').addClass('loading');e.height(e.width()/d.data('ratio'));return b.Utils.preloadImage(d.attr('src')).done(function(){e.removeClass('loading');}).fail(function(){c.remove();});},this)).done(function(){if(b.Homepage)b.Homepage.attachHovers();});},__error:function(){this.xhr=null;this.remove();},initialize:function(a){a=a||{};this.$el=$(a.el||'#related-container');this.gifData=a.gifData||{};this.maxGifs=a.maxGifs||5;this.xhr=null;this.render();return this;},render:function(){if(!this.$el.length||!a.size(this.gifData.absoluteUrl))return;this.xhr=$.ajax({url:this.gifData.absoluteUrl+'/related',timeout:5000,success:$.proxy(this.__success,this),error:$.proxy(this.__error,this)});},remove:function(){if(!this.$el.length)return;this.$el.html('');if(this.xhr){this.xhr.abort();this.xhr=null;}}};b.GifRelated=c;})(_,Giphy);(function(a){var b={trackView:function(a){var b=$.ajax({type:"post",url:"/ajax/gif/"+a+"/analytic/view",data:{},success:function(a){return a;},error:function(){return null;}});return b;}};a.GifTracking=b;})(Giphy);(function(a,b){var c={_getCount:function(){var a=this.viewCount.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",");a+=' views';return a;},initialize:function(a){a=a||{};this.$el=(a.el||'.gif-source');this.viewCount=a.viewCount||0;this.render();return this;},render:function(){if(!this.$el||this.viewCount<1)return;this.$el.append(this.template({count:this._getCount()}));},remove:function(){if(!this.$el.length)return;this.$el.find('.view-count').remove();this.viewCount=0;},template:a.template('<div class="view-count"><%- count %></div>')};b.GifViewCount=c;})(_,Giphy);(function(a){var b={__checkboxChange:function(a){var b=$(a.currentTarget);this.model.save(b.attr('name'),b.is(':checked'));},__radioButtonChange:function(a,b,c){var d=$(b);if(d.data('name')!=='rating')return;this.model.save('rating',c);},__privacyToggle:function(a,b){var c=$(a.currentTarget);b?this.$privateGifIndicator.hide():this.$privateGifIndicator.show();this.model.save(c.data('name'),!b);},__editToggle:function(a,b){this.toggleEditMode(!b);},__confirmDeleteClick:function(b){b.preventDefault();var c=$(b.currentTarget).prop('disabled',true);var d=window.USER.channel;this.model.save('delete-gif',true).fail(function(){c.prop('disabled',false);}).done(function(b){a.Events.trigger('radmodal:close');c.prop('disabled',false);if(b.result)window.location=d+'?message=gifdeleted&status=200';else window.showError('Unable to delete GIF. '+b.result.message);});},__saveMetadata:function(a){if(!a)return;var b=$(a);var c=b.find('.metadata-field');var d=b.find('.metadata-label .value');var e=c.find('input:text');if(e.length)this.model.save(e.attr('name'),e.val().trim()).done(function(){var a=e.val().trim();e.data('original-value',a);d.text(a);c.removeClass('open');});},initialize:function(b){b=b||{};this.$win=$(window);this.$body=$('body');this.$el=$(b.el||'#gif-info-container');this.model=a.GifEditModel;this.gifId=b.gifId||$('#gif').data('gif_id');this.editUrl=b.editUrl||$('#gif').data('editUrl');this.absoluteUrl=b.absoluteUrl||$('#gif').data('absoluteUrl');this.subviews={};this.originalHtml='';this.model.initialize({gifId:this.gifId}).fetch().done($.proxy(this.render,this));return this;},cacheSelectors:function(){this.$infoWrapper=this.$el.find('.gif-info-wrapper');this.$editWrapper=this.$el.find('.gif-edit-wrapper');this.$editToggle=this.$el.find('.edit-gif-toggle');this.$privateGifIndicator=this.$el.find('#private-gif-indicator');},render:function(b){if(!b||!this.$el.length)return;this.originalHtml=this.$el.html();this.$el.html(b);this.cacheSelectors();a.Globals.refresh();this.subviews.editTags=a.GifEditTags.initialize({gifId:this.gifId,el:this.$el.find('#tags')});this.subviews.editMetadata=a.GifEditMetadata.initialize({onSave:$.proxy(this.__saveMetadata,this)});this.$el.on('toggle.gif-edit','.edit-gif-toggle',$.proxy(this.__editToggle,this));this.$el.on('change.gif-edit','.checkbox input:checkbox',$.proxy(this.__checkboxChange,this));this.$el.on('toggle.gif-edit','.privacy-toggle',$.proxy(this.__privacyToggle,this));this.$body.on('click.gif-edit','.rad-modal .delete-button',$.proxy(this.__confirmDeleteClick,this));a.Events.on('radiobutton:change',$.proxy(this.__radioButtonChange,this));if(window.location.pathname===this.editUrl)this.toggleEditMode(true);},remove:function(){this.$el.off('.gif-edit');this.$body.off('.gif-edit');for(key in this.subviews){var b=this.subviews[key];b.remove();}this.$el.html(this.originalHtml);a.Events.off('radiobutton:change');},toggleEditMode:function(b){b=b||false;b?this.$infoWrapper.hide():this.$infoWrapper.show();b?this.$editWrapper.show():this.$editWrapper.hide();this.$editToggle.toggleClass('active',!b);if(window.history){var c=(b&&this.editUrl)?this.editUrl:this.absoluteUrl;window.history.replaceState(window.history.state,document.title,c);}if(b)setTimeout($.proxy(function(){$('html, body').animate({scrollTop:this.$editWrapper.offset().top},200);},this),100);else setTimeout(function(){a.Events.trigger('gifedit:toggle');},400);}};var c={__editClick:function(a){a.preventDefault();var b=$(a.currentTarget);var c=b.closest('.metadata-section').find('.metadata-field');var d=c.hasClass('open');this.$fields.removeClass('open');this.$win.off('.gif-metadata');if(!d&&c.length){c.addClass('open');c.find('input:text').select();this.$win.on('keydown.gif-metadata',$.proxy(this.__windowKeydown,this));}else b.val(b.data('original-value'));},__clearClick:function(a){a.preventDefault();var b=$(a.currentTarget);var c=b.closest('.metadata-field').find('input:text');if(c.length)c.val('').focus();},__saveClick:function(a){a.preventDefault();var b=$(a.currentTarget);this.save(b.closest('.metadata-section'));},__inputKeydown:function(a){if(a.which===13){var b=$(a.currentTarget);this.save(b.closest('.metadata-section'));}},__windowKeydown:function(a){if(a.which===27){this.$fields.removeClass('open');this.$inputs.each(function(){$(this).val($(this).data('original-value'));});}},initialize:function(a){a=a||{};this.$win=$(window);this.$el=$(a.el||'.metadata');this.$sections=$();this.$field=$();this.$inputs=$();this.onSave=a.onSave||$.noop;this.render();return this;},render:function(){if(!this.$el.length)return;this.$sections=this.$el.find('.metadata-section');this.$fields=this.$el.find('.metadata-field');this.$inputs=this.$el.find('.metadata-field input:text');this.$inputs.each(function(){var a=$(this);a.data('original-value',a.val());});this.$el.on('click.gif-metadata','.edit-icon',$.proxy(this.__editClick,this));this.$el.on('click.gif-metadata','.clear-button',$.proxy(this.__clearClick,this));this.$el.on('click.gif-metadata','.save-button',$.proxy(this.__saveClick,this));this.$el.on('keydown.gif-metadata','.metadata-field input:text',$.proxy(this.__inputKeydown,this));},save:function(a){this.onSave.call(this,a);},remove:function(){this.$el.off('.gif-metadata');}};var d={initialize:function(a){a=a||{};this.gifId=a.gifId;return this;},fetch:function(){var a=$.Deferred();if(String(this.gifId).length)$.ajax({url:'/ajax/gif/'+this.gifId+'/detail',type:'GET',success:function(b){a.resolve(b);},error:function(){a.reject();}});else a.reject();return a.promise();},save:function(a,b){var c=$.Deferred();if(String(this.gifId).length)$.ajax({type:'POST',url:'/ajax/gif/update',data:{key:a,value:b,gif_id:this.gifId},success:function(a){if(a.result&&a.result.code!==200){window.showError(a.result.message||'Uh-oh. Something went wrong. Please try again.');c.reject();}else{window.showSuccess('GIF updated!');c.resolve(a);}return a;},error:function(){window.showError('Uh-oh. Something went wrong. Please try again.');c.reject();}});else c.reject();return c.promise();}};var e={__deleteClick:function(a){a.preventDefault();var b=$(a.currentTarget);var c=b.closest('.tag');c.addClass('deleted');setTimeout($.proxy(function(){this.submitTag(c.data('tag'),true);c.remove();},this),300);},__addClick:function(a){a.preventDefault();this.submitTag(this.$input.val());},__input:function(){this.$addButton.toggleClass('disabled',this.$input.val().trim().length<1);},__keydown:function(a){if(a.which===13)this.submitTag(this.$input.val());},__success:function(a,b){if(!b||!b.result||b.result.code!==200){this.__error();return;}this._reset();if(!a){var c=b.result.data;this._addNewTag(c.name,c.name_encoded);this.$input.select();window.showSuccess('Tag added!');}else window.showSuccess('Tag deleted!');},__error:function(){this._reset();window.showError('Uh oh. Something went wrong. Please try again.');},_reset:function(){this.$addButton.addClass('disabled');this.$input.val('');},_addNewTag:function(a,b){var c=this.template.replace(/TAGNAME/g,a).replace(/TAGURL/g,b);var d=$(c);this.$el.append(d);setTimeout(function(){d.removeClass('new-tag');},500);},initialize:function(a){a=a||{};this.url=a.url||'/ajax/gif/update';this.gifId=a.gifId||$('#gif').data('gif_id');this.template=$(a.template||'#new-tag-template').html();this.$el=$(a.el||'#tags');this.render();return this;},render:function(){this.$input=this.$el.find('.add-tag-input');this.$addButton=this.$el.find('.add-tag-button');this._reset();this.$el.on('input.edit-tags','.add-tag-input',$.proxy(this.__input,this));this.$el.on('keydown.edit-tags','.add-tag-input',$.proxy(this.__keydown,this));this.$el.on('click.edit-tags','.add-tag-button',$.proxy(this.__addClick,this));this.$el.on('click.edit-tags','.delete-tag-button',$.proxy(this.__deleteClick,this));},submitTag:function(a,b){if(!a||!a.trim().length)return;b=b||false;if(!b)a=a.replace('#','');$.ajax({type:'POST',url:this.url,data:{'gif_id':this.gifId,'key':b?'delete-tag':'create-tag','value':a},success:$.proxy(this.__success,this,b),error:$.proxy(this.__error,this)});},remove:function(){this._reset();this.$el.off('.edit-tags');}};a.GifEdit=b;a.GifEditModel=d;a.GifEditMetadata=c;a.GifEditTags=e;})(Giphy);(function(a){var b={_checkIfIE:function(){var a=false;var b=window.navigator.userAgent;var c=b.indexOf('MSIE ');var d=b.indexOf('Trident/');if((c>-1)||(d>-1))return true;return false;},initialize:function(){this.subviews={};this.$body=$('body');this.subviews.copyInputs=a.CopyInputs.initialize();this.subviews.toggleInputs=a.ToggleInputs.initialize();this.subviews.checkboxInputs=a.CheckboxInputs.initialize();this.subviews.radioButtons=a.RadioButtons.initialize();this.subviews.tooltips=a.Tooltips.initialize();this.subviews.ui=a.GiphyUI.initialize();this.subviews.radModal=a.RadModal.initialize();if(this._checkIfIE())this.$body.addClass('is-ie');},refresh:function(){for(key in this.subviews){var a=this.subviews[key];a.remove();a.initialize();}}};var c={__click:function(a){var b=$(a.currentTarget);b.select();},__copy:function(a){window.showSuccess('Copied to clipboard!');},initialize:function(a){a=a||{};this.$inputs=$('input[data-copy="true"]');this.render();return this;},render:function(){if(!this.$inputs.length)return;this.$inputs.on('click.copy-input',$.proxy(this.__click,this));this.$inputs.on('copy.copy-input',$.proxy(this.__copy,this));},remove:function(){if(!this.$inputs.length)return;this.$inputs.off('.copy-input');}};var d={__click:function(b){b.preventDefault();var c=$(b.currentTarget);var d=c.data();var e=false;if(d.isAnimating)return;c.toggleClass('active');e=c.hasClass('active');c.data('is-animating',true);setTimeout(function(){c.data('is-animating',false);},this.animationDelay);c.trigger('toggle',e);a.Events.trigger('toggleinput:toggle',c,e);},initialize:function(a){a=a||{};this.$toggles=$('.settings-toggle');this.animationDelay=a.animationDelay||500;this.render();return this;},render:function(){if(!this.$toggles.length)return;this.$toggles.on('click.toggle-input',$.proxy(this.__click,this));},remove:function(){if(!this.$toggles.length)return;this.$toggles.off('.toggle-input');}};var e={__click:function(a){a.preventDefault();var b=$(a.currentTarget);var c=b.closest('.checkbox');var d=c.find('input:checkbox');c.toggleClass('checked');if(d.length)d.prop('checked',c.hasClass('checked')).trigger('change');},initialize:function(a){a=a||{};this.$checkboxes=$('.checkbox');this.render();return this;},render:function(){if(!this.$checkboxes.length)return;this.$checkboxes.each(function(){var a=$(this);var b=a.find('input:checkbox');if(b.length)a.toggleClass('checked',b.prop('checked'));});this.$checkboxes.on('click.checkbox-input','.checkbox-icon',$.proxy(this.__click,this));},remove:function(){if(!this.$checkboxes.length)return;this.$checkboxes.off('.checkbox-input');}};var f={__click:function(b){b.preventDefault();var c=$(b.currentTarget);var d=c.closest('.radio-options');var e=c.data('value');d.find('.selected').removeClass('selected');c.addClass('selected');d.trigger('change',e);a.Events.trigger('radiobutton:change',d,e);},initialize:function(a){a=a||{};this.$radioButtons=$('.radio-options');this.render();return this;},render:function(){if(!this.$radioButtons.length)return;this.$radioButtons.on('click.radio-buttons','.radio-option',$.proxy(this.__click,this));},remove:function(){if(!this.$radioButtons.length)return;this.$radioButtons.off('.radio-buttons');}};var g={__mouseover:function(a){var b=$(a.currentTarget);var c=b.outerWidth();var d=b.outerHeight();var e=b.offset();this.$tooltip.text(b.data('tooltip')).css({left:e.left+(c*0.5),top:e.top+d-this.$win.scrollTop()}).appendTo(this.$body);},__mouseout:function(){this.$tooltip.remove();},initialize:function(a){a=a||{};this.$win=$(window);this.$body=$('body');this.$elements=$('*[data-tooltip]');this.$tooltip=$('<div class="giphy-tooltip"></div>');this.render();return this;},render:function(){if(!this.$elements.length)return;this.$elements.on('mouseover.tooltip',$.proxy(this.__mouseover,this));this.$elements.on('mouseout.tooltip',$.proxy(this.__mouseout,this));},remove:function(){if(!this.$elements.length)return;this.$elements.off('.tooltip');}};var h={__keydown:function(a){if(a.which===27)this._reset();},__triggerClick:function(a){a.preventDefault();var b=$(a.currentTarget).data();if(b.content){var c=$(b.content);this.open({title:b.title,description:b.description,content:c.html()});}},__cancelClick:function(a){a.preventDefault();this._reset();},_reset:function(){this.$modal.remove();this.$dim.remove();this.$title.html('');this.$description.html('');this.$content.html('');this.$body.removeClass('no-scroll');this.$win.off('.rad-modal');},initialize:function(){this.$win=$(window);this.$body=$('body');this.$modal=$('<div class="rad-modal"></div>');this.$dim=$('<div class="rad-modal-dim"></div>');this.render();return this;},render:function(){this.$hand=$('<div class="rad-modal-hand"><div class="hand-inner"></div></div>').appendTo(this.$modal);this.$title=$('<span class="title"></span>').appendTo(this.$modal);this.$description=$('<span class="description"></span>').appendTo(this.$modal);this.$content=$('<div class="content"></div>').appendTo(this.$modal);this.$body.on('click.rad-modal','.rad-modal-trigger',$.proxy(this.__triggerClick,this));this.$body.on('click.rad-modal','.rad-modal-dim',$.proxy(this._reset,this));this.$body.on('click.rad-modal','.rad-modal .cancel-button',$.proxy(this.__cancelClick,this));a.Events.on('radmodal:close',$.proxy(this._reset,this));},open:function(a){a=a||{};this._reset();if(a.title)this.$title.text(a.title);if(a.description)this.$description.text(a.description);if(a.content)this.$content.html(a.content);this.$body.addClass('no-scroll').append(this.$modal).append(this.$dim);this.$win.on('keydown.rad-modal',$.proxy(this.__keydown,this));},close:function(){this._reset();},remove:function(){this._reset();this.$body.off('.rad-modal');this.$win.off('.rad-modal');a.Events.off('radmodal:close');}};a.Globals=b;a.CopyInputs=c;a.ToggleInputs=d;a.CheckboxInputs=e;a.RadioButtons=f;a.Tooltips=g;a.RadModal=h;})(Giphy);(function(){var a=Giphy.Homepage={init:function(){var a=$('#homepage');if(a.length){Giphy.Homepage.attachInfiniteScroll();Giphy.Homepage.attachHovers();Giphy.Homepage.playFeaturedViewport();Giphy.Homepage.attachNotice();$(document).on('scroll',function(){Giphy.Homepage.playFeaturedViewport();});}},attachInfiniteScroll:function(){$.extend($.infinitescroll.prototype,{beginAjax:function a(a){var b=this,c=a.path,d,e;if(typeof a.state.nextPage!='undefined')e=a.state.nextPage;else e=c[0];var f=$(a.contentSelector).is('table, tbody')?$('<tbody/>'):$('<div/>');f.load(e+' '+a.itemSelector,undefined,function g(c){next=$($(c).find(a.nextSelector));a.state.nextPage=next.attr("href");e=a.state.nextPage;b._loadcallback(f,c,e);});}});window.CURRENT_PAGE=1;$('.homepage').infinitescroll({nextSelector:"a#next-page-arrow",navSelector:"div#paging",itemSelector:".homepage-half",bufferPx:10,state:{currPage:window.CURRENT_PAGE},pathParse:function(a,b){var c=a.split('?')[0];var d=a.split('?')[1];var e=d?"?"+d+"&is=1":"?is=1";var f=['/page/'+b+e+''];return f;},behavior:"giphy",loading:{finishedMsg:"",img:"/static/img/loading_bar_page.gif",msgText:"",speed:'fast',finished:function(){$('#infscr-loading').remove();var a=$(this).data('infinitescroll');window.CURRENT_PAGE+=1;window.OFFSET_PAGE=window.CURRENT_PAGE-1;Giphy.Analytics.fireEvents('/page/'+window.CURRENT_PAGE);Giphy.Homepage.attachHovers();}}});},attachHovers:function(){var a=$('.hoverable');a.mouseenter(function(a){var b=$(this).find('img'),c=$(this).find('.loader'),d=b.attr('data-animated');$('.loader').hide();c.show();b.addClass('hovering');$("<img />").attr('src',d).load(function(){c.css('display','none');if(b.hasClass('hovering')){b.removeAttr('nopin');b.attr('src',d);}});});a.mouseleave(function(a){var b=$(this).find('img'),c=$(this).find('.loader'),d=b.attr('data-static');b.removeClass('hovering');b.attr('nopin','nopin');b.attr('src',d);c.hide();});},playFeaturedViewport:function(){var a=$('.homepage-featured');var b=$(window).scrollTop();var c=b+$(window).height();$.each(a,function(a,d){var e=$(d),f=e.find('img'),g=e.find('.loader'),h=f.attr('data-animated'),i=f.attr('data-static');if((((e.offset().top+e.height())<=c)&&((e.offset().top+e.height())>=b))){if(f.attr("src")!=f.attr("data-animated")){f.addClass('hovering');$("<img />").attr('src',h).load(function(){g.css('display','none');if(f.hasClass('hovering')){f.removeAttr('nopin');f.attr('src',h);}});}}else{f.removeClass('hovering');f.attr('nopin','nopin');f.attr('src',i);g.hide();}});},attachNotice:function(){if($("#notice-banner").length>0){var a="giphy-"+$("#notice-banner").data('name');if(!$.cookie(a)){setTimeout(function(){$("#notice-content").appendTo("#notice-banner");$("#notice-content").show();$("#notice-banner").slideDown();},3000);$("#notice-dismiss").on('click',function(b){b.preventDefault();Giphy.Homepage.dismissNotice(a);return false;});}}},dismissNotice:function(a){$.cookie(a,"1",{expires:365});if($("#notice-banner").length>0)$("#notice-banner").slideUp();}};})(window,Giphy);(function(){var a=Giphy.Images={preloadImages:function(){var a=["https://giphy.com/static/img/facebook_animated.gif","https://giphy.com/static/img/twitter_animated.gif","https://giphy.com/static/img/loading_bar.gif"];for(i=0;i<a.length;i++){var b=new Image();b.src=a[i];}},showOriginalSize:function(){if($("#gif").attr("data-padding-top")>0){$("#gif").css('height',$("#gif").attr("data-original-height"));$("#gif").css('width',$("#gif").attr("data-original-width"));$("#gif").css('padding-top',$("#gif").attr("data-padding-top")+'px');}return false;},sizeImages:function(){var a=$('.last-row').find('li');var b=$('.freeform').find('li.ungrouped');var c=$('li.ungrouped .upload-gif');b.removeClass("ungrouped");var d=$.merge(a,b);var e=d.find('img');if(c.length)if(!window.uploadButtonPlaced){e=$.merge(c,e);window.uploadButtonPlaced=true;}else c.closest('li').remove();if(e.length===0)return;var f=0;if($(".fb_container").length==0){var g=$('#content').width();var h=200;var i=$("#_giphy_tv").length>0&&(typeof _suppress_tv_resize=='undefined');}else{var g=700;var h=150;var h=200;var i=false;}if(typeof window.margin==='undefined'){var j=parseInt($(e[0]).closest('li').css("margin-right"),10);window.margin=j;}else var j=window.margin;var k=[];var l=0;var m=0;window.tvPlaced=window.tvPlaced||false;$.each(e,function(a){var b=e[a];var c=parseInt($(b).attr("data-width"),10);var d=parseInt($(b).attr("data-height"),10);if(d!=h)c=Math.floor(c*(h/d));k.push(parseInt(c,10));});while(f<e.length){var n=0;var o=0;var p=0;var q=0;var r=false;var s=(l<2&&i&&$(window).width()>480&&!window.tvPlaced)?g/2:g+j;while(p<s){if(f+n==k.length){p+=j;r=true;break;}var t=k[f+n]+j;p+=t;if(f+n>=e.length){r=true;break;}n++;}var u=$("<div class='hoverable'/>");if(i&&!tvPlaced&&l<2){$(u).css('float','left');$(u).css('width',s);$(u).css('clear','left');}var v=s/p;while(o<n){var w=k[f]*v;var x=h*v;var y=$(e[f]);if(r){w=parseInt($(y).attr('data-width'),10);x=parseInt($(y).attr('data-height'),10);}q+=w+j;y.width(w);y.height(x);var z=y.closest('li');u.append('<li style="width: '+w+'px;">'+z.html()+'</li>');z.remove();if(o==n-1){B=$(u).find("li:last");B.css('margin-right','0px');}o++;f++;}if(!r)if(q>s){var A=0;while(q>s){var B=$(u).find("li:nth-child("+(A+1)+")");var y=B.find('img, .upload-gif');$(y).width($(y).width()-1);$(B).width($(B).width()-1);q--;if(++A>=$(u).find("img").length)A=0;}}else if(q<s){var A=0;while(q<s){var B=$(u).find("li:nth-child("+(A+1)+")");var y=B.find('img, .upload-gif');$(y).width($(y).width()+1);$(B).width($(B).width()+1);q++;if(++A>=$(u).find("img").length)A=0;}}if(r===true)u.addClass('last-row');$('.gifs').append(u);if(i&&!window.tvPlaced&&l<2)m+=$(u).height();l++;$(document).trigger("images:done_sizing");}if(i&&!window.tvPlaced){var C=function(){if($("#asdf-container").length==0){setTimeout(C,100);return;}window.tvPlaced=true;$("#_giphy_tv").width(g/2);$("#_giphy_tv").height(m-5);__TV.sizeTo(g/2,m-5);__TV.resize();__TV.sizeTo(g/2,m-5);$("#_giphy_tv").css('margin-top','-35px');};C();}$('.bottom-tags a').show();return this;},sizeImagesToFrame:function(){var a=$('.framed-gif');if(a.length)$.each(a,function(a,b){var c=$(b),d=c.attr("data-original-height"),e=c.attr("data-original-width"),f=c.parents(".frame"),g=f.width(),h=f.height(),i=e/d,j=g/h,k,l,m,n;if(i>=j){m=(h/d)*e;n=h;l=-(m-g)/2;k=0;}else{m=g;n=(g/e)*d;l=0;k=-(n-h)/2;}c.css({"margin-top":k,"margin-left":l});c.attr({"height":n,"width":m});});},removePageNumbersForBackButton:function(){var a=$('.hoverable li');if(a.length)a.each(function(a,b){href=$(b).find(".a-gif");href.click(function(a){var b=window.location.href;var c=b.replace('http://','').split('/').length;if(b.indexOf("search")!=-1&&c==4){var d=b.replace(b.substr(b.lastIndexOf('/')+1),'');if(window.history.pushState)window.history.pushState("","",d);}});});},attachHovers:function(){var a=$(".hoverable li, .row-tag, .featured-item, .featured-user");if(a.length){a.off("mouseenter","**").mouseenter(function(a){var b=$(this).find(".hover-target").length?$(this).find(".hover-target"):$(this).find('img'),c=$(this).find('.loader'),d=b.attr('data-animated'),e=$(this).find('.promote-gif-hover');$('.loader').hide();c.css('display','block');b.addClass('hovering');$("<img />").attr('src',d).load(function(){c.css('display','none');if(b.hasClass('hovering')){b.removeAttr('nopin');b.attr('src',d);if(b.width()<150){e.find('h1').text('top').css('margin-right',10);e.find('.promote-gif-text').css('width','auto');}e.show();}});});a.off("mouseleave","**").mouseleave(function(a){var b=$(this).find(".hover-target").length?$(this).find(".hover-target"):$(this).find('img');b.removeClass('hovering');b.attr('nopin','nopin');b.attr('src',$(b).attr('data-still'));b.parent('.gif').parent().children('.loader').css('display','none');$(this).find('.promote-gif-hover').hide();});}return this;}};})(window,Giphy);(function(){var a=Giphy.Instagram={showModal:function(){var a=$("#instagram-share"),b=$('#instashare-share'),c=$('#instashare-send-button'),d=$("#instashare-loader"),e=$('#instashare-email-input');e.keypress(function(a){if(a.which==13)c.click();});$(".instashare-okbutton").click(function(){a.removeClass('hover');$("#instashare-modal").hide();});a.click(function(){if($('#instashare-modal').css('display')=='block'){$("#instashare-modal").hide();a.removeClass('hover');}else{$(".dialog").hide();$('.hover').removeClass('hover');$("#instashare-modal").show();a.addClass('hover');}b.show();c.show();d.hide();e.val('');});c.click(function(){c.hide();d.show();var b="/ajax/instashare/";$.ajax({type:"post",url:b,data:{"gif_id":$('#gif').attr("data-gif_id"),"to":$("#instashare-email-input").val()}}).always(function(b){if(b.result)if(b.result.code!=200){showError("UH OH. Something went wrong. Try again?");a.removeClass('hover');$("#instashare-modal").hide();}else{showSuccess("Success! Check your email in about 5 minutes. We sent you a GIF you can upload to Instagram.");a.removeClass('hover');$("#instashare-modal").hide();}else{showError("UH OH. Something went wrong. Try again?");a.removeClass('hover');$("#instashare-modal").hide();}});});}};})(window,Giphy);(function(){var a=Giphy.Login={facebook:function(){var a=Giphy.Utils.getParameterByName("next");if(a)window.LOGIN_NEXT=location.protocol+"//"+location.host+a;$(".facebook-login").click(function(){if(window.LOGIN_NEXT)document.location.href='/login/facebook/?next='+window.LOGIN_NEXT+"?status=200&message=login";else document.location.href='/login/facebook/';return false;});return this;},loginFocus:function(){var a=$("#login-form");if(a.length)$("#email").focus();}};})(window,Giphy);(function(){var a=Giphy.Nav={share:function(){$("input[type='text']").on("click",function(){$(this).select();});},attachFooter:function(){if(($('#homepage').length>0)||($(".freeform").length>0)){var a=$("#footer");a.css('position','fixed');a.css('bottom','0px');a.css('opacity','0');a.css('z-index','10000');$(document).mousemove(function(b){var c=$(window);var d=b.pageY;var e=c.height()+c.scrollTop()-d-200;if(e<=100)a.css('opacity','1');else a.css('opacity','0');});}}};})(window,Giphy);(function(){var a=Giphy.Newsletter={attachNewsletter:function(){if($("#newsletter-placeholder").length>0)if(!$.cookie("dismiss-newsletter")){setTimeout(function(){$("#newsletter-content").appendTo("#newsletter-placeholder");$("#newsletter-content").show();$("#newsletter-placeholder").slideDown();},3000);$("#newsletter-dismiss").on('click',function(a){a.preventDefault();Giphy.Newsletter.dismissNewsletter();return false;});}$("#newsletter-form").on('submit',function(a){a.preventDefault();var b=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;if(!b.test($("#newsletter-email").val())){showError("Please enter a valid email address.");return;}$("#newsletter-content").removeClass('inactive');$("#newsletter-content").addClass('active');$.ajax({type:'post',url:'/ajax/newsletter',data:{'email':$("#newsletter-email").val(),'action':$(this).attr('data-action')},dataType:'json',error:function(a){$("#newsletter-content").removeClass('active');$("#newsletter-content").addClass('inactive');showError("An error occurred.");},success:function(a){if(a.result.error){showError(a.result.error);$("#newsletter-content").removeClass('active');$("#newsletter-content").addClass('inactive');}else{if($("#newsletter-content").length>0)$("#newsletter-form").animate({"margin-top":"200"},300,function(){});$("#newsletter-content").removeClass('active');$("#newsletter-content").addClass('success');if(document.location.pathname!='/'){Giphy.Newsletter.dismissNewsletter();showSuccess(a.result.response,'/',1500);}else setTimeout(function(){Giphy.Newsletter.dismissNewsletter();},2000);}}});});},dismissNewsletter:function(){$.cookie("dismiss-newsletter","1",{expires:365});if($("#newsletter-placeholder").length>0)$("#newsletter-placeholder").slideUp();}};})(window,Giphy);(function(){var a=Giphy.Overlays={getShareHtml:function(){return [$("<a>",{"id":"fb-share","class":"facebook facebook-blue social-share","title":"Share on Facebook","target":"_blank","href":"#","click":function(){window.open("http://www.facebook.com/sharer/sharer.php?u="+document.URL,"1361370515039","width=650,height=280,toolbar=0,menubar=0,location=0,status=0,scrollbars=0,resizable=1,left=0,top=0");return false;}}),$("<a>",{"id":"twitter-share","class":"twitter twitter-blue social-share","title":"Share on Twitter","target":"_blank","href":"#","click":function(){window.open("http://twitter.com/share?url="+document.URL+"?tc=1&text="+window.socialShareTitle+"&via=giphy","1361370074860","width=500,height=252,toolbar=0,menubar=0,location=0,status=1,scrollbars=0,resizable=1,left=0,top=0");return false;}})];},getGifViewHtml:function(){var a=this;var b=[$("<a>",{"id":"gif-tile-link","class":"gif-tile-link sprite _023_tile","title":"Tile View","href":a.createOverlayUrl('tile')}),$("<a>",{"id":"gif-fullscreen-link","class":"gif-fullscreen-link sprite _004_fullscreen","title":"Fullscreen View","href":a.createOverlayUrl('fullscreen')})];if($("#gif-mp4").length>0)b.push($("<a>",{"id":"gif-version-link","class":"gif-version-link","title":"GIF View","href":a.createOverlayUrl('gif')}).text('GIF'));return b;},createOverlayUrl:function(a){var b=document.URL.split('?');var c=b[0].replace("home","").replace("edit","").replace("tile","").replace("fullscreen","").replace(/\/$/,'');if(a=="gif")return c;if(b[1]!=undefined)return c+"/"+a+"?"+b[1];else return c+"/"+a;},addShareLinksToPostIframes:function(){var a=this,b=$("#post-detail");if(b.length)$(document).ready(function(){$("#post-content iframe").each(function(){var b=$(this);b.wrap("<div class='iframe-wrap' style='position:relative;'></div>");b.after($("<div>",{"class":"iframe-overlay-share grid_8","html":a.getShareHtml()}));b.parent(".iframe-wrap").mouseover(function(a){$(this).find(".iframe-overlay-share").fadeIn();});b.parent(".iframe-wrap").mouseleave(function(a){$(this).find(".iframe-overlay-share").fadeOut();});});});},addOverlayToGifDetail:function(){var a=this,b=$("img#gif, video#gif-mp4"),c=$("#gif-wrap"),d=$("#fullscreen-overlay"),e=$("#gif-wrap .gif-hover");if(c.length){$(document).ready(function(){e.append($("<div>",{"class":"gif-overlay-views","id":"gif-overlay-views","html":a.getGifViewHtml()}));});c.bind({mouseenter:function(a){$("#gif-overlay-share, #gif-overlay-views").fadeIn();},mouseleave:function(a){$("#gif-overlay-share, #gif-overlay-views").fadeOut();}});}if(d.length)d.click(function(){window.location=document.URL.replace("tile","").replace("fullscreen","").replace(/\/$/,'');});},sizeFSOverlay:function(){var a=$("#fullscreen-overlay");if(a.length){var b=function(){var a=$("#gif,#gif-mp4"),b=$("#fullscreen-overlay"),c=a.data("original-height"),d=a.data("original-width"),e=$(window).width(),f=$(window).height(),g=d/c,h=e/f,i,j,k,l;if(g>=h){k=(f/c)*d;l=f;j=-(k-e)/2;i=0;}else{k=e;l=(e/d)*c;j=0;i=-(l-f)/2;}b.css({"height":l,"width":k,"margin-top":i,"margin-left":j});$('body').css({"overflow":"hidden","margin":0});};b();$(window).resize(function(){b();});}}};})(window,Giphy);(function(){var a=Giphy.Search={initMini:function(){if(!$("#mini-search-form").length)return;var a=$("#searchbar"),b=$("#search-box"),c=$("#search-button");b.blur();b.click(function(){var a=$('.search-bar-form button').find('img');if(a.hasClass('color'))return false;else{a.attr('src',a.attr('data-focus'));a.addClass('color');}});$(document).mouseup(function(b){var c=$('.search-bar-form button').find('img');if(!a.is(b.target)&&a.has(b.target).length===0){c.attr('src',c.attr('data-blur'));c.removeClass('color');}});b.keydown(function(a){var b=$('.searchbar button').find('img');if(!b.hasClass('color')){b.attr('src',b.attr('data-focus'));b.addClass('color');}});$("#mini-search-form").on('submit',function(a){var b=$('.search-bar-form button').find('img');if(b.attr('src')!=b.attr('data-submit')){a.preventDefault();a.stopImmediatePropagation();b.attr('src',b.attr('data-submit'));searchDelay=setTimeout(function c(){$("#mini-search-form").submit();},500);}});},init:function(){a.hasBeenEntered=false;a.hasKeyDown=false;var b=-1;var c=$("#searchbar"),d=$("#search-box"),e=$("#search-button");if(!(d.length>0))return;$("#placeholder").click(function(a){d.focus();});d.hover(function(){e.addClass("active");},function(){if(!$(this).is(":focus")&&$('.search-result').length==1)e.removeClass("active");});d.click(function(){var a=$('.searchbar button').find('img');if(a.hasClass('color'))return false;else{a.attr('src',a.attr('data-focus'));a.addClass('color');}});$(document).mouseup(function(a){var b=$('.searchbar button').find('img');if(!c.is(a.target)&&c.has(a.target).length===0){b.attr('src',b.attr('data-blur'));b.removeClass('color');}});d.focus(function(){$(".autocomplete").text("");e.addClass("active");});d.blur(function(){$(document).trigger("search:clear");});e.click(function(a){a.preventDefault();if(d.val().length>0)$(document).trigger("search:enter");});d.keydown(function(b){var c=$('.searchbar button').find('img');if(!c.hasClass('color')){c.attr('src',c.attr('data-focus'));c.addClass('color');}a.hasKeyDown=true;var d=b.which;if(d==38||d==40||d==9)b.preventDefault();else $("#placeholder").hide();});d.keyup(function(b){if(a.hasKeyDown===true){if(!a.hasBeenEntered){a.hasBeenEntered=true;_gaq.push(['_trackEvent','Search','QueryEntered']);}var c=b.which;var d=$("#search-box");var e=d.val();if(!e)$("#placeholder").show();if(c==37)return;if(c==38){$(document).trigger("search:up",b);b.preventDefault();return;}if(c==39){var f=$('.autocomplete').text();if(f&&f!=e)$(document).trigger("search:tab",f);b.preventDefault();return;}if(c==40){$(document).trigger("search:down",b);b.preventDefault();return;}if(c==9){var f=$('.autocomplete').text();if(f&&f!=e)$(document).trigger("search:tab",f);b.preventDefault();return;}if(c==13){b.preventDefault();a.enterPressed=true;$(document).trigger("search:enter",b);return;}var g=this;encoded=encodeURIComponent(e);if(typeof encoded==='undefined'||!encoded)return;$(document).trigger("search:execute");}});$(document).bind('search:execute',function(b){b.preventDefault();b.stopPropagation();var c=$("#search-box").val();var d=function(){$.get("/api/v1/tags/search/?q="+c,function(b){b.q=c;b.encoded=encoded;b.dont_display=false;if(a.enterPressed){a.enterPressed=false;b.dont_display=true;}$(document).trigger("search:success",b);}).fail(function(){$(document).trigger("search:error");});};if(Giphy.Timer!==undefined)Giphy.Timer.cancel();Giphy.Timer=new Giphy.Utils.timeout();Giphy.Timer.init(d,300,null);});$(document).bind('search:success',function(a,b){if(b.q!=$("#search-box").val())return;$(document).trigger("search:clear");for(var c=0;c<b.objects.length;c++){var d=$(".search-results").find('.search-result').first().clone();$(d).find('.word').text(b.objects[c].name);$(d).find('.word').attr("name-encoded",b.objects[c].name_encoded);d.mousedown(function(){if($(".fb_container").length==0)document.location.href="http://"+window.ASSET_DOMAIN+"/search/"+$(this).find(".word").attr("name-encoded");else{$("#search-box").val($(this).find(".word").attr("name-encoded"));$("#placeholder").hide();Giphy.Facebook.search($(this).find(".word").attr("name-encoded"));}});d.hover(function(){$(".hover").removeClass("hover");$(this).addClass("hover");},function(){$(this).removeClass("hover");});$(".search-results").append(d);$(".search-results").show();$(d).show();}if(b.dont_display)$(document).trigger("search:dont_display");});$(document).bind("search:clear",function(a){$(".autocomplete").text("");$('.search-result:visible').each(function(){$(this).remove();});b=-1;$('.search-results').hide();});$(document).bind("search:reset",function(a){$(document).trigger("search:clear");$('#search-box').val("");$("#placeholder").show();$('#search-box').blur();});$(document).bind("search:down",function(a){$('.search-result').removeClass('hover');b++;var c=$('.search-result:visible').length;if(b>=c)b=c-1;var d=$('.search-result:visible').eq(b);d.addClass("hover");$(document).trigger("search:selected",$(d).find('.word').text());});$(document).bind("search:up",function(a){$('.search-result').removeClass('hover');b--;if(b<0){$(".autocomplete").text("");$('#search_box').focus();b=-1;}else{var c=$('.search-result:visible').eq(b);c.addClass("hover");$(document).trigger("search:selected",$(c).find('.word').text());}});$(document).bind("search:enter",function(b){var c;b.preventDefault();b.stopImmediatePropagation();var d=$('.search-bar-form button').find('img');d.attr('src',d.attr('data-submit'));var e=$("#search-box").val();var f=$(".search-result.hover");var g=f.find(".word").text();var h=f.find(".word").attr("name-encoded");c=setTimeout(function i(){if(g)if($(".fb_container").length==0)document.location.href="http://"+window.ASSET_DOMAIN+"/search/"+h;else{Giphy.Facebook.search(h);$("#search-box").blur();a.hasKeyDown=false;$(document).trigger("search:clear");}else if(e.length>0)if($(".fb_container").length==0){var b=$("#searchbarform").length?$("#searchbarform"):$("#mini-searchbar-form");b.submit();}else{Giphy.Facebook.search(e);$("#search-box").blur();a.hasKeyDown=false;$(document).trigger("search:clear");}},500);return;});$(document).bind("search:selected",function(a,b){var c=$('#search-box');var d=$('.autocomplete');var e=c.val();var f="<span>";if(!b||e.trim().toLowerCase()==b)d.text('');else d.html(b);});$(document).bind("search:tab",function(a,b){$("#search-box").val(b);$(document).trigger("search:execute");});var f=navigator.userAgent.toLowerCase();if(!f.indexOf("android")>-1)d.focus();if($("#reaction-gifs").length>0)$("#reaction-gifs").mouseover(function(){$("#search-box").blur();});if($('.gifs').length)$('.gifs .gif img').each(function(){var a=$(this).attr('data-animated');if(a)$('<img/>')[0].src=a;});}};})(window,Giphy);(function(){var a=Giphy.SearchResults={attachInfiniteScroll:function(a){$('ul.freeform').infinitescroll({nextSelector:"a#next-page-arrow",navSelector:"div#paging",itemSelector:".freeform li.ungrouped",bufferPx:10,state:{currPage:window.CURRENT_PAGE},behavior:"giphy",loading:{finished:function(){$('#infscr-loading').remove();var a=$(this).data('infinitescroll');Giphy.Images.sizeImages();Giphy.Images.attachHovers();if(window.ADD_EDIT_JS===true)Giphy.UserEdit.addEditGifLinks();window.CURRENT_PAGE=a.options.state.currPage;window.OFFSET_PAGE=window.CURRENT_PAGE-1;current_page=a.options.path[0]+a.options.state.currPage;if($(".fb_container").length==0)Giphy.Analytics.fireEvents(current_page);else Giphy.Analytics.fireEvents(current_page,true);},finishedMsg:"",img:"/static/img/loading_bar_page.gif",msgText:"",speed:'fast'},pathParse:function(a,b){var c=a.split('/'),d=a.split('?')[1],e=$(".gif").last().parent().attr('href');appendParams=d?"?"+d+"&is=1":"?is=1",base=c[1],term=c[c.indexOf(base)+1];try{var f=parseInt(c[c.indexOf('search')+2],10);}catch(g){var f=1;}if(base=='search')return ['/'+base+'/'+term+'/',appendParams];else if(base=='channel')return ['/'+base+'/'+term+'/',appendParams];else return ['/'+base+'/',appendParams];}});if(a!==undefined)a();return this;}};})(window,Giphy);(function(){var a=Giphy.Sharing={shortURLs:function(){ZeroClipboard.config({swfPath:"/static/js/zeroclipboard.swf"});var a=new ZeroClipboard($(".short-link"));a.on('copy',function(a){a.clipboardData.setData("text/plain",$(".short-link").attr("data-url"));showSuccess("Short URL copied to clipboard!");});},attachShareTools:function(){ZeroClipboard.config({swfPath:"/static/js/zeroclipboard.swf"});var a=new ZeroClipboard($("#share-giphy-link-icon"));a.on('copy',function(a){a.clipboardData.setData("text/plain",$("#share-giphy-link").val());showSuccess("Giphy link copied to clipboard!");});var b=new ZeroClipboard($("#share-gif-link-icon"));b.on('copy',function(a){a.clipboardData.setData("text/plain",$("#share-gif-link").val());showSuccess("GIF link copied to clipboard!");});var c=new ZeroClipboard($("#share-html5-link-icon"));c.on('copy',function(a){a.clipboardData.setData("text/plain",$("#share-smart-link").val());showSuccess("HTML5 link copied to clipboard!");});var d=new ZeroClipboard($("#iframe-embed-code-icon"));d.on('copy',function(a){a.clipboardData.setData("text/plain",$("#iframe-embed-code").val());showSuccess("IFrame embed code copied to clipboard!");});var e=new ZeroClipboard($("#optimized-embed-code-icon"));e.on('copy',function(a){a.clipboardData.setData("text/plain",$("#optimized-embed-code").val());showSuccess("JS embed code copied to clipboard!");});var f=new ZeroClipboard($("#smart-embed-code-icon"));f.on('copy',function(a){a.clipboardData.setData("text/plain",$("#smart-embed-code").val());showSuccess("HTML5 embed code copied to clipboard!");});$("#modal-container").find("input[type='text']").click(function(){$(this).select();});$(document).bind("share-tools:open",function(){if($("#modal-container").css('display')=='none')$("#modal-container").show();});$(document).bind("close-all-modals",function(){if($("#modal-container").css('display')=='block')$("#modal-container").hide();});$(document).bind("share-tools:close",function(){if($("#modal-container").css('display')=='block')$("#modal-container").hide();});$(document).bind("share-tools:close-children",function(){$(".modal-child").hide();$('.hover').removeClass("hover");});$(".action").click(function(){if($(this).hasClass("hover")){$(document).trigger("share-tools:close");$(this).removeClass("hover");}else{$(document).trigger("share-tools:close-children");$(document).trigger("share-tools:open");$(this).addClass('hover');}return false;});$(".playchoice").on('click',function(){if($(this).attr('id')=='autoplay'&&!$(this).hasClass('active-playchoice')){$("#hoverplay").removeClass("active-playchoice");$("#hoverplay").addClass("inactive-playchoice");$(this).removeClass("inactive-playchoice");$(this).addClass("active-playchoice");$("#iframe-embed-code").val($("#iframe-embed-code").val().replace("?playOnHover=true",""));$("#optimized-embed-code").val($("#optimized-embed-code").val().replace("var _giphy_play_on_hover = true;",""));}else if($(this).attr('id')=='hoverplay'&&!$(this).hasClass('active-playchoice')){$("#autoplay").addClass("inactive-playchoice");$("#autoplay").removeClass("active-playchoice");$(this).addClass("active-playchoice");$(this).removeClass("inactive-playchoice");$("#iframe-embed-code").val($("#iframe-embed-code").val().replace(/embed\/([a-zA-Z0-9-_]*)/,"embed\/$1?playOnHover=true"));$("#optimized-embed-code").val($("#optimized-embed-code").val().replace("var _giphy","var _giphy_play_on_hover = true; var _giphy"));}});$("#shorten-url").click(function(){$(".shortener-options").show();});$("#embed-share").click(function(){$(".embed-options").show();});$("#share-link").click(function(){$(".share-options").show();});$("#redirect-to").on('click',function(){$(this).select();});$("#redirect-to").keyup(function(a){var b=a.which;if(b==13){a.preventDefault();$("#shorten-create-submit").click();return;}});var g=$("#shorten-create-submit");g.click(function(a){a.preventDefault();var b=this;$(b).prop('disabled',true);$(b).attr('value','ONE SEC...');$.ajax({type:"post",url:"//"+window.ASSET_DOMAIN+"/ajax/shorturl/create/",data:{'gif_id':$("#gif").attr('data-id'),'redirect_to':$('#redirect-to').val()}}).success(function(a){if(a.result.code!=200)return;else{$(b).prop('disabled',false);$(b).attr('value','Shorten');$("#redirect-to").val(a.result.short_url);var c=new ZeroClipboard(g);g.val("Copy");g.css('background-color','#2afd9c');c.on('copy',function(b){b.clipboardData.setData("text/plain",a.result.short_url);showSuccess("Short URL copied to clipboard!");});}}).error(function(){$(b).prop('disabled',false);$(b).attr('value','Shorten');showError("An error has occurred.");});});var h=$('#tumblr-share').not('.post');if(h.length)h.click(function(a){a.preventDefault();if(window.PHOTOBOOTH)window.open("http://www.tumblr.com/share/photo?source="+encodeURIComponent($('#gif').attr('data-image_original_url').replace('giphy.gif','500w.gif'))+"&caption="+encodeURIComponent(document.title)+"&clickthru="+encodeURIComponent($('#gif').attr('data-bitly_gif_url')),'1361370515040','width=620,height=500,toolbar=0,menubar=0,location=0,status=0,scrollbars=0,resizable=1,left=0,top=0');else window.open("http://www.tumblr.com/share/photo?source="+encodeURIComponent($('#gif').attr('data-tumblr_share_url'))+"&caption="+encodeURIComponent(document.title)+"&clickthru="+encodeURIComponent($('#gif').attr('data-bitly_gif_url')),'1361370515040','width=620,height=500,toolbar=0,menubar=0,location=0,status=0,scrollbars=0,resizable=1,left=0,top=0');});},postAnalytic:function(a){var b=$('#gif').attr("data-gif_id"),c="http://api.giphy.com/v1/gifs/"+gifID+"/share";$.ajax({type:"post",url:c,data:JSON.stringify({"share_type":a}),contentType:"application/json",dataType:"application/json"});},attachSharingAnalytics:function(){var a=$('#embed-share');if(a.length)a.click(function(a){Giphy.Sharing.postAnalytic("embed");});var b=$('#tumblr-share');if(b.length)a.click(function(a){Giphy.Sharing.postAnalytic("tumblr");});var c=$('#fb-share');if(c.length)c.click(function(){Giphy.Sharing.postAnalytic("facebook");});var d=$('#pinterest-share');if(d.length)d.click(function(){Giphy.Sharing.postAnalytic("pinterest");});var e=$('#instagram-share');if(e.length)e.click(function(){Giphy.Sharing.postAnalytic("instagram");});var f=$('#twitter-share');if(f.length)f.click(function(){Giphy.Sharing.postAnalytic("twitter");});}};})(window,Giphy);(function(a,b){var c={views:{'slider':'GiphySlider','time-slider':'GiphyTimeSlider','speed-slider':'GiphySpeedSlider','video-playhead-slider':'GiphyVideoPlayheadSlider'},initialize:function(a){a=a||{};this.$elements=$('*[data-ui]');this.subviews=[];this.render();return this;},render:function(){if(!this.$elements.length)return;a.each(this.$elements,function(c){var d=$(c);var e=d.data();if(e.ui&&a.has(this.views,e.ui)){var f=this.views[e.ui];var g=a.omit(e,'ui');var h=b[f];if(h){var i=a.extend(g,{el:d});this.subviews.push(new h(i));}}},this);},remove:function(){a.each(this.subviews,function(a){a.remove();});this.subviews={};}};b.GiphyUI=c;})(_,Giphy);(function(a,b){var c=function(a){a=a||{};this._configure(a);};c.prototype={__mousedown:function(a){a.preventDefault();this.offset.x=this.$el.offset().left;this.offset.width=this.$el.width();this._startDrag();this.__mousemove(a);},__mouseup:function(a){a.preventDefault();this._stopDrag();},__mousemove:function(a){var b=Math.ceil(a.pageX-this.offset.x);if(b>=0&&b<=this.offset.width)this.updatePercent(b/this.offset.width);},__keydown:function(a){if(a.which===37||a.which===39){a.preventDefault();a.stopPropagation();var b=a.shiftKey?0.1:0.01;b*=(a.which===37)?-1:1;this.incrementValue(b);return false;}if(a.which===38||a.which===40){a.preventDefault();a.stopPropagation();var b=a.shiftKey?10:1;b*=(a.which===40)?-1:1;this.incrementValue(b);return false;}},__updateTime:function(b,c){if(a.isEmpty(c))return;if(c.min)this.minValue=c.min;if(c.max)this.maxValue=c.max;this.updateValue(c.value||this.currentValue,true);},__updateValue:function(b,c){if(a.isUndefined(c))return;this.updateValue(c);},__updatePercent:function(b,c){if(a.isUndefined(c))return;this.updatePercent(c);},__incrementValue:function(a,b){if(!b)return;this.incrementValue(b);},_startDrag:function(){this.$el.trigger('sliderstart');this.$slider.addClass('dragging');this.$body.on('mousemove.giphyslider',a.bind(this.__mousemove,this));this.$body.on('mouseup.giphyslider',a.bind(this.__mouseup,this));this.$doc.on('mouseleave.giphyslider',a.bind(this.__mouseup,this));this.$slider.focus();},_stopDrag:function(){this.$el.trigger('sliderstop');this.$slider.removeClass('dragging');this.$body.off('.giphyslider');this.$doc.off('.giphyslider');},_configure:function(a){this.$el=$(a.el);this.options=a;this.offset={x:0,width:0};this.value=a.value||0;this.minValue=a.minValue||0;this.maxValue=a.maxValue||1;this.isReverse=a.reverse||false;this.isAnimated=a.animated||false;this.render();},_cacheSelectors:function(){this.$doc=$(document);this.$body=$('body');this.$slider=this.$el.find('.giphy-slider');this.$fill=this.$el.find('.fill');this.$time=this.$el.find('.time');},render:function(){if(!this.$el.length)return;this.$el.html(this.template());this._cacheSelectors();this.currentValue=this.value||this.minValue;this.currentPercent=0;this.$slider.attr('tabindex',1);if(!this.isAnimated)this.$el.find('.stripes').remove();this.$el.on('mousedown.giphyslider',a.bind(this.__mousedown,this));this.$el.on('slidervalue.giphyslider',a.bind(this.__updateValue,this));this.$el.on('sliderpercent.giphyslider',a.bind(this.__updatePercent,this));this.$el.on('sliderincrement.giphyslider',a.bind(this.__incrementValue,this));this.$el.on('update.giphyslider',a.bind(this.__updateTime,this));this.$el.on('reset.giphyslider',a.bind(this.resetValue,this));this.$slider.on('keydown.giphyslider',a.bind(this.__keydown,this));this.resetValue();},incrementValue:function(a){if(!a)return;this.updateValue(this.currentValue+a);},updatePercent:function(a){a=a||0;a=Math.min(a,1);a=Math.max(a,0);this.updateValue(this.minValue+(a*(this.maxValue-this.minValue)));},updateValue:function(b,c){b=b||this.currentValue;b=Math.min(this.maxValue,b);b=Math.max(this.minValue,b);this.currentValue=b;this.currentPercent=(b-this.minValue)/(this.maxValue-this.minValue);this.$time.text(this.currentValue.toFixed(2));this.$fill.width(Math.round(this.currentPercent*100)+'%');this.$el.trigger('sliderupdate',{percent:this.isReverse?1-this.currentPercent:this.currentPercent,value:this.isReverse?this.maxValue-this.currentValue:this.currentValue});if(!c){this.$slider.addClass('updated');setTimeout(a.bind(this.$slider.removeClass,this.$slider,'updated'),50);}},resetValue:function(){this.currentValue=this.value;this.minValue=this.options.minValue||0;this.maxValue=this.options.maxValue||1;this.updateValue(this.currentValue,true);},remove:function(){this.$el.off('.giphyslider');this.$slider.off('.giphyslider');this.$el.empty();},template:a.template(['<div class="giphy-slider">','<div class="fill">','<div class="stripes-wrapper">','<div class="stripes"></div>','</div>','<div class="dragger">','<div class="grip"></div>','<div class="time"></div>','</div>','</div>','</div>'].join(""))};b.GiphySlider=c;})(_,Giphy);(function(a,b){var c=function(a){this._configure(a);};a.extend(c.prototype,b.GiphySlider.prototype,{_cacheSelectors:function(){b.GiphySlider.prototype._cacheSelectors.call(this);this.$slower=this.$el.find('.speed-container.slower');this.$faster=this.$el.find('.speed-container.faster');},_stopDrag:function(){b.GiphySlider.prototype._stopDrag.call(this);this.$slower.removeClass('active');this.$faster.removeClass('active');},updateValue:function(a,c){var d=this.currentValue;var e=0;b.GiphySlider.prototype.updateValue.call(this,a,c);e=this.$fill.width();this.$slower.toggleClass('active',this.currentValue<d).width(e);this.$faster.toggleClass('active',this.currentValue>d).width(this.$el.width()-e);},template:a.template(['<div class="giphy-slider speed-slider">','<div class="speed-container slower">','<div class="speed-label">Slower</div>','</div>','<div class="fill">','<div class="dragger">','<div class="grip"></div>','</div>','</div>','<div class="speed-container faster">','<div class="speed-label">Faster</div>','</div>','</div>'].join(""))});b.GiphySpeedSlider=c;})(_,Giphy);(function(a,b){var c=function(a){this._configure(a);};a.extend(c.prototype,b.GiphySlider.prototype,{__updateDuration:function(a,b){this.updateDuration(b);},_configure:function(a){b.GiphySlider.prototype._configure.call(this,a);this.duration=a.duration||0;},_cacheSelectors:function(){b.GiphySlider.prototype._cacheSelectors.call(this);this.$duration=this.$el.find('.duration');},render:function(){b.GiphySlider.prototype.render.call(this);this.$el.on('sliderduration.giphyslider',a.bind(this.__updateDuration,this));},updateValue:function(c,d){c=c||this.currentValue;if(c+this.duration>this.maxValue)c=this.maxValue-this.duration;b.GiphySlider.prototype.updateValue.call(this,c,d);var e=a.last(this.currentValue.toFixed(2).split('.'));var f=b.Utils.formatTime(this.currentValue);f+='<span class="milliseconds">.'+e+'</span>';this.$time.html(f);},updateDuration:function(a){a=a||0;a=Math.min(a,this.maxValue);a=Math.max(a,0);this.duration=a;var b=this.duration/this.maxValue;var c=Math.ceil(this.$el.width()*b);this.$duration.width(c);this.$time.css('left',c);this.updateValue(this.currentValue,true);},resetValue:function(){this.updateDuration(this.options.duration||0);b.GiphySlider.prototype.resetValue.call(this);},template:a.template(['<div class="giphy-slider time-slider">','<div class="fill">','<div class="duration stripes-wrapper">','<div class="stripes"></div>','</div>','<div class="dragger">','<div class="grip"></div>','<div class="time"></div>','</div>','</div>','</div>'].join(""))});b.GiphyTimeSlider=c;})(_,Giphy);(function(a,b){var c=function(a){this._configure(a);};a.extend(c.prototype,b.GiphyTimeSlider.prototype,{$playhead:null,playheadValue:0,_startDrag:function(){this.setPlayheadValue(0);b.GiphyTimeSlider.prototype._startDrag.call(this);},_stopDrag:function(){b.GiphyTimeSlider.prototype._stopDrag.call(this);},setPlayheadValue:function(a){this.playheadValue=a;this.$playhead.css('left',a+'%');},getPlayheadValue:function(){return this.playheadValue;},cacheSelectors:function(){this.$playhead=this.$el.find('.playhead');},render:function(){b.GiphyTimeSlider.prototype.render.call(this);this.cacheSelectors();this.$el.on('sliderplayhead.giphyslider',a.bind(function(a,b){this.setPlayheadValue(b);},this));},template:a.template(['<div class="giphy-slider">','<div class="fill">','<div class="playhead"></div>','<div class="stripes-wrapper">','<div class="stripes"></div>','</div>','<div class="dragger">','<div class="grip"></div>','<div class="time"></div>','</div>','</div>','</div>'].join(""))});b.GiphyVideoPlayheadSlider=c;})(_,Giphy);(function(a,b){var c={__submit:function(){this.filePortal.submit();},__loginCheck:function(a){a.target.LOGGED_IN?this.$footer.hide():this.$footer.show();},initialize:function(a){this.$win=$(window);this.$el=$('.creation-tools-upload');this.$footer=this.$el.find('.tool-footer');this.user=null;this.fileportal=null;this.fileTypes=["image/gif","video/mpg","video/m4v","video/x-m4v","video/mov","video/mp4","video/mpeg","video/quicktime"];this.submitUrl=a.submitUrl||'';this.render();},render:function(){if(!this.$el.length)return;this.filePortal=b.FilePortal.initialize({url:this.submitUrl,fileTypes:this.fileTypes,sortableList:this.$el.find('#upload-queue'),allowAnonymous:false,multipleRequiresLogin:true,maxVideoLength:15,defaultTags:'giphyupload',preventDuplicates:true});this.$win.on('login:check.upload-gif',a.bind(this.__loginCheck,this));b.Events.on('optionalfields:upload.upload-gif',this.__submit,this);}};b.Upload=c;})(_,Giphy);(function(a){var b={__aboutButtonClick:function(a){a.preventDefault();this.$aboutContainer.toggleClass('show-info');},__aboutGlassClick:function(a){a.preventDefault();this.$aboutContainer.removeClass('show-info');},initialize:function(a){a=a||{};this.$el=$(a.el||'#user-channel');this.render();},render:function(){if(!this.$el.length)return;this._cacheSelectors();this._bindEvents();this.determineBioLayout();},determineBioLayout:function(){if(!this.$aboutBio.length||!this.$aboutInfo.length)return;var a=0;var b=140;this.$aboutInfo.css('display','block');a=this.$aboutBio.height();this.$aboutInfo.css('display','');if(a>b)this.$aboutInfo.addClass('wide-layout');},_cacheSelectors:function(){this.$aboutContainer=this.$el.find('.about-container');this.$aboutBtn=this.$el.find('.about-button');this.$aboutGlass=this.$el.find('.about-glass');this.$aboutInfo=this.$el.find('.about-info');this.$aboutBio=this.$el.find('.about-bio');},_bindEvents:function(){this.$aboutBtn.on('click',$.proxy(this.__aboutButtonClick,this));this.$aboutGlass.on('click',$.proxy(this.__aboutGlassClick,this));}};a.UserChannel=b;})(Giphy);(function(){var a=Giphy.UserEdit={errorMessages:{'password':'Must be at least 6 characters.','email':'Please enter a valid email address.','url':'Please enter a valid url.','required':'This field can\'t be left blank.'},_addErrorToInput:function(a,b){if(!a)return;var c=$(a);_.defer(function(){$('html, body').stop(true,true).animate({scrollTop:c.offset().top-50});});if(c.hasClass('error'))return;var d=c.attr('type');var e=c.attr('required')||false;var f=c.get(0).validationMessage;if(e&&!c.val())f=this.errorMessages.required;else if(this.errorMessages[d])f=this.errorMessages[d];Giphy.Utils.showInputMessage(c,b||f,true);},_ajaxSubmitForm:function(a,b){if(!a)return;var c=$.Deferred();var d=$(a);var e=d.find(':input:visible');if(!d.get(0).checkValidity()){e.each($.proxy(function(a,b){if(!b.validity.valid)this._addErrorToInput(b);},this));c.reject();}else{var f=new FormData(d.get(0));$.ajax({url:d.attr('action'),type:'POST',data:f,processData:false,contentType:false,success:function(a){window.showSuccess('Settings updated!');if(a.result&&a.result.channel_url)$('.user-url').attr('href',a.result.channel_url);c.resolve(a);},error:$.proxy(function(a){var b=a.responseJSON.result;window.showError('Uh-oh. Something went wrong. Please try again.');c.reject(b);},this)});}return c.promise();},_bindSaveButtonEvents:function(a){if(!a)return;var b=$(a).attr('disabled',true);var c=b.closest('form');var d=c.find('.settings-field');var e=c.find(':input');var f=b.text();var g="Saving";var h="Success";var i=c.serialize();e.on('input',function(a){var e=i===c.serialize();d.removeClass('saved');b.attr('disabled',e).text(f);});b.on('click',$.proxy(function(a){a.preventDefault();a.stopPropagation();d.addClass('saving');b.text(g);this._ajaxSubmitForm(c).done(function(){setTimeout(function(){i=c.serialize();d.removeClass('saving').addClass('saved');b.text(h);},1000);}).fail($.proxy(function(a){var e=a||{};for(var g in e)this._addErrorToInput(c.find(':input[name='+g+']'),e[g]);d.removeClass('saving');b.text(f);},this));return false;},this));},_reloadEmbedIframe:function(){var a=$('#settings-embed-iframe');if(!a.length)return;var b=a.attr('src').replace('?bust=1','');$.ajax({type:"POST",url:"/status/cachebust/",data:{"url":b},success:function(c){a.attr('src',b+"?bust=1");}});},_preloadImage:function(a){var b=$.Deferred();if(!a)b.reject();else{var c=new Image();c.onload=function(){b.resolve();};c.src=a;}return b.promise();},initializeFormEvents:function(){var a=$("form button.save");var b=$(".settings-toggle");var c=$("#id_username");var d=$("#user_url_text");var e=$('#id_about_bio');e.height(e.get(0).scrollHeight);if(c.length)c.on('input',function(a){var b=c.val();d.text(b);});Giphy.Events.on('toggleinput:toggle',function(a,b,c){var d=$(b);var e=$('input[name='+d.data('input')+']');var f=d.data('inverse-toggle')||false;c=c||false;if(e.length)f?e.val(!c):e.val(c);this._ajaxSubmitForm(window.settingsForm).done($.proxy(function(){if(d.data('input')==='suppress_chrome')this._reloadEmbedIframe();},this));},this);a.each($.proxy(function(a,b){this._bindSaveButtonEvents(b);},this));},addEditGifLinks:function(){var a=$(".user-search-results");if(a.length)$.each($(".a-gif").not(".editLink").not(".no-edit"),function(a,b){var c=$(b),d="/gifs/"+c.attr("data-id")+"/edit/",e=$("<a></a>").addClass("button small transparent-background edit-image").attr("href",d).html("EDIT");c.addClass("editLink");c.attr("href",d);c.after(e);});},addEditBanner:function(){var a=$(".banner img").not("#settings-banner");if(a.length){var b=$("<a></a>").addClass("small button transparent-background edit-image").attr("href","/dashboard/").html("EDIT");a.after(b);}},userSettingsInit:function(){var a=$('#channel-settings-form');if(a.length){window.settingsForm=a;Giphy.UserEdit.uploadNewBanner();Giphy.UserEdit.uploadNewAvatar();Giphy.UserEdit.resetAvatar();Giphy.UserEdit.initializeFormEvents();Giphy.UserEdit.resizeEmbedGif();Giphy.UserEdit.jazzText();if(Giphy.SettingsTourGuide)Giphy.SettingsTourGuide.initialize();}},jazzText:function(){var a=$('#dashboard-banner-text.jazz-text');if(!a.length)return;var b=a.text().split('');a.html('');for(var c=0;c<b.length;c++){var d=$('<span class="dancing-text">'+b[c]+'</span>');a.append(d);}},uploadNewBanner:function(){var a=$('#upload-banner-button');var b=$('#remove-banner-button');var c=$('#id_banner_image');var d=$('#settings-banner');var e=$('#id_is_remove_banner');var f=a.closest('.settings-field');var g=a.closest('.form-row');var h=c.attr('name');var i=a.text();var j=function(){f.removeClass('saving');a.text(i);};a.on('click',$.proxy(function(a){a.preventDefault();c.click();},this));b.on('click',$.proxy(function(a){a.preventDefault();g.addClass('no-banner');d.css('background-image','none');e.val(true);this._ajaxSubmitForm(window.settingsForm).done(function(){e.val(false);});},this));c.on('change',$.proxy(function(b){var e=c.get(0).files;f.addClass('saving');a.text('Uploading');this._ajaxSubmitForm(window.settingsForm).done($.proxy(function(a){var b=a.result;this._preloadImage(b.banner_image).done(function(){d.css('background-image','url('+b.banner_image+')');g.removeClass('no-banner');j();});},this)).fail(function(a){a=a||{};j();if(window.showError&&a[h])window.showError(a[h],6000);});},this));},uploadNewAvatar:function(){var a=$('#upload-avatar');var b=$('#id_avatar');var c=a.find('.upload-label');var d=$('#header .avatar');var e=b.attr('name');var f=c.text();var g=function(){a.removeClass('uploading');c.text(f);};a.on('click',function(a){a.preventDefault();b.click();});b.on('change',$.proxy(function(){a.addClass('uploading');c.text('Uploading');this._ajaxSubmitForm(window.settingsForm).done($.proxy(function(b){var c=b.result;this._preloadImage(c.avatar).done(function(){g();a.css('background-image','url('+c.avatar+')');if(d.length)d.css('background-image','url('+c.avatar+')');});},this)).fail(function(a){a=a||{};g();if(window.showError&&a[e])window.showError(a[e],6000);});},this));},resetAvatar:function(){},showSettingsExampleModal:function(){$('#guide-text').click(function(a){$('#metadata-example').modal({closeText:'',zIndex:100});});},resizeEmbedGif:function(){var a=$('#settings-embed-iframe');if(a.length){var b=a.data();var c=a.width()/b.imagewidth;a.height(b.imageheight*c);}},resetListner:function(){var a=$('.reset');a.click(function(a){$(this).siblings('.reset-input').prop('checked',true);if(a.target.form)setTimeout(function(){a.target.form.submit();},200);});}};})(window,Giphy);(function(a){var b={__scroll:function(){var a=this.$messages.not('[data-seen="true"]');this.windowScrollTop=this.$win.scrollTop();if(a.length)a.each($.proxy(function(a,b){$(b).attr('data-seen',this._isInViewport(b));},this));else{this.remove();this.markAsSeen();}},__resize:function(){this.windowHeight=this.$win.height();},_isInViewport:function(a){var b=$(a);var c=b.offset().top+b.height()+100;return c-this.windowScrollTop<this.windowHeight;},initialize:function(a){a=a||{};if(!window.giphyMessages)return;this.id=window.giphyMessages.id;this.messages=window.giphyMessages.messages;this.isSeen=false;this.windowHeight=0;this.windowScrollTop=0;this.endpoint='/ajax/seenmessages/';this.$el=$(a.el||'#account-settings');this.$body=$('body');this.$win=$(window);this.$messages=$();if(this.messages)this.render();},render:function(){for(var b in this.messages){var c=this.messages[b];var d=$('.settings-toggle[data-input='+c.element+'], :input[name='+c.element+']').filter(':visible');if(d.length){var e=a.Utils.showInputMessage(d,c.message);this.$messages=this.$messages.add(e);}}this.windowHeight=this.$win.height();this.windowScrollTop=this.$win.scrollTop();this.$win.on('scroll.settingsTourGuide',$.proxy(this.__scroll,this));this.$win.on('resize.settingsTourGuide',$.proxy(this.__resize,this));},markAsSeen:function(){$.ajax({url:this.endpoint,type:'POST',data:{message_id:this.id}});},remove:function(){this.$win.off('.settingsTourGuide');}};a.SettingsTourGuide=b;})(Giphy);(function(){var a=Giphy.Utils={fadeMessages:function(a){$(document).ready(function(){clearTimeout(window.messageFadeTimeout);window.messageFadeTimeout=setTimeout(function(){$('.flash').fadeOut('slow');},a||2000);});},canPlayMP4:function(){return !!document.createElement('video').canPlayType('video/mp4; codecs=avc1.42E01E,mp4a.40.2');},getParameterByName:function(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b=new RegExp("[\\?&]"+a+"=([^&#]*)"),c=b.exec(location.search);return c==null?"":decodeURIComponent(c[1].replace(/\+/g," "));},hideLogo:function(){$("#logo-image").hide();},checkLogin:function(){if(window.LOGGED_IN)return true;return false;},log:function(a){if(window.console)console.log(a);return;},timeout:function(){var a=null;var b=null;var c=0;var d=[];var e=false;var f=false;this.init=function(h,i,j){var k;if(e)return false;if(!h)return false;if(!i)return false;a=h;b=i;e=true;f=false;c=j?j:0;d=[];for(k=3;k<arguments.length;k++)d[d.length]=arguments[k];setTimeout(g,b);};this.cancel=function(){f=true;e=false;c=0;};function g(){e=false;if(f)return;a.apply(null,d);if(c>0){c--;setTimeout(g,b);}}},showInputMessage:function(a,b,c,d){$input=$(a);b=b||'';c=c||false;d=d||false;if(!$input.length||!b.length||$input.hasClass('message'))return;var e=$input.position();var f=$('<div class="input-message"></div>');var g=function(){f.trigger('removed').remove();$(this).removeClass('message error').off('.input-message');};f.toggleClass('error',c).html(b).css({minHeight:($input.hasClass('settings-toggle'))?'':$input.outerHeight(),left:e.left+$input.outerWidth(),top:e.top});$input.addClass('message').toggleClass('error',c).after(f).one('removemessage.input-message',g);if(!d)if($input.is(':input'))$input.one('input.input-message',g);else $input.one('click.input-message',g);return f;},removeInputMessage:function(a){$input=$(a);$input.trigger('removemessage');},getScrollbarWidth:function(){var a=0;var b=document.createElement('div');b.style.height=100;b.style.width=100;b.style.overflow='scroll';document.body.appendChild(b);a=b.offsetWidth-b.clientWidth;document.body.removeChild(b);return a;},getExtension:function(a){if(!a)return;var b=/\.([^\.]+)$/;var c='';var d=a.match(b);if(d&&d.length>1)c=d[1];return c;},canPlayType:function(a){var b=document.createElement('video');return b.canPlayType(a);},preloadImage:function(){var a=arguments.length>1?arguments:arguments[0];if(_.isArray(a))return $.when.apply(window,_.map(a,function(a){return this._preloadImage(a);},this));var b=$.Deferred();var c=new Image();if(!a)b.reject();else{c.onload=function(){b.resolve(c);};c.onerror=function(){b.reject();};c.src=a;}return b.promise();},getImageData:function(a){var b=$.Deferred();var c=document.createElement('canvas');var d=c.getContext('2d');this.preloadImage(a).done(function(a){c.width=a.width;c.height=a.height;d.drawImage(a,0,0);b.resolve({data:d.getImageData(0,0,c.width,c.height),width:c.width,height:c.height});});return b.promise();},jazzText:function(a,b){var c=$(a);b=b||false;if(!c.length)return;c.each(function(){var a=$(this);var c=a.text().split('');a.addClass('jazz-text').toggleClass('soft-jazz',b).html('');for(var d=0;d<c.length;d++){var e=$('<span class="dancing-text">'+c[d]+'</span>');a.append(e);}});},openPopup:function(a,b,c){if(!a)return;var d='';var e={height:c||480,left:0,location:0,menubar:0,resizable:1,status:0,toolbar:0,top:0,width:(b||480)+this.getScrollbarWidth()};for(var f in e)d+=f+'='+e[f]+',';window.open(a,'_blank',d);},urlRE:RegExp("^"+"("+"(?:(?:https?:)?//)?"+"(?:\\S+(?::\\S*)?@)?"+"(?:"+"(?!(?:10|127)(?:\\.\\d{1,3}){3})"+"(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})"+"(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})"+"(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])"+"(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}"+"(?:\\.(?:1\\d\\d|2[0-4]\\d|25[0-4]|[1-9]\\d?))"+"|"+"(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)"+"(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*"+"(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))"+"\\.?"+")"+"(?::\\d{2,5})?"+"(?:[/?#][^\\s\\?#]*)?"+")"+"(?:\\?{0,1})"+"(?:\\S*)?"+"$","i"),prefixStyle:function(a,b){var c={};c['-webkit-'+a]=b;c['-moz-'+a]=b;c['-ms-'+a]=b;c[a]=b;return c;},transitionEnd:function(){var a;var b=document.createElement('fakeelement');var c={'transition':'transitionend','OTransition':'oTransitionEnd','MozTransition':'transitionend','WebkitTransition':'webkitTransitionEnd'};for(a in c)if(b.style[a]!==undefined)return c[a];},animationEnd:function(){var a;var b=document.createElement('fakeelement');var c={'animation':'animationend','OAnimation':'oAnimationEnd','MozAnimation':'animationend','WebkitAnimation':'webkitAnimationEnd'};for(a in c)if(b.style[a]!==undefined)return c[a];},getVideoDuration:function(a){var b=$.Deferred();var c=document.createElement('video');var d=$(c);a=a||null;c.autoplay=false;c.preload='metadata';d.one('loadedmetadata',function(){d.off();b.resolve(c.duration);});d.one('error',function(){d.off();b.reject();});if(typeof a!=='string')c.src=window.URL.createObjectURL(a);else c.src=a;return b.promise();},isVineUrl:function(a){if(!a)return false;var b=a.match(/^(?:https?:\/\/)?(?:www\.)?(?:vine\.co)\/v\/(?:[a-z0-9]{10})/i);return(b&&b.length>0);},getYoutubeId:function(a){if(!a)return false;var b=a.match(/^(?:https?:\/\/)?(?:www\.)?(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))((\w|-){11})(?:\S+)?$/);return(b&&b.length>1)?b[1]:false;},getVimeoId:function(a){if(!a)return false;var b=a.match(/https?:\/\/(?:www\.|player\.)?vimeo.com\/(?:channels\/(?:\w+\/)?|groups\/([^\/]*)\/videos\/|album\/(\d+)\/video\/|video\/|)(\d+)(?:$|\/|\?)/);return(b&&b.length>2)?b[3]:false;},formatTimeObject:function(a){var b=Math.floor(a/(60*60));var c=(a%(60*60));var d=Math.floor(c/60);var e=Math.ceil(c%60);var f={h:b,m:d,s:e};return f;},formatTime:function(a){a=a||0;var b=Math.floor(a/3600);var c=Math.floor(a%3600/60);var d=Math.floor(a%3600%60);var e=(b>0)?[b,c,d]:[c,d];var f=_.map(e,function(a){return(a<10)?'0'+a:a;});return f.join(':');},padNumber:function(a,b){return('000000000'+a).substr(-b);}};var b=3000;window.showSuccess=function(a,c,d){if(typeof d!=='undefined')var e=d;else var e=b;var f=$("<div>");$(f).addClass("flash");$(f).addClass("success");$(f).text(a);$("#messages").html(f);setTimeout(function(){if(typeof c!=='undefined')document.location.pathname=c;f.fadeOut('slow');},e);};window.showFancyMessage=function(a,b){var c=$("<div>");$(c).addClass("flash");$(c).addClass("fancy");$(c).text(a);$("#messages").html(c);Giphy.Utils.fadeMessages(b);};window.showError=function(a,b){b=b||5000;var c=$("<div>");$(c).addClass("flash");$(c).addClass("error");$(c).text(a);$("#messages").html(c);Giphy.Utils.fadeMessages(b);};})(window,Giphy);$(function(){$(document).ready(function(){if(!$(".gif-detail").length>0)return;if(Giphy.GifDetail)Giphy.GifDetail.initialize();});});$(function(){$(document).ready(function(){Giphy.Etc.init();if($(".fb_container").length===0)Giphy.Etc.checkLogin({success:function(){var a=$("#default-nav");if(a.length)$.get("/ajax/userheader/?parent="+location.href,function(a){$("#default-nav").replaceWith(a);$("#default-nav").show();Giphy.UserEdit.userSettingsInit();var b=$("#login-button");if(b.length&&window.LOGIN_NEXT){var c=b.attr("href");b.attr("href",c+"?next="+window.LOGIN_NEXT);}var d=Giphy.Utils.getParameterByName('ref');if(d=='fave'){var e=$("#share-heart");if(e.length)e.trigger('click');}});}});Giphy.Globals.initialize();if(Giphy.UserChannel)Giphy.UserChannel.initialize();Giphy.Images.preloadImages();Giphy.Backgrounds.setRandomBackground();Giphy.Login.facebook();Giphy.Favorites.nav();Giphy.Search.init();Giphy.Search.initMini();Giphy.Browsebar.init();Giphy.Browsebar.attachBrowsebarHovers();Giphy.Images.attachHovers();Giphy.Images.sizeImagesToFrame();if(Giphy.Utils.getParameterByName('hideLogo')=='true')Giphy.Utils.hideLogo();if(Giphy.Utils.getParameterByName('status')&&Giphy.Utils.getParameterByName('message')){var a={"uploaded":"GIF uploaded successfully! It's been added to your channel page.","welcome":"Welcome To Giphy!","login":"You are now logged in.","userexists":"That email address has already been registered. Did you forget your password?","twautherror":"Looks like Twitter is experiencing technical difficulties. Please try again.","fbautherror":"Looks like Facebook is experiencing technical difficulties. Please try again.","gifdeleted":"Your GIF has been deleted."},b=Giphy.Utils.getParameterByName('message');if(parseInt(Giphy.Utils.getParameterByName('status'),10)==200)(b==='welcome')?showFancyMessage(a[b],5000):showSuccess(a[b]);else showError(a[b]);}});});$(function(){$(document).ready(function(){if(!$("#homepage").length>0)return;Giphy.Nav.share();Giphy.Nav.attachFooter();Giphy.Homepage.init();});});(function(a,b){var c={__mouseover:function(a){var b=$(a.currentTarget);var c=b.find('.onboarding-background');if(c.length){c.addClass('hovering');this._setVideoSpeed(c,1);}},__mouseout:function(a){var b=$(a.currentTarget);var c=b.find('.onboarding-background');if(c.length){c.removeClass('hovering');this._setVideoSpeed(c,this.videoSpeed);}},_setVideoSpeed:function(a,b){b=b||this.videoSpeed;var c=$(a).find('video');if(c.length)c.get(0).playbackRate=b;},initialize:function(a){a=a||{};this.$el=$(a.el||'.onboarding-container');this.artistGifs=a.artistGifs||[];this.partnerGifs=a.partnerGifs||[];this.videoSpeed=a.videoSpeed||0.3;this.render();},cacheSelectors:function(){this.$artistCreate=this.$el.find('.artist-create');this.$partnerCreate=this.$el.find('.partner-create');},render:function(){if(!this.$el.length)return;this.cacheSelectors();if(this.artistGifs.length){var b=a.sample(this.artistGifs);this.$artistCreate.append(this.template(b));this._setVideoSpeed(this.$artistCreate,this.videoSpeed);}if(this.partnerGifs.length){var b=a.sample(this.partnerGifs);this.$partnerCreate.append(this.template(b));this._setVideoSpeed(this.$partnerCreate,this.videoSpeed);}this.$el.on('mouseover.join-apply','.onboarding .inner',$.proxy(this.__mouseover,this));this.$el.on('mouseout.join-apply','.onboarding .inner',$.proxy(this.__mouseout,this));},remove:function(){this.$el.off('.join-apply');},template:a.template('<div class="onboarding-background">                <video class="background-video" poster="<%- images.original_still.url %>" src="<%- images.original.mp4 %>" loop autoplay>                    <div class="background-image" style="background-image:url(<%- images.original.url %>)"></div>                </video>            </div>')};b.JoinApply=c;})(_,Giphy);$(function(){$(document).ready(function(){if(!$("#user-login").length>0)return;Giphy.Login.loginFocus();});});$(function(){$(document).ready(function(){if(!$(".post-content").length>0)return;Giphy.Sharing.shortURLs();Giphy.Sharing.attachShareTools();Giphy.Sharing.attachSharingAnalytics();Giphy.Overlays.addOverlayToGifDetail();Giphy.Overlays.sizeFSOverlay();$('.post-content iframe').each(function(){var a=parseInt($(this).css('width').replace('px',''));var b=parseInt($(this).css('height').replace('px',''));var c=643;var d=(c*b)/a;$(this).css('height',d+'px');$(this).css('width',c+'px');});var a=document.URL.split('posts');a.shift();var b=a.join('posts').split('?')[0].replace('/','').replace('#','');var c="/posts/related/gifs/"+b;var d=$("#post-detail").data("post_id");var e="/posts/related/posts/"+d;e=e.replace("//","/");$(document).on('scroll',function(){$("iframe").each(function(){var a=document.createElement('a');a.href=$(this).attr('src');if(a.protocol==document.location.protocol&&a.hostname==document.location.hostname){var b=$(this).contents().find('#gif');if(($(this).offset().top<=$(window).height()+$(window).scrollTop())&&($(this).offset().top+$(this).height()>=$(window).scrollTop())){if($(b).attr('src')!=$(b).attr('data-animated'))$(b).attr('src',$(b).attr('data-animated'));}else if($(b).attr('src')!=$(b).attr('data-still'))$(b).attr('src',$(b).attr('data-still'));}});});});});$(function(){$(document).ready(function(){if(!$("#searchresults").length>0)return;Giphy.Analytics.trackSearchResultsView();Giphy.SearchResults.attachInfiniteScroll();Giphy.Images.sizeImages();Giphy.Images.attachHovers();});});